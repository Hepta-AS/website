(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[214],{2898:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var r=s(2265),n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=(e,t)=>{let s=(0,r.forwardRef)(({color:s="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:l,children:c,...u},d)=>(0,r.createElement)("svg",{ref:d,...n,width:i,height:i,stroke:s,strokeWidth:l?24*Number(o)/Number(i):o,className:`lucide lucide-${a(e)}`,...u},[...t.map(([e,t])=>(0,r.createElement)(e,t)),...(Array.isArray(c)?c:[c])||[]]));return s.displayName=`${e}`,s}},3067:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(2898).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},4280:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(2898).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},9591:function(e,t,s){Promise.resolve().then(s.bind(s,9244))},9244:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var r=s(7437),n=s(2265),a=s(4033),i=s(5754),o=s(7815),l=s(1568),c=s(8333),u=s(3067),d=s(4280);function h(e){let{userId:t}=e,{sessionToken:s}=(0,c.useAuth)(),[a,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(!0),[g,f]=(0,n.useState)(null),x=async()=>{try{m(!0),f(null);let e=await fetch("/api/admin/stripe-customer?userId=".concat(t),{headers:{Authorization:"Bearer ".concat(s||"test_session")}});if(!e.ok)throw Error("Failed to fetch customer info: ".concat(await e.text()));let r=await e.json();u(r.customer||null)}catch(e){console.error("Error fetching customer info:",e),f(e instanceof Error?e.message:"Failed to fetch customer info")}finally{m(!1)}};return((0,n.useEffect)(()=>{t&&x()},[t,s]),h)?(0,r.jsxs)(o.Zb,{className:"border-gray-800 bg-gray-900/50",children:[(0,r.jsx)(o.Ol,{className:"pb-2",children:(0,r.jsx)(l.O,{className:"h-6 w-1/3"})}),(0,r.jsxs)(o.aY,{children:[(0,r.jsx)(l.O,{className:"h-4 w-full mb-2"}),(0,r.jsx)(l.O,{className:"h-4 w-3/4"})]})]}):g?(0,r.jsxs)(o.Zb,{className:"border-red-800 bg-red-900/20",children:[(0,r.jsx)(o.Ol,{children:(0,r.jsx)(o.ll,{children:"Feil ved lasting av kundeinformasjon"})}),(0,r.jsxs)(o.aY,{children:[(0,r.jsx)("p",{className:"text-red-400",children:g}),(0,r.jsx)(i.z,{onClick:x,variant:"outline",className:"mt-4",children:"Pr\xf8v igjen"})]})]}):a?(0,r.jsxs)(o.Zb,{className:"border-gray-800 bg-gray-900/50",children:[(0,r.jsxs)(o.Ol,{className:"pb-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)(o.ll,{children:"Stripe kundeinformasjon"}),(0,r.jsxs)(i.z,{onClick:x,variant:"outline",size:"sm",className:"gap-2",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4"}),"Oppdater"]})]}),(0,r.jsxs)(o.SZ,{children:["Kunde ID: ",a.id]})]}),(0,r.jsx)(o.aY,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-400",children:"E-post"}),(0,r.jsx)("div",{children:a.email})]}),a.name&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-400",children:"Navn"}),(0,r.jsx)("div",{children:a.name})]}),a.phone&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-400",children:"Telefon"}),(0,r.jsx)("div",{children:a.phone})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-400",children:"Opprettet"}),(0,r.jsx)("div",{children:new Date(1e3*a.created).toLocaleDateString()})]}),a.metadata&&Object.keys(a.metadata).length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-400",children:"Metadata"}),(0,r.jsx)("div",{className:"bg-gray-800 p-2 rounded text-xs",children:(0,r.jsx)("pre",{children:JSON.stringify(a.metadata,null,2)})})]})]})})]}):(0,r.jsx)(o.Zb,{className:"border-gray-800 bg-gray-900/50",children:(0,r.jsxs)(o.Ol,{children:[(0,r.jsx)(o.ll,{children:"Ingen kundeinformasjon"}),(0,r.jsx)(o.SZ,{children:"Denne brukeren har ingen Stripe kunde tilknyttet."})]})})}function m(){let e=(0,a.useParams)(),t=(0,a.useRouter)(),{sessionToken:s}=(0,c.useAuth)(),[d,m]=(0,n.useState)(null),[g,f]=(0,n.useState)(!0),[x,p]=(0,n.useState)(null),j=null==e?void 0:e.id,v=async()=>{try{f(!0),p(null);let e=await fetch("/api/admin/users/".concat(j),{headers:{Authorization:"Bearer ".concat(s||"test_session")}});if(!e.ok)throw Error("Failed to fetch user: ".concat(await e.text()));let t=await e.json();m(t.user||null)}catch(e){console.error("Error fetching user:",e),p(e instanceof Error?e.message:"Failed to fetch user")}finally{f(!1)}};return(0,n.useEffect)(()=>{j&&v()},[j,s]),(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.z,{variant:"outline",size:"icon",onClick:()=>t.back(),children:(0,r.jsx)(u.Z,{className:"h-4 w-4"})}),(0,r.jsx)("h1",{className:"text-4xl font-bold",children:"Brukerdetaljer"})]}),g?(0,r.jsxs)(o.Zb,{className:"border-gray-800 bg-gray-900/50",children:[(0,r.jsx)(o.Ol,{className:"pb-2",children:(0,r.jsx)(l.O,{className:"h-6 w-1/3"})}),(0,r.jsxs)(o.aY,{children:[(0,r.jsx)(l.O,{className:"h-4 w-full mb-2"}),(0,r.jsx)(l.O,{className:"h-4 w-3/4"})]})]}):x?(0,r.jsxs)(o.Zb,{className:"border-red-800 bg-red-900/20",children:[(0,r.jsx)(o.Ol,{children:(0,r.jsx)(o.ll,{children:"Feil ved lasting av bruker"})}),(0,r.jsxs)(o.aY,{children:[(0,r.jsx)("p",{className:"text-red-400",children:x}),(0,r.jsx)(i.z,{onClick:v,variant:"outline",className:"mt-4",children:"Pr\xf8v igjen"})]})]}):d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.Zb,{className:"border-gray-800 bg-gray-900/50",children:[(0,r.jsxs)(o.Ol,{children:[(0,r.jsx)(o.ll,{children:d.full_name||d.email}),(0,r.jsx)(o.SZ,{children:d.email})]}),(0,r.jsx)(o.aY,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-400",children:"Bruker ID"}),(0,r.jsx)("div",{className:"font-mono text-sm",children:d.id})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-400",children:"Opprettet"}),(0,r.jsx)("div",{children:new Date(d.created_at).toLocaleDateString()})]}),d.stripe_customer_id&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-400",children:"Stripe kunde ID"}),(0,r.jsx)("div",{className:"font-mono text-sm",children:d.stripe_customer_id})]})]})})]}),(0,r.jsx)(h,{userId:d.id})]}):(0,r.jsxs)(o.Zb,{className:"border-gray-800 bg-gray-900/50",children:[(0,r.jsx)(o.Ol,{children:(0,r.jsx)(o.ll,{children:"Bruker ikke funnet"})}),(0,r.jsxs)(o.aY,{children:[(0,r.jsx)("p",{children:"Kunne ikke finne brukeren du leter etter."}),(0,r.jsx)(i.z,{onClick:()=>t.push("/admin/users"),variant:"outline",className:"mt-4",children:"Tilbake til brukerliste"})]})]})]})}},5754:function(e,t,s){"use strict";s.d(t,{z:function(){return c}});var r=s(7437),n=s(2265),a=s(7256),i=s(6061),o=s(1657);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-blue-600 text-white hover:bg-blue-700",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:s,variant:n,size:i,asChild:c=!1,...u}=e,d=c?a.g7:"button";return(0,r.jsx)(d,{className:(0,o.cn)(l({variant:n,size:i,className:s})),ref:t,...u})});c.displayName="Button"},7815:function(e,t,s){"use strict";s.d(t,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return i},aY:function(){return u},eW:function(){return d},ll:function(){return l}});var r=s(7437),n=s(2265),a=s(1657);let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});i.displayName="Card";let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",s),...n})});o.displayName="CardHeader";let l=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});l.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",s),...n})});c.displayName="CardDescription";let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",s),...n})});u.displayName="CardContent";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",s),...n})});d.displayName="CardFooter"},1568:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});var r=s(7437),n=s(1657);function a(e){let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)("animate-pulse rounded-md bg-muted",t),...s})}},8333:function(e,t,s){"use strict";s.r(t),s.d(t,{AuthProvider:function(){return h},useAuth:function(){return m}});var r=s(7437),n=s(2265),a=s(7013),i=s(4033),o=s(1657);let l=(0,n.createContext)({user:null,sessionToken:null,userRole:null,login:async()=>{},logout:async()=>{},checkAuth:async()=>({isLoggedIn:!1,user:null}),createTestSession:async()=>{}}),c={id:"test-user-id",email:"test@example.com",user_metadata:{full_name:"Test User"},app_metadata:{},aud:"authenticated",created_at:new Date().toISOString(),role:"admin"},u=()=>"test_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),d=e=>{var t;if("undefined"==typeof document)return null;let s="; ".concat(document.cookie).split("; ".concat(e,"="));return 2===s.length&&(null===(t=s.pop())||void 0===t?void 0:t.split(";").shift())||null},h=e=>{let{children:t,serverSession:s=null}=e,[h,m]=(0,n.useState)(null),[g,f]=(0,n.useState)(null),[x,p]=(0,n.useState)(null),[j]=(0,n.useState)(()=>(0,a.createClientComponentClient)()),v=(0,i.useRouter)(),S=(0,n.useRef)(!1),y=(0,n.useCallback)(async e=>{if(!e||!e.email)return null;try{var t;let s=await fetch("/api/stripe/create-customer-for-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id,email:e.email,name:(null===(t=e.user_metadata)||void 0===t?void 0:t.full_name)||e.email.split("@")[0]})});if(!s.ok){let e=await s.text();return console.error("Failed to create Stripe customer:",e),null}let{customerId:r}=await s.json();return r}catch(e){return console.error("Error ensuring Stripe customer:",e),null}},[]),k=(0,n.useCallback)(async()=>{console.log("Checking auth state..."),"authenticated"===d("session")&&console.log("Found authenticated session cookie");let e=(0,o.$o)("testSession");if(e)try{return console.log("Found test session:",e),m(e.user),f(e.token),p(e.user.role||"customer"),document.cookie="hasTestSession=true; path=/",{isLoggedIn:!0,user:e.user}}catch(e){console.error("Error parsing test session:",e),(0,o.dZ)("testSession")}let{data:{session:t}}=await j.auth.getSession();if(console.log("Auth session:",t?"Exists":"None"),t){console.log("Setting logged in state to true"),m(t.user),f(t.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure");try{let{data:e,error:s}=await j.from("profiles").select("role").eq("id",t.user.id).single();!s&&e?p(e.role||"customer"):p("customer")}catch(e){console.error("Error fetching user role:",e),p("customer")}y(t.user)}else console.log("Setting logged in state to false"),m(null),f(null),p(null),document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure";return{isLoggedIn:!!t,user:(null==t?void 0:t.user)||null}},[j.auth,y]);(0,n.useEffect)(()=>{S.current||(k(),S.current=!0)},[k]),(0,n.useEffect)(()=>{let{data:{subscription:e}}=j.auth.onAuthStateChange(async(e,t)=>{console.log("Auth state changed:",{event:e,session:t}),t?(console.log("Auth state change: User logged in"),m(t.user),f(t.access_token),(0,o.qQ)("sessionToken",t.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure")):(0,o.$o)("testSession")||(console.log("Auth state change: User logged out"),m(null),f(null),(0,o.dZ)("sessionToken"),document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure")});return()=>{e.unsubscribe()}},[j.auth]);let b=async()=>{console.log("Creating test session");let e=u(),t={user:{...c,role:"admin"},token:e,created_at:new Date().toISOString()};(0,o.qQ)("testSession",t),(0,o.qQ)("sessionToken",e),document.cookie="hasTestSession=true; path=/; SameSite=Strict; Secure",document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure"),m(c),f(e),p("admin"),console.log("Test session created:",t)},N=async(e,t)=>{console.log("Attempting login with email:",e);try{await new Promise(e=>setTimeout(e,500));let{data:s,error:r}=await j.auth.signInWithPassword({email:e,password:t});if(r)throw console.error("Login error:",r),r;console.log("Login successful:",s.session?"Session exists":"No session"),s.session&&(m(s.session.user),f(s.session.access_token),(0,o.qQ)("sessionToken",s.session.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure"),console.log("Auth state updated after login"))}catch(e){throw console.error("Login process error:",e),e}},w=async()=>{(0,o.dZ)("testSession"),(0,o.dZ)("sessionToken"),document.cookie="hasTestSession=false; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure",document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure",await j.auth.signOut(),m(null),f(null),p(null),v.push("/")};return(0,r.jsx)(l.Provider,{value:{user:h,sessionToken:g,userRole:x,login:N,logout:w,checkAuth:k,createTestSession:b},children:t})},m=()=>{let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1657:function(e,t,s){"use strict";s.d(t,{$o:function(){return i},cn:function(){return a},dZ:function(){return l},qQ:function(){return o}});var r=s(7042),n=s(4769);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.m6)((0,r.W)(t))}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{let s=localStorage.getItem(e);if(null===s)return t;return JSON.parse(s)}catch(s){return console.error('Error reading localStorage key "'.concat(e,'":'),s),t}}function o(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(t){console.error('Error setting localStorage key "'.concat(e,'":'),t)}}function l(e){try{localStorage.removeItem(e)}catch(t){console.error('Error removing localStorage key "'.concat(e,'":'),t)}}}},function(e){e.O(0,[412,599,971,938,744],function(){return e(e.s=9591)}),_N_E=e.O()}]);