"use strict";(()=>{var e={};e.id=5889,e.ids=[5889],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},6005:e=>{e.exports=require("node:crypto")},84934:(e,t,r)=>{let o;r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>U,requestAsyncStorage:()=>R,routeModule:()=>y,serverHooks:()=>T,staticGenerationAsyncStorage:()=>x});var n={};r.r(n),r.d(n,{GET:()=>w});var a=r(49303),i=r(88716),s=r(60670),c=r(87070),l=r(84770);let u={randomUUID:l.randomUUID},d=new Uint8Array(256),p=d.length,g=[];for(let e=0;e<256;++e)g.push((e+256).toString(16).slice(1));let h=function(e,t,r){if(u.randomUUID&&!t&&!e)return u.randomUUID();let o=(e=e||{}).random??e.rng?.()??(p>d.length-16&&((0,l.randomFillSync)(d),p=0),d.slice(p,p+=16));if(o.length<16)throw Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=o[e];return t}return function(e,t=0){return(g[e[t+0]]+g[e[t+1]]+g[e[t+2]]+g[e[t+3]]+"-"+g[e[t+4]]+g[e[t+5]]+"-"+g[e[t+6]]+g[e[t+7]]+"-"+g[e[t+8]]+g[e[t+9]]+"-"+g[e[t+10]]+g[e[t+11]]+g[e[t+12]]+g[e[t+13]]+g[e[t+14]]+g[e[t+15]]).toLowerCase()}(o)};async function m(e){return(await o).getRandomValues(new Uint8Array(e))}async function f(e){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~",r="",o=await m(e);for(let n=0;n<e;n++){let e=o[n]%t.length;r+=t[e]}return r}async function k(e){return await f(e)}async function v(e){return btoa(String.fromCharCode(...new Uint8Array(await (await o).subtle.digest("SHA-256",new TextEncoder().encode(e))))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function _(e){if(e||(e=43),e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;let t=await k(e),r=await v(t);return{code_verifier:t,code_challenge:r}}async function w(){let e=process.env.TIKTOK_CLIENT_ID,t=process.env.TIKTOK_REDIRECT_URI;if(console.log("--- DEBUG: /api/tiktok/login ---"),console.log("TIKTOK_CLIENT_ID from env:",e),console.log("TIKTOK_REDIRECT_URI from env:",t),!e||!t)return console.error("TikTok Client ID or Redirect URI not configured in /api/tiktok/login"),c.NextResponse.json({error:"Server configuration error: TikTok Client ID or Redirect URI missing"},{status:500});let r=h(),o=await _(),n=o?.code_verifier,a=o?.code_challenge;if(console.log("PKCE object from pkceChallenge() (awaited):",o),console.log("Extracted code_verifier:",n),console.log("Extracted code_challenge:",a),!n||!a)return console.error("ERROR: Failed to generate PKCE code_verifier or code_challenge. PKCE object:",o),c.NextResponse.json({error:"Failed to generate PKCE challenge"},{status:500});let i=`tiktok_auth_state=${r}; Path=/; HttpOnly; SameSite=Lax; Max-Age=300; Secure=true;`,s=`tiktok_code_verifier=${n}; Path=/; HttpOnly; SameSite=Lax; Max-Age=300; Secure=true;`,l=new URL("https://www.tiktok.com/v2/auth/authorize");l.searchParams.append("client_key",e),l.searchParams.append("scope","user.info.basic,biz.creator.info,biz.creator.insights,video.list,tcm.order.update,user.info.username,user.info.stats,user.info.profile,user.account.type,user.insights,video.insights,comment.list,comment.list.manage,video.publish,video.upload,biz.spark.auth"),l.searchParams.append("response_type","code"),l.searchParams.append("redirect_uri",t),l.searchParams.append("state",r),l.searchParams.append("code_challenge",a),l.searchParams.append("code_challenge_method","S256"),console.log("Generated TikTok Authorization URL:",l.toString()),console.log("Setting state cookie with value:",r),console.log("Setting code_verifier cookie with value:",n);let u=c.NextResponse.redirect(l.toString());return u.headers.append("Set-Cookie",i),u.headers.append("Set-Cookie",s),u}o=globalThis.crypto?.webcrypto??globalThis.crypto??Promise.resolve().then(r.t.bind(r,6005,19)).then(e=>e.webcrypto);let y=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/tiktok/login/route",pathname:"/api/tiktok/login",filename:"route",bundlePath:"app/api/tiktok/login/route"},resolvedPagePath:"/Users/alexanderamundsen/hepta/hepta-3/app/api/tiktok/login/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:R,staticGenerationAsyncStorage:x,serverHooks:T}=y,b="/api/tiktok/login/route";function U(){return(0,s.patchFetch)({serverHooks:T,staticGenerationAsyncStorage:x})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972],()=>r(84934));module.exports=o})();