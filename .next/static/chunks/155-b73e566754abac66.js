(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[155],{4654:function(){},7376:function(e,t,r){"use strict";r.d(t,{R:function(){return j}});var s=r(7437),n=r(2265),a=r(7815),o=r(5754),i=r(1478),l=r(1568),c=r(3190),u=r(2601);(()=>{let e=u.env.STRIPE_SECRET_KEY;if(console.log("\n--- DEBUG: lib/stripe.ts -> getStripeInstance ---"),console.log("NODE_ENV:","production"),console.log("Raw STRIPE_SECRET_KEY from env:",e),!e)return console.warn("⚠️ lib/stripe.ts: STRIPE_SECRET_KEY is NOT SET in environment variables. Stripe operations will be mocked or fail.");if(e.startsWith("sk_live_"))console.warn("\uD83D\uDD34 lib/stripe.ts: WARNING: Attempting to use a LIVE Stripe key (sk_live_).");else if(e.startsWith("sk_test_"))console.log("✅ lib/stripe.ts: Using a TEST Stripe key (sk_test_). This is good for development.");else{let t=e.length>14?e.substring(0,7)+"..."+e.substring(e.length-4):e;return console.warn('⚠️ lib/stripe.ts: STRIPE_SECRET_KEY ("'.concat(t,'") does not look like a valid Stripe secret key (should start with sk_test_ or sk_live_).'))}try{let t=e.length>14?e.substring(0,7)+"..."+e.substring(e.length-4):e;console.log("lib/stripe.ts: Attempting to initialize Stripe with API key: ".concat(t));let r=new c.Z(e,{apiVersion:"2023-10-16",typescript:!0});return console.log("✅ lib/stripe.ts: Stripe initialized successfully."),r}catch(e){return console.error("❌ lib/stripe.ts: Failed to initialize Stripe with API key. Error:",e),null}})();let d=e=>e/100;var g=r(4033),m=r(8333),h=r(2442),f=r(6141),x=r(6637),p=r(1827),b=r(5817),v=r(4196),y=r(8203),S=r(3711),N=r(5179);function j(){let[e,t]=(0,n.useState)([]),[r,c]=(0,n.useState)(!0),[u,j]=(0,n.useState)(null),[w,k]=(0,n.useState)(""),[_,E]=(0,n.useState)("all"),T=(0,g.useRouter)(),{sessionToken:C,checkAuth:I}=(0,m.useAuth)();(0,n.useEffect)(()=>{(async()=>{try{var e;c(!0);let{isLoggedIn:r}=await I();console.log("Fetching invoices with auth state:",{isLoggedIn:r,hasToken:!!C});let s=await fetch("/api/stripe/get-invoices",{headers:{Authorization:"Bearer ".concat(C||"test_session")}});if(!s.ok){let e=await s.json().catch(()=>null),t=(null==e?void 0:e.error)||await s.text()||"HTTP error ".concat(s.status);throw console.error("Failed to fetch invoices:",t),Error("Failed to fetch invoices: ".concat(t))}let n=await s.json();console.log("Fetched invoices:",(null===(e=n.invoices)||void 0===e?void 0:e.length)||0),t(n.invoices||[])}catch(e){console.error("Error fetching invoices:",e),j(e.message||"Failed to load invoices"),t([{id:"in_mock_error_1",number:"ERROR001",amount_due:1e4,currency:"nok",status:"open",due_date:Math.floor(Date.now()/1e3)+2592e3,hosted_invoice_url:"#",created:Math.floor(Date.now()/1e3)-86400}])}finally{c(!1)}})()},[C,I]);let R=e=>{T.push("/faktura/betal?id=".concat(e))},A=e=>{switch(e){case"paid":return(0,s.jsxs)(i.C,{className:"bg-green-100 text-green-700 hover:bg-green-200 hover:text-green-800",children:[(0,s.jsx)(h.Z,{className:"mr-1 h-3 w-3"})," Betalt"]});case"open":return(0,s.jsxs)(i.C,{className:"bg-blue-100 text-blue-700 hover:bg-blue-200 hover:text-blue-800",children:[(0,s.jsx)(f.Z,{className:"mr-1 h-3 w-3"})," \xc5pen"]});case"draft":return(0,s.jsxs)(i.C,{className:"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:text-gray-800",children:[(0,s.jsx)(x.Z,{className:"mr-1 h-3 w-3"})," Utkast"]});case"uncollectible":return(0,s.jsx)(i.C,{className:"bg-red-100 text-red-700 hover:bg-red-200 hover:text-red-800",children:"Ikke innkrevbar"});case"void":return(0,s.jsx)(i.C,{className:"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:text-gray-800",children:"Annullert"});default:return(0,s.jsx)(i.C,{children:e})}},Z=e=>new Date(1e3*e).toLocaleDateString("no-NO",{year:"numeric",month:"2-digit",day:"2-digit"}),O=e.filter(e=>{let t=e.number.toLowerCase().includes(w.toLowerCase()),r="all"===_||e.status===_;return t&&r});return r?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-4",children:[(0,s.jsx)(l.O,{className:"h-10 w-64"}),(0,s.jsx)(l.O,{className:"h-10 w-32"})]}),(0,s.jsx)(l.O,{className:"h-[400px] w-full"})]}):u&&0===e.length?(0,s.jsx)(a.Zb,{className:"border-red-200 bg-red-50",children:(0,s.jsxs)(a.aY,{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-red-700",children:"Feil ved lasting av fakturaer"}),(0,s.jsx)("p",{className:"mt-2 text-gray-700",children:u}),(0,s.jsx)(o.z,{onClick:()=>window.location.reload(),variant:"outline",className:"mt-4",children:"Pr\xf8v igjen"})]})}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{className:"relative w-full md:w-64",children:[(0,s.jsx)(p.Z,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),(0,s.jsx)(N.I,{type:"search",placeholder:"S\xf8k faktura...",className:"bg-white pl-9 text-gray-900 border-gray-200 focus-visible:ring-blue-500",value:w,onChange:e=>k(e.target.value)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-[180px]",children:(0,s.jsxs)("select",{className:"w-full h-10 rounded-md border border-gray-200 bg-white text-gray-900 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:_,onChange:e=>E(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"Alle statuser"}),(0,s.jsx)("option",{value:"open",children:"\xc5pen"}),(0,s.jsx)("option",{value:"paid",children:"Betalt"}),(0,s.jsx)("option",{value:"draft",children:"Utkast"})]})}),(0,s.jsx)(o.z,{variant:"outline",size:"icon",className:"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:text-gray-900",children:(0,s.jsx)(b.Z,{className:"h-4 w-4"})})]})]}),0===O.length?(0,s.jsx)(a.Zb,{className:"border-gray-200 bg-white shadow-sm",children:(0,s.jsxs)(a.aY,{className:"p-12 text-center",children:[(0,s.jsx)(x.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,s.jsx)("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"Ingen fakturaer funnet"}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:w||"all"!==_?"Ingen fakturaer matcher dine s\xf8kekriterier.":"Du har ingen fakturaer for \xf8yeblikket."}),(w||"all"!==_)&&(0,s.jsx)(o.z,{variant:"outline",className:"mt-4 border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:text-gray-900",onClick:()=>{k(""),E("all")},children:"Tilbakestill filter"})]})}):(0,s.jsx)("div",{className:"rounded-md border border-gray-200 bg-white shadow-sm overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-200 bg-gray-50",children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:(0,s.jsxs)("div",{className:"flex items-center",children:["Faktura #",(0,s.jsx)(v.Z,{className:"ml-1 h-3 w-3"})]})}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Dato"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Forfallsdato"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-600",children:"Bel\xf8p"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-600",children:"Handlinger"})]})}),(0,s.jsx)("tbody",{children:O.map(e=>(0,s.jsxs)("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-4 py-3 font-medium text-gray-900",children:e.number}),(0,s.jsx)("td",{className:"px-4 py-3 text-gray-700",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(y.Z,{className:"mr-1.5 h-3.5 w-3.5 text-gray-500"}),Z(e.created)]})}),(0,s.jsx)("td",{className:"px-4 py-3 text-gray-700",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(y.Z,{className:"mr-1.5 h-3.5 w-3.5 text-gray-500"}),Z(e.due_date)]})}),(0,s.jsx)("td",{className:"px-4 py-3",children:A(e.status)}),(0,s.jsxs)("td",{className:"px-4 py-3 text-right font-medium text-gray-900",children:[d(e.amount_due).toFixed(2)," ",e.currency.toUpperCase()]}),(0,s.jsx)("td",{className:"px-4 py-3 text-right",children:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,s.jsxs)("button",{className:"h-8 w-8 rounded-md p-1 text-gray-500 hover:bg-gray-100 hover:text-gray-700",onClick:()=>"#"!==e.hosted_invoice_url?window.open(e.hosted_invoice_url,"_blank"):alert("Dette er en testfaktura uten ekstern URL."),children:[(0,s.jsx)(S.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Vis faktura"})]}),"open"===e.status&&(0,s.jsx)("button",{className:"rounded-md bg-blue-500 px-2 py-1 text-sm font-medium text-white hover:bg-blue-600",onClick:()=>R(e.id),children:"Betal n\xe5"})]})})]},e.id))})]})})})]})}},1478:function(e,t,r){"use strict";r.d(t,{C:function(){return i}});var s=r(7437);r(2265);var n=r(6061),a=r(1657);let o=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...n}=e;return(0,s.jsx)("div",{className:(0,a.cn)(o({variant:r}),t),...n})}},5754:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var s=r(7437),n=r(2265),a=r(7256),o=r(6061),i=r(1657);let l=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-blue-600 text-white hover:bg-blue-700",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:r,variant:n,size:o,asChild:c=!1,...u}=e,d=c?a.g7:"button";return(0,s.jsx)(d,{className:(0,i.cn)(l({variant:n,size:o,className:r})),ref:t,...u})});c.displayName="Button"},7815:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return o},aY:function(){return u},eW:function(){return d},ll:function(){return l}});var s=r(7437),n=r(2265),a=r(1657);let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...n})});o.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...n})});i.displayName="CardHeader";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...n})});l.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...n})});c.displayName="CardDescription";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...n})});u.displayName="CardContent";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...n})});d.displayName="CardFooter"},5179:function(e,t,r){"use strict";r.d(t,{I:function(){return o}});var s=r(7437),n=r(2265),a=r(1657);let o=n.forwardRef((e,t)=>{let{className:r,type:n,...o}=e;return(0,s.jsx)("input",{type:n,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...o})});o.displayName="Input"},1568:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});var s=r(7437),n=r(1657);function a(e){let{className:t,...r}=e;return(0,s.jsx)("div",{className:(0,n.cn)("animate-pulse rounded-md bg-muted",t),...r})}},8333:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return g},useAuth:function(){return m}});var s=r(7437),n=r(2265),a=r(448),o=r(4033),i=r(1657);let l=(0,n.createContext)({user:null,sessionToken:null,userRole:null,login:async()=>{},logout:async()=>{},checkAuth:async()=>({isLoggedIn:!1,user:null}),createTestSession:async()=>{}}),c={id:"test-user-id",email:"test@example.com",user_metadata:{full_name:"Test User"},app_metadata:{},aud:"authenticated",created_at:new Date().toISOString(),role:"admin"},u=()=>"test_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),d=e=>{var t;if("undefined"==typeof document)return null;let r="; ".concat(document.cookie).split("; ".concat(e,"="));return 2===r.length&&(null===(t=r.pop())||void 0===t?void 0:t.split(";").shift())||null},g=e=>{let{children:t,serverSession:r=null}=e,[g,m]=(0,n.useState)(null),[h,f]=(0,n.useState)(null),[x,p]=(0,n.useState)(null),[b]=(0,n.useState)(()=>(0,a.AY)("https://pwcibfnmmndbdwxdjmdj.supabase.co/","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3Y2liZm5tbW5kYmR3eGRqbWRqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwMDUxMTYsImV4cCI6MjA1NjU4MTExNn0.r7yjNeA4AWA2dd1y4MmS_unB7ERpSKNjWxNKHRGo6zU")),v=(0,o.useRouter)(),y=(0,n.useRef)(!1),S=(0,n.useCallback)(async e=>{if(!e||!e.email)return null;try{var t;let r=await fetch("/api/stripe/create-customer-for-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id,email:e.email,name:(null===(t=e.user_metadata)||void 0===t?void 0:t.full_name)||e.email.split("@")[0]})});if(!r.ok){let e=await r.text();return console.error("Failed to create Stripe customer:",e),null}let{customerId:s}=await r.json();return s}catch(e){return console.error("Error ensuring Stripe customer:",e),null}},[]),N=(0,n.useCallback)(async()=>{console.log("Checking auth state..."),"authenticated"===d("session")&&console.log("Found authenticated session cookie");let e=(0,i.$o)("testSession");if(e)try{return console.log("Found test session:",e),m(e.user),f(e.token),p(e.user.role||"customer"),document.cookie="hasTestSession=true; path=/",{isLoggedIn:!0,user:e.user}}catch(e){console.error("Error parsing test session:",e),(0,i.dZ)("testSession")}let{data:{session:t}}=await b.auth.getSession();if(console.log("Auth session:",t?"Exists":"None"),t){console.log("Setting logged in state to true"),m(t.user),f(t.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure");try{let{data:e,error:r}=await b.from("profiles").select("role").eq("id",t.user.id).single();!r&&e?p(e.role||"customer"):p("customer")}catch(e){console.error("Error fetching user role:",e),p("customer")}S(t.user)}else console.log("Setting logged in state to false"),m(null),f(null),p(null),document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure";return{isLoggedIn:!!t,user:(null==t?void 0:t.user)||null}},[b.auth,S]);(0,n.useEffect)(()=>{y.current||(N(),y.current=!0)},[N]),(0,n.useEffect)(()=>{let{data:{subscription:e}}=b.auth.onAuthStateChange(async(e,t)=>{console.log("Auth state changed:",{event:e,session:t}),t?(console.log("Auth state change: User logged in"),m(t.user),f(t.access_token),(0,i.qQ)("sessionToken",t.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure")):(0,i.$o)("testSession")||(console.log("Auth state change: User logged out"),m(null),f(null),(0,i.dZ)("sessionToken"),document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure")});return()=>{e.unsubscribe()}},[b.auth]);let j=async()=>{console.log("Creating test session");let e=u(),t={user:{...c,role:"admin"},token:e,created_at:new Date().toISOString()};(0,i.qQ)("testSession",t),(0,i.qQ)("sessionToken",e),document.cookie="hasTestSession=true; path=/; SameSite=Strict; Secure",document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure"),m(c),f(e),p("admin"),console.log("Test session created:",t)},w=async(e,t)=>{console.log("Attempting login with email:",e);try{await new Promise(e=>setTimeout(e,500));let{data:r,error:s}=await b.auth.signInWithPassword({email:e,password:t});if(s)throw console.error("Login error:",s),s;console.log("Login successful:",r.session?"Session exists":"No session"),r.session&&(m(r.session.user),f(r.session.access_token),(0,i.qQ)("sessionToken",r.session.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure"),console.log("Auth state updated after login"))}catch(e){throw console.error("Login process error:",e),e}},k=async()=>{(0,i.dZ)("testSession"),(0,i.dZ)("sessionToken"),document.cookie="hasTestSession=false; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure",document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure",await b.auth.signOut(),m(null),f(null),p(null),v.push("/")};return(0,s.jsx)(l.Provider,{value:{user:g,sessionToken:h,userRole:x,login:w,logout:k,checkAuth:N,createTestSession:j},children:t})},m=()=>{let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},1657:function(e,t,r){"use strict";r.d(t,{$o:function(){return o},cn:function(){return a},dZ:function(){return l},qQ:function(){return i}});var s=r(7042),n=r(4769);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,s.W)(t))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{let r=localStorage.getItem(e);if(null===r)return t;return JSON.parse(r)}catch(r){return console.error('Error reading localStorage key "'.concat(e,'":'),r),t}}function i(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(t){console.error('Error setting localStorage key "'.concat(e,'":'),t)}}function l(e){try{localStorage.removeItem(e)}catch(t){console.error('Error removing localStorage key "'.concat(e,'":'),t)}}}}]);