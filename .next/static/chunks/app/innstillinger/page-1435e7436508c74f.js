(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[90],{6777:function(e,t,s){Promise.resolve().then(s.bind(s,3626))},3626:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var r=s(7437),n=s(2265),a=s(2869),i=s(6070),o=s(5186),l=s(6815),c=s(721),d=s(4508);let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(c.fC,{className:(0,d.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...n,ref:t,children:(0,r.jsx)(c.bU,{className:(0,d.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});u.displayName=c.fC.displayName;var f=s(8730),m=s(2339),g=s(5452);function p(){let{user:e}=(0,f.a)(),t=(0,g.createClientComponentClient)(),[s,c]=(0,n.useState)({name:"",company:""}),[d,p]=(0,n.useState)({email:!0,marketing:!1,updates:!0}),[h,x]=(0,n.useState)(""),[v,y]=(0,n.useState)(""),[b,k]=(0,n.useState)(""),[j,S]=(0,n.useState)(!1),[w,N]=(0,n.useState)(null),[_,C]=(0,n.useState)(null),[T,I]=(0,n.useState)(!1),[F,P]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{if(e)try{console.log("Henter profil for bruker med ID:",e.id);let{data:s,error:r}=await t.from("profiles").select("name, company, notifications, stripe_customer_id, role").eq("user_id",e.id).single();if(r){console.error("Feil ved henting av profil:",r);let{count:s,error:n}=await t.from("profiles").select("*",{count:"exact",head:!0}).eq("user_id",e.id);if(n){console.error("Feil ved sjekk av profil:",n);return}if(0===s){console.log("Profil eksisterer ikke, oppretter ny");let{error:s}=await t.from("profiles").insert({user_id:e.id,name:"",company:"",notifications:{email:!0,marketing:!1,updates:!0},updated_at:new Date});s&&console.error("Feil ved opprettelse av profil:",s)}return}s&&(console.log("Mottok profildata:",s),c({name:s.name||"",company:s.company||""}),s.notifications&&(console.log("Setter notifications:",s.notifications),p(s.notifications)))}catch(e){console.error("Feil ved henting av brukerdata:",e)}})()},[e,t]);let O=e=>{let{id:t,value:s}=e.target;c(e=>({...e,[t]:s}))},E=async()=>{if(e){I(!0),N(null),C(null);try{let r;let{count:n,error:a}=await t.from("profiles").select("*",{count:"exact",head:!0}).eq("user_id",e.id);if(a)throw a;if(0===n){let{error:n}=await t.from("profiles").insert({user_id:e.id,name:s.name,company:s.company,notifications:d,updated_at:new Date});r=n}else{let{error:n}=await t.from("profiles").update({name:s.name,company:s.company,updated_at:new Date}).eq("user_id",e.id);r=n}if(r)throw console.error("Feil ved lagring:",r),r;C("Profilinformasjon lagret!")}catch(e){console.error("Feil ved lagring av profildata:",e),N("Kunne ikke lagre profilinformasjon.")}finally{I(!1)}}},R=async()=>{if(e){P(!0),N(null),C(null);try{let s;console.log("Lagrer varslingsinnstillinger:",d);let{count:r,error:n}=await t.from("profiles").select("*",{count:"exact",head:!0}).eq("user_id",e.id);if(n)throw n;if(0===r){let{error:r}=await t.from("profiles").insert({user_id:e.id,notifications:d,updated_at:new Date});s=r}else{let{error:r}=await t.from("profiles").update({notifications:d,updated_at:new Date}).eq("user_id",e.id);s=r}if(s)throw s;C("Varslingsinnstillinger lagret!")}catch(e){console.error("Feil ved lagring av varslingsinnstillinger:",e),N("Kunne ikke lagre varslingsinnstillinger.")}finally{P(!1)}}},A=async()=>{if(N(null),C(null),v!==b){N("Passordene er ikke like.");return}if(v.length<6){N("Passordet m\xe5 v\xe6re minst 6 tegn.");return}if(!h){N("Du m\xe5 skrive inn ditt n\xe5v\xe6rende passord.");return}S(!0);let{error:s}=await t.auth.signInWithPassword({email:(null==e?void 0:e.email)||"",password:h});if(s){N("Feil n\xe5v\xe6rende passord."),S(!1);return}let{error:r}=await t.auth.updateUser({password:v});S(!1),r?(console.error("Feil ved oppdatering av passord:",r.message),N("Kunne ikke oppdatere passordet.")):(C("Passordet er oppdatert!"),y(""),k(""),x(""))};return(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold",children:"Innstillinger"}),(0,r.jsxs)(m.mQ,{defaultValue:"profile",className:"w-full",children:[(0,r.jsxs)(m.dr,{className:"mb-6",children:[(0,r.jsx)(m.SP,{value:"profile",children:"Profil"}),(0,r.jsx)(m.SP,{value:"notifications",children:"Varsler"}),(0,r.jsx)(m.SP,{value:"security",children:"Sikkerhet"})]}),(0,r.jsx)(m.nU,{value:"profile",children:(0,r.jsxs)(i.Zb,{className:"border-gray-800 bg-gray-900/50",children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{children:"Profil"}),(0,r.jsx)(i.SZ,{children:"Administrer din profilinformasjon"})]}),(0,r.jsxs)(i.aY,{className:"space-y-4",children:[w&&(0,r.jsx)("p",{className:"text-red-500 text-sm",children:w}),_&&(0,r.jsx)("p",{className:"text-green-500 text-sm",children:_}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(l._,{htmlFor:"email",children:"E-post"}),(0,r.jsx)(o.I,{id:"email",defaultValue:(null==e?void 0:e.email)||"",readOnly:!0,className:"bg-gray-950/50"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(l._,{htmlFor:"name",children:"Navn"}),(0,r.jsx)(o.I,{id:"name",placeholder:"Ditt navn",className:"bg-gray-950/50",value:s.name,onChange:O})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(l._,{htmlFor:"company",children:"Selskap"}),(0,r.jsx)(o.I,{id:"company",placeholder:"Ditt selskap",className:"bg-gray-950/50",value:s.company,onChange:O})]}),(0,r.jsx)(a.z,{className:"mt-4 bg-orange-500 hover:bg-orange-600",onClick:E,disabled:T,children:T?"Lagrer...":"Lagre endringer"})]})]})}),(0,r.jsx)(m.nU,{value:"notifications",children:(0,r.jsxs)(i.Zb,{className:"border-gray-800 bg-gray-900/50",children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{children:"Varsler"}),(0,r.jsx)(i.SZ,{children:"Administrer dine varslingsinnstillinger"})]}),(0,r.jsxs)(i.aY,{className:"space-y-4",children:[w&&(0,r.jsx)("p",{className:"text-red-500 text-sm",children:w}),_&&(0,r.jsx)("p",{className:"text-green-500 text-sm",children:_}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:"E-postvarsler"}),(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Motta varsler via e-post"})]}),(0,r.jsx)(u,{checked:d.email,onCheckedChange:e=>p({...d,email:e})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:"Markedsf\xf8ring"}),(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Motta markedsf\xf8ringsinnhold"})]}),(0,r.jsx)(u,{checked:d.marketing,onCheckedChange:e=>p({...d,marketing:e})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:"Oppdateringer"}),(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Motta oppdateringer om nye funksjoner"})]}),(0,r.jsx)(u,{checked:d.updates,onCheckedChange:e=>p({...d,updates:e})})]}),(0,r.jsx)(a.z,{className:"mt-4 bg-orange-500 hover:bg-orange-600",onClick:R,disabled:F,children:F?"Lagrer...":"Lagre innstillinger"})]})]})}),(0,r.jsx)(m.nU,{value:"security",children:(0,r.jsxs)(i.Zb,{className:"border-gray-800 bg-gray-900/50",children:[(0,r.jsxs)(i.Ol,{children:[(0,r.jsx)(i.ll,{children:"Sikkerhet"}),(0,r.jsx)(i.SZ,{children:"Administrer dine sikkerhetsinnstillinger"})]}),(0,r.jsxs)(i.aY,{className:"space-y-4",children:[w&&(0,r.jsx)("p",{className:"text-red-500 text-sm",children:w}),_&&(0,r.jsx)("p",{className:"text-green-500 text-sm",children:_}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(l._,{htmlFor:"current-password",children:"N\xe5v\xe6rende passord"}),(0,r.jsx)(o.I,{id:"current-password",type:"password",className:"bg-gray-950/50",value:h,onChange:e=>x(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(l._,{htmlFor:"new-password",children:"Nytt passord"}),(0,r.jsx)(o.I,{id:"new-password",type:"password",className:"bg-gray-950/50",value:v,onChange:e=>y(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(l._,{htmlFor:"confirm-password",children:"Bekreft nytt passord"}),(0,r.jsx)(o.I,{id:"confirm-password",type:"password",className:"bg-gray-950/50",value:b,onChange:e=>k(e.target.value)})]}),(0,r.jsx)(a.z,{onClick:A,disabled:j,className:"mt-4 bg-orange-500 hover:bg-orange-600",children:j?"Oppdaterer...":"Oppdater passord"})]})]})})]})]})}},2869:function(e,t,s){"use strict";s.d(t,{z:function(){return c}});var r=s(7437),n=s(2265),a=s(7053),i=s(535),o=s(4508);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-blue-600 text-white hover:bg-blue-700",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:s,variant:n,size:i,asChild:c=!1,...d}=e,u=c?a.g7:"button";return(0,r.jsx)(u,{className:(0,o.cn)(l({variant:n,size:i,className:s})),ref:t,...d})});c.displayName="Button"},6070:function(e,t,s){"use strict";s.d(t,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var r=s(7437),n=s(2265),a=s(4508);let i=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});i.displayName="Card";let o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",s),...n})});o.displayName="CardHeader";let l=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});l.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",s),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",s),...n})});d.displayName="CardContent";let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",s),...n})});u.displayName="CardFooter"},5186:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var r=s(7437),n=s(2265),a=s(4508);let i=n.forwardRef((e,t)=>{let{className:s,type:n,...i}=e;return(0,r.jsx)("input",{type:n,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...i})});i.displayName="Input"},6815:function(e,t,s){"use strict";s.d(t,{_:function(){return c}});var r=s(7437),n=s(2265),a=s(6394),i=s(535),o=s(4508);let l=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.f,{ref:t,className:(0,o.cn)(l(),s),...n})});c.displayName=a.f.displayName},2339:function(e,t,s){"use strict";s.d(t,{SP:function(){return c},dr:function(){return l},mQ:function(){return o},nU:function(){return d}});var r=s(7437),n=s(2265),a=s(271),i=s(4508);let o=a.fC,l=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.aV,{ref:t,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...n})});l.displayName=a.aV.displayName;let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.xz,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...n})});c.displayName=a.xz.displayName;let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)(a.VY,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...n})});d.displayName=a.VY.displayName},8730:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return f},a:function(){return m}});var r=s(7437),n=s(2265),a=s(5452),i=s(9376),o=s(4508);let l=(0,n.createContext)({user:null,sessionToken:null,userRole:null,login:async()=>{},logout:async()=>{},checkAuth:async()=>({isLoggedIn:!1,user:null}),createTestSession:async()=>{}}),c={id:"test-user-id",email:"test@example.com",user_metadata:{full_name:"Test User"},app_metadata:{},aud:"authenticated",created_at:new Date().toISOString(),role:"admin"},d=()=>"test_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),u=e=>{var t;if("undefined"==typeof document)return null;let s="; ".concat(document.cookie).split("; ".concat(e,"="));return 2===s.length&&(null===(t=s.pop())||void 0===t?void 0:t.split(";").shift())||null},f=e=>{let{children:t,serverSession:s=null}=e,[f,m]=(0,n.useState)(null),[g,p]=(0,n.useState)(null),[h,x]=(0,n.useState)(null),[v]=(0,n.useState)(()=>(0,a.createClientComponentClient)()),y=(0,i.useRouter)(),b=(0,n.useRef)(!1),k=(0,n.useCallback)(async e=>{if(!e||!e.email)return null;try{var t;let s=await fetch("/api/stripe/create-customer-for-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id,email:e.email,name:(null===(t=e.user_metadata)||void 0===t?void 0:t.full_name)||e.email.split("@")[0]})});if(!s.ok){let e=await s.text();return console.error("Failed to create Stripe customer:",e),null}let{customerId:r}=await s.json();return r}catch(e){return console.error("Error ensuring Stripe customer:",e),null}},[]),j=(0,n.useCallback)(async()=>{console.log("Checking auth state..."),"authenticated"===u("session")&&console.log("Found authenticated session cookie");let e=(0,o.$o)("testSession");if(e)try{return console.log("Found test session:",e),m(e.user),p(e.token),x(e.user.role||"customer"),document.cookie="hasTestSession=true; path=/",{isLoggedIn:!0,user:e.user}}catch(e){console.error("Error parsing test session:",e),(0,o.dZ)("testSession")}let{data:{session:t}}=await v.auth.getSession();if(console.log("Auth session:",t?"Exists":"None"),t){console.log("Setting logged in state to true"),m(t.user),p(t.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure");try{let{data:e,error:s}=await v.from("profiles").select("role").eq("id",t.user.id).single();!s&&e?x(e.role||"customer"):x("customer")}catch(e){console.error("Error fetching user role:",e),x("customer")}k(t.user)}else console.log("Setting logged in state to false"),m(null),p(null),x(null),document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure";return{isLoggedIn:!!t,user:(null==t?void 0:t.user)||null}},[v.auth,k]);(0,n.useEffect)(()=>{b.current||(j(),b.current=!0)},[j]),(0,n.useEffect)(()=>{let{data:{subscription:e}}=v.auth.onAuthStateChange(async(e,t)=>{console.log("Auth state changed:",{event:e,session:t}),t?(console.log("Auth state change: User logged in"),m(t.user),p(t.access_token),(0,o.qQ)("sessionToken",t.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure")):(0,o.$o)("testSession")||(console.log("Auth state change: User logged out"),m(null),p(null),(0,o.dZ)("sessionToken"),document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure")});return()=>{e.unsubscribe()}},[v.auth]);let S=async()=>{console.log("Creating test session");let e=d(),t={user:{...c,role:"admin"},token:e,created_at:new Date().toISOString()};(0,o.qQ)("testSession",t),(0,o.qQ)("sessionToken",e),document.cookie="hasTestSession=true; path=/; SameSite=Strict; Secure",document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure"),m(c),p(e),x("admin"),console.log("Test session created:",t)},w=async(e,t)=>{console.log("Attempting login with email:",e);try{await new Promise(e=>setTimeout(e,500));let{data:s,error:r}=await v.auth.signInWithPassword({email:e,password:t});if(r)throw console.error("Login error:",r),r;console.log("Login successful:",s.session?"Session exists":"No session"),s.session&&(m(s.session.user),p(s.session.access_token),(0,o.qQ)("sessionToken",s.session.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure"),console.log("Auth state updated after login"))}catch(e){throw console.error("Login process error:",e),e}},N=async()=>{(0,o.dZ)("testSession"),(0,o.dZ)("sessionToken"),document.cookie="hasTestSession=false; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure",document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure",await v.auth.signOut(),m(null),p(null),x(null),y.push("/")};return(0,r.jsx)(l.Provider,{value:{user:f,sessionToken:g,userRole:h,login:w,logout:N,checkAuth:j,createTestSession:S},children:t})},m=()=>{let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4508:function(e,t,s){"use strict";s.d(t,{$o:function(){return i},cn:function(){return a},dZ:function(){return l},qQ:function(){return o}});var r=s(1994),n=s(3335);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.m6)((0,r.W)(t))}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{let s=localStorage.getItem(e);if(null===s)return t;return JSON.parse(s)}catch(s){return console.error('Error reading localStorage key "'.concat(e,'":'),s),t}}function o(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(t){console.error('Error setting localStorage key "'.concat(e,'":'),t)}}function l(e){try{localStorage.removeItem(e)}catch(t){console.error('Error removing localStorage key "'.concat(e,'":'),t)}}}},function(e){e.O(0,[569,523,247,11,971,117,744],function(){return e(e.s=6777)}),_N_E=e.O()}]);