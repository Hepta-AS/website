"use strict";exports.id=791,exports.ids=[791],exports.modules={60791:(e,t,s)=>{s.d(t,{R:()=>N});var r=s(95344),a=s(3729),l=s(61351),i=s(16212),n=s(69436),o=s(67951),c=s(91970);(()=>{let e=process.env.STRIPE_SECRET_KEY;if(console.log("\n--- DEBUG: lib/stripe.ts -> getStripeInstance ---"),console.log("NODE_ENV:","production"),console.log("Raw STRIPE_SECRET_KEY from env:",e),!e)return console.warn("⚠️ lib/stripe.ts: STRIPE_SECRET_KEY is NOT SET in environment variables. Stripe operations will be mocked or fail.");if(e.startsWith("sk_live_"))console.warn("\uD83D\uDD34 lib/stripe.ts: WARNING: Attempting to use a LIVE Stripe key (sk_live_).");else if(e.startsWith("sk_test_"))console.log("✅ lib/stripe.ts: Using a TEST Stripe key (sk_test_). This is good for development.");else{let t=e.length>14?e.substring(0,7)+"..."+e.substring(e.length-4):e;return console.warn(`⚠️ lib/stripe.ts: STRIPE_SECRET_KEY ("${t}") does not look like a valid Stripe secret key (should start with sk_test_ or sk_live_).`)}try{let t=e.length>14?e.substring(0,7)+"..."+e.substring(e.length-4):e;console.log(`lib/stripe.ts: Attempting to initialize Stripe with API key: ${t}`);let s=new c.Z(e,{apiVersion:"2023-10-16",typescript:!0});return console.log("✅ lib/stripe.ts: Stripe initialized successfully."),s}catch(e){return console.error("❌ lib/stripe.ts: Failed to initialize Stripe with API key. Error:",e),null}})();let d=e=>e/100;var x=s(22254),m=s(9046),u=s(62312),h=s(25545),g=s(37121),p=s(28765),f=s(96885),y=s(15682),b=s(55794),v=s(2768),j=s(92549);function N(){let[e,t]=(0,a.useState)([]),[s,c]=(0,a.useState)(!0),[N,w]=(0,a.useState)(null),[k,_]=(0,a.useState)(""),[C,E]=(0,a.useState)("all"),S=(0,x.useRouter)(),{sessionToken:R,checkAuth:T}=(0,m.useAuth)();(0,a.useEffect)(()=>{(async()=>{try{c(!0);let{isLoggedIn:e}=await T();console.log("Fetching invoices with auth state:",{isLoggedIn:e,hasToken:!!R});let s=await fetch("/api/stripe/get-invoices",{headers:{Authorization:`Bearer ${R||"test_session"}`}});if(!s.ok){let e=await s.json().catch(()=>null),t=e?.error||await s.text()||`HTTP error ${s.status}`;throw console.error("Failed to fetch invoices:",t),Error(`Failed to fetch invoices: ${t}`)}let r=await s.json();console.log("Fetched invoices:",r.invoices?.length||0),t(r.invoices||[])}catch(e){console.error("Error fetching invoices:",e),w(e.message||"Failed to load invoices"),t([{id:"in_mock_error_1",number:"ERROR001",amount_due:1e4,currency:"nok",status:"open",due_date:Math.floor(Date.now()/1e3)+2592e3,hosted_invoice_url:"#",created:Math.floor(Date.now()/1e3)-86400}])}finally{c(!1)}})()},[R,T]);let Z=e=>{S.push(`/faktura/betal?id=${e}`)},D=e=>{switch(e){case"paid":return(0,r.jsxs)(n.C,{className:"bg-green-100 text-green-700 hover:bg-green-200 hover:text-green-800",children:[r.jsx(u.Z,{className:"mr-1 h-3 w-3"})," Betalt"]});case"open":return(0,r.jsxs)(n.C,{className:"bg-blue-100 text-blue-700 hover:bg-blue-200 hover:text-blue-800",children:[r.jsx(h.Z,{className:"mr-1 h-3 w-3"})," \xc5pen"]});case"draft":return(0,r.jsxs)(n.C,{className:"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:text-gray-800",children:[r.jsx(g.Z,{className:"mr-1 h-3 w-3"})," Utkast"]});case"uncollectible":return r.jsx(n.C,{className:"bg-red-100 text-red-700 hover:bg-red-200 hover:text-red-800",children:"Ikke innkrevbar"});case"void":return r.jsx(n.C,{className:"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:text-gray-800",children:"Annullert"});default:return r.jsx(n.C,{children:e})}},I=e=>new Date(1e3*e).toLocaleDateString("no-NO",{year:"numeric",month:"2-digit",day:"2-digit"}),F=e.filter(e=>{let t=e.number.toLowerCase().includes(k.toLowerCase()),s="all"===C||e.status===C;return t&&s});return s?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-4",children:[r.jsx(o.O,{className:"h-10 w-64"}),r.jsx(o.O,{className:"h-10 w-32"})]}),r.jsx(o.O,{className:"h-[400px] w-full"})]}):N&&0===e.length?r.jsx(l.Zb,{className:"border-red-200 bg-red-50",children:(0,r.jsxs)(l.aY,{className:"p-6",children:[r.jsx("h3",{className:"text-lg font-medium text-red-700",children:"Feil ved lasting av fakturaer"}),r.jsx("p",{className:"mt-2 text-gray-700",children:N}),r.jsx(i.z,{onClick:()=>window.location.reload(),variant:"outline",className:"mt-4",children:"Pr\xf8v igjen"})]})}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,r.jsxs)("div",{className:"relative w-full md:w-64",children:[r.jsx(p.Z,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),r.jsx(j.I,{type:"search",placeholder:"S\xf8k faktura...",className:"bg-white pl-9 text-gray-900 border-gray-200 focus-visible:ring-blue-500",value:k,onChange:e=>_(e.target.value)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-[180px]",children:(0,r.jsxs)("select",{className:"w-full h-10 rounded-md border border-gray-200 bg-white text-gray-900 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:C,onChange:e=>E(e.target.value),children:[r.jsx("option",{value:"all",children:"Alle statuser"}),r.jsx("option",{value:"open",children:"\xc5pen"}),r.jsx("option",{value:"paid",children:"Betalt"}),r.jsx("option",{value:"draft",children:"Utkast"})]})}),r.jsx(i.z,{variant:"outline",size:"icon",className:"border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:text-gray-900",children:r.jsx(f.Z,{className:"h-4 w-4"})})]})]}),0===F.length?r.jsx(l.Zb,{className:"border-gray-200 bg-white shadow-sm",children:(0,r.jsxs)(l.aY,{className:"p-12 text-center",children:[r.jsx(g.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),r.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"Ingen fakturaer funnet"}),r.jsx("p",{className:"mt-2 text-gray-600",children:k||"all"!==C?"Ingen fakturaer matcher dine s\xf8kekriterier.":"Du har ingen fakturaer for \xf8yeblikket."}),(k||"all"!==C)&&r.jsx(i.z,{variant:"outline",className:"mt-4 border-gray-200 bg-white text-gray-700 hover:bg-gray-50 hover:text-gray-900",onClick:()=>{_(""),E("all")},children:"Tilbakestill filter"})]})}):r.jsx("div",{className:"rounded-md border border-gray-200 bg-white shadow-sm overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-200 bg-gray-50",children:[r.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:(0,r.jsxs)("div",{className:"flex items-center",children:["Faktura #",r.jsx(y.Z,{className:"ml-1 h-3 w-3"})]})}),r.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Dato"}),r.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Forfallsdato"}),r.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-600",children:"Status"}),r.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-600",children:"Bel\xf8p"}),r.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-600",children:"Handlinger"})]})}),r.jsx("tbody",{children:F.map(e=>(0,r.jsxs)("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[r.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:e.number}),r.jsx("td",{className:"px-4 py-3 text-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(b.Z,{className:"mr-1.5 h-3.5 w-3.5 text-gray-500"}),I(e.created)]})}),r.jsx("td",{className:"px-4 py-3 text-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(b.Z,{className:"mr-1.5 h-3.5 w-3.5 text-gray-500"}),I(e.due_date)]})}),r.jsx("td",{className:"px-4 py-3",children:D(e.status)}),(0,r.jsxs)("td",{className:"px-4 py-3 text-right font-medium text-gray-900",children:[d(e.amount_due).toFixed(2)," ",e.currency.toUpperCase()]}),r.jsx("td",{className:"px-4 py-3 text-right",children:(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,r.jsxs)("button",{className:"h-8 w-8 rounded-md p-1 text-gray-500 hover:bg-gray-100 hover:text-gray-700",onClick:()=>"#"!==e.hosted_invoice_url?window.open(e.hosted_invoice_url,"_blank"):alert("Dette er en testfaktura uten ekstern URL."),children:[r.jsx(v.Z,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Vis faktura"})]}),"open"===e.status&&r.jsx("button",{className:"rounded-md bg-blue-500 px-2 py-1 text-sm font-medium text-white hover:bg-blue-600",onClick:()=>Z(e.id),children:"Betal n\xe5"})]})})]},e.id))})]})})})]})}},69436:(e,t,s)=>{s.d(t,{C:()=>n});var r=s(95344);s(3729);var a=s(49247),l=s(91626);let i=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n({className:e,variant:t,...s}){return r.jsx("div",{className:(0,l.cn)(i({variant:t}),e),...s})}},61351:(e,t,s)=>{s.d(t,{Ol:()=>n,SZ:()=>c,Zb:()=>i,aY:()=>d,eW:()=>x,ll:()=>o});var r=s(95344),a=s(3729),l=s(91626);let i=a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));i.displayName="Card";let n=a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",e),...t}));n.displayName="CardHeader";let o=a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));o.displayName="CardTitle";let c=a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",e),...t}));c.displayName="CardDescription";let d=a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent";let x=a.forwardRef(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,l.cn)("flex items-center p-6 pt-0",e),...t}));x.displayName="CardFooter"},67951:(e,t,s)=>{s.d(t,{O:()=>l});var r=s(95344),a=s(91626);function l({className:e,...t}){return r.jsx("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",e),...t})}}};