"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[273],{2869:function(e,t,n){n.d(t,{z:function(){return c}});var r=n(7437),o=n(2265),s=n(7053),a=n(535),i=n(4508);let u=(0,a.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-blue-600 text-white hover:bg-blue-700",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=o.forwardRef((e,t)=>{let{className:n,variant:o,size:a,asChild:c=!1,...l}=e,d=c?s.g7:"button";return(0,r.jsx)(d,{className:(0,i.cn)(u({variant:o,size:a,className:n})),ref:t,...l})});c.displayName="Button"},6070:function(e,t,n){n.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return a},aY:function(){return l},eW:function(){return d},ll:function(){return u}});var r=n(7437),o=n(2265),s=n(4508);let a=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...o})});a.displayName="Card";let i=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",n),...o})});i.displayName="CardHeader";let u=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",n),...o})});u.displayName="CardTitle";let c=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",n),...o})});c.displayName="CardDescription";let l=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",n),...o})});l.displayName="CardContent";let d=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",n),...o})});d.displayName="CardFooter"},3022:function(e,t,n){n.d(t,{O:function(){return s}});var r=n(7437),o=n(4508);function s(e){let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,o.cn)("animate-pulse rounded-md bg-muted",t),...n})}},8730:function(e,t,n){n.d(t,{AuthProvider:function(){return g},a:function(){return f}});var r=n(7437),o=n(2265),s=n(5452),a=n(9376),i=n(4508);let u=(0,o.createContext)({user:null,sessionToken:null,userRole:null,login:async()=>{},logout:async()=>{},checkAuth:async()=>({isLoggedIn:!1,user:null}),createTestSession:async()=>{}}),c={id:"test-user-id",email:"test@example.com",user_metadata:{full_name:"Test User"},app_metadata:{},aud:"authenticated",created_at:new Date().toISOString(),role:"admin"},l=()=>"test_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),d=e=>{var t;if("undefined"==typeof document)return null;let n="; ".concat(document.cookie).split("; ".concat(e,"="));return 2===n.length&&(null===(t=n.pop())||void 0===t?void 0:t.split(";").shift())||null},g=e=>{let{children:t,serverSession:n=null}=e,[g,f]=(0,o.useState)(null),[h,m]=(0,o.useState)(null),[p,S]=(0,o.useState)(null),[v]=(0,o.useState)(()=>(0,s.createClientComponentClient)()),k=(0,a.useRouter)(),y=(0,o.useRef)(!1),x=(0,o.useCallback)(async e=>{if(!e||!e.email)return null;try{var t;let n=await fetch("/api/stripe/create-customer-for-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id,email:e.email,name:(null===(t=e.user_metadata)||void 0===t?void 0:t.full_name)||e.email.split("@")[0]})});if(!n.ok){let e=await n.text();return console.error("Failed to create Stripe customer:",e),null}let{customerId:r}=await n.json();return r}catch(e){return console.error("Error ensuring Stripe customer:",e),null}},[]),w=(0,o.useCallback)(async()=>{console.log("Checking auth state..."),"authenticated"===d("session")&&console.log("Found authenticated session cookie");let e=(0,i.$o)("testSession");if(e)try{return console.log("Found test session:",e),f(e.user),m(e.token),S(e.user.role||"customer"),document.cookie="hasTestSession=true; path=/",{isLoggedIn:!0,user:e.user}}catch(e){console.error("Error parsing test session:",e),(0,i.dZ)("testSession")}let{data:{session:t}}=await v.auth.getSession();if(console.log("Auth session:",t?"Exists":"None"),t){console.log("Setting logged in state to true"),f(t.user),m(t.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure");try{let{data:e,error:n}=await v.from("profiles").select("role").eq("id",t.user.id).single();!n&&e?S(e.role||"customer"):S("customer")}catch(e){console.error("Error fetching user role:",e),S("customer")}x(t.user)}else console.log("Setting logged in state to false"),f(null),m(null),S(null),document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure";return{isLoggedIn:!!t,user:(null==t?void 0:t.user)||null}},[v.auth,x]);(0,o.useEffect)(()=>{y.current||(w(),y.current=!0)},[w]),(0,o.useEffect)(()=>{let{data:{subscription:e}}=v.auth.onAuthStateChange(async(e,t)=>{console.log("Auth state changed:",{event:e,session:t}),t?(console.log("Auth state change: User logged in"),f(t.user),m(t.access_token),(0,i.qQ)("sessionToken",t.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure")):(0,i.$o)("testSession")||(console.log("Auth state change: User logged out"),f(null),m(null),(0,i.dZ)("sessionToken"),document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure")});return()=>{e.unsubscribe()}},[v.auth]);let b=async()=>{console.log("Creating test session");let e=l(),t={user:{...c,role:"admin"},token:e,created_at:new Date().toISOString()};(0,i.qQ)("testSession",t),(0,i.qQ)("sessionToken",e),document.cookie="hasTestSession=true; path=/; SameSite=Strict; Secure",document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure"),f(c),m(e),S("admin"),console.log("Test session created:",t)},N=async(e,t)=>{console.log("Attempting login with email:",e);try{await new Promise(e=>setTimeout(e,500));let{data:n,error:r}=await v.auth.signInWithPassword({email:e,password:t});if(r)throw console.error("Login error:",r),r;console.log("Login successful:",n.session?"Session exists":"No session"),n.session&&(f(n.session.user),m(n.session.access_token),(0,i.qQ)("sessionToken",n.session.access_token),document.cookie="session=authenticated; path=/; max-age=".concat(604800,"; SameSite=Strict; Secure"),console.log("Auth state updated after login"))}catch(e){throw console.error("Login process error:",e),e}},C=async()=>{(0,i.dZ)("testSession"),(0,i.dZ)("sessionToken"),document.cookie="hasTestSession=false; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure",document.cookie="session=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Strict; Secure",await v.auth.signOut(),f(null),m(null),S(null),k.push("/")};return(0,r.jsx)(u.Provider,{value:{user:g,sessionToken:h,userRole:p,login:N,logout:C,checkAuth:w,createTestSession:b},children:t})},f=()=>{let e=(0,o.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4508:function(e,t,n){n.d(t,{$o:function(){return a},cn:function(){return s},dZ:function(){return u},qQ:function(){return i}});var r=n(1994),o=n(3335);function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.m6)((0,r.W)(t))}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{let n=localStorage.getItem(e);if(null===n)return t;return JSON.parse(n)}catch(n){return console.error('Error reading localStorage key "'.concat(e,'":'),n),t}}function i(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(t){console.error('Error setting localStorage key "'.concat(e,'":'),t)}}function u(e){try{localStorage.removeItem(e)}catch(t){console.error('Error removing localStorage key "'.concat(e,'":'),t)}}},9763:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(2265),o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),a=(e,t)=>{let n=(0,r.forwardRef)((n,a)=>{let{color:i="currentColor",size:u=24,strokeWidth:c=2,absoluteStrokeWidth:l,className:d="",children:g,...f}=n;return(0,r.createElement)("svg",{ref:a,...o,width:u,height:u,stroke:i,strokeWidth:l?24*Number(c)/Number(u):c,className:["lucide","lucide-".concat(s(e)),d].join(" "),...f},[...t.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(g)?g:[g]])});return n.displayName="".concat(e),n}},7168:function(e,t,n){n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}}]);