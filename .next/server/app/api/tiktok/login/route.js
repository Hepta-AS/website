(()=>{var e={};e.id=5889,e.ids=[5889],e.modules={30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},64340:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>U,originalPathname:()=>I,patchFetch:()=>C,requestAsyncStorage:()=>S,routeModule:()=>k,serverHooks:()=>B,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>b});var n={};r.r(n),r.d(n,{GET:()=>A});var i=r(95419),o=r(69108),a=r(99678),s=r(78070),c=r(6113),u=r.n(c);let l={randomUUID:u().randomUUID},f=new Uint8Array(256),h=f.length,p=[];for(let e=0;e<256;++e)p.push((e+256).toString(16).slice(1));let d=function(e,t,r){if(l.randomUUID&&!t&&!e)return l.randomUUID();let n=(e=e||{}).random||(e.rng||function(){return h>f.length-16&&(u().randomFillSync(f),h=0),f.slice(h,h+=16)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]}(n)};var g=r(17282),y=r.n(g),v=r(72619),m=r.n(v),_=r(27511),w=r.n(_);async function A(){let e=process.env.TIKTOK_CLIENT_ID,t=process.env.TIKTOK_REDIRECT_URI;if(console.log("--- DEBUG: /api/tiktok/login ---"),console.log("TIKTOK_CLIENT_ID from env:",e),console.log("TIKTOK_REDIRECT_URI from env:",t),!e||!t)return console.error("TikTok Client ID or Redirect URI not configured in /api/tiktok/login"),s.Z.json({error:"Server configuration error: TikTok Client ID or Redirect URI missing"},{status:500});let r=d(),n=await function(e){if(e||(e=43),e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;let t=function(e){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~",r="",n=function(e){let t=y().random(e),r=[];return t.words.forEach(e=>{let t=function(e){let t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e,!1),t}(e),n=new Uint8Array(t);for(let e=0;e<4;e++)r.push(n[e])}),r}(e);for(let i=0;i<e;i++){let e=n[i]%t.length;r+=t[e]}return r}(e),r=m()(t).toString(w());return{code_verifier:t,code_challenge:r}}(),i=n?.code_verifier,o=n?.code_challenge;if(console.log("PKCE object from pkceChallenge() (awaited):",n),console.log("Extracted code_verifier:",i),console.log("Extracted code_challenge:",o),!i||!o)return console.error("ERROR: Failed to generate PKCE code_verifier or code_challenge. PKCE object:",n),s.Z.json({error:"Failed to generate PKCE challenge"},{status:500});let a=`tiktok_auth_state=${r}; Path=/; HttpOnly; SameSite=Lax; Max-Age=300; Secure=true;`,c=`tiktok_code_verifier=${i}; Path=/; HttpOnly; SameSite=Lax; Max-Age=300; Secure=true;`,u=new URL("https://www.tiktok.com/v2/auth/authorize");u.searchParams.append("client_key",e),u.searchParams.append("scope","user.info.basic,biz.creator.info,biz.creator.insights,video.list,tcm.order.update,user.info.username,user.info.stats,user.info.profile,user.account.type,user.insights,video.insights,comment.list,comment.list.manage,video.publish,video.upload,biz.spark.auth"),u.searchParams.append("response_type","code"),u.searchParams.append("redirect_uri",t),u.searchParams.append("state",r),u.searchParams.append("code_challenge",o),u.searchParams.append("code_challenge_method","S256"),console.log("Generated TikTok Authorization URL:",u.toString()),console.log("Setting state cookie with value:",r),console.log("Setting code_verifier cookie with value:",i);let l=s.Z.redirect(u.toString());return l.headers.append("Set-Cookie",a),l.headers.append("Set-Cookie",c),l}let k=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/tiktok/login/route",pathname:"/api/tiktok/login",filename:"route",bundlePath:"app/api/tiktok/login/route"},resolvedPagePath:"/Users/alexanderamundsen/hepta/hepta-3/app/api/tiktok/login/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:S,staticGenerationAsyncStorage:x,serverHooks:B,headerHooks:U,staticGenerationBailout:b}=k,I="/api/tiktok/login/route";function C(){return(0,a.patchFetch)({serverHooks:B,staticGenerationAsyncStorage:x})}},63352:function(e,t,r){var n;e.exports=n||function(e,t){if("undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof global&&global.crypto&&(n=global.crypto),!n)try{n=r(6113)}catch(e){}var n,i=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),a={},s=a.lib={},c=s.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=s.WordArray=c.extend({init:function(e,t){e=this.words=e||[],void 0!=t?this.sigBytes=t:this.sigBytes=4*e.length},toString:function(e){return(e||f).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(i());return new u.init(t,e)}}),l=a.enc={},f=l.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new u.init(r,t/2)}},h=l.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new u.init(r,t)}},p=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},d=s.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,o=n.sigBytes,a=this.blockSize,s=o/(4*a),c=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,l=e.min(4*c,o);if(c){for(var f=0;f<c;f+=a)this._doProcessBlock(i,f);r=i.splice(0,c),n.sigBytes-=l}return new u.init(r,l)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});s.Hasher=d.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new g.HMAC.init(e,r).finalize(t)}}});var g=a.algo={};return a}(Math)},27511:function(e,t,r){var n,i;e.exports=(i=(n=r(63352)).lib.WordArray,n.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var r=e.words,n=e.sigBytes,i=t?this._safe_map:this._map;e.clamp();for(var o=[],a=0;a<n;a+=3)for(var s=(r[a>>>2]>>>24-a%4*8&255)<<16|(r[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|r[a+2>>>2]>>>24-(a+2)%4*8&255,c=0;c<4&&a+.75*c<n;c++)o.push(i.charAt(s>>>6*(3-c)&63));var u=i.charAt(64);if(u)for(;o.length%4;)o.push(u);return o.join("")},parse:function(e,t){void 0===t&&(t=!0);var r=e.length,n=t?this._safe_map:this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var a=0;a<n.length;a++)o[n.charCodeAt(a)]=a}var s=n.charAt(64);if(s){var c=e.indexOf(s);-1!==c&&(r=c)}return function(e,t,r){for(var n=[],o=0,a=0;a<t;a++)if(a%4){var s=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2;n[o>>>2]|=s<<24-o%4*8,o++}return i.create(n,o)}(e,r,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"},n.enc.Base64url)},17282:function(e,t,r){var n;e.exports=(n=r(63352),function(){if("function"==typeof ArrayBuffer){var e=n.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var r=e.byteLength,n=[],i=0;i<r;i++)n[i>>>2]|=e[i]<<24-i%4*8;t.call(this,n,r)}else t.apply(this,arguments)}).prototype=e}}(),n.lib.WordArray)},72619:function(e,t,r){var n,i,o,a,s,c,u,l,f,h;e.exports=(n=r(63352),i=Math,a=(o=n.lib).WordArray,s=o.Hasher,c=n.algo,u=[],l=[],function(){function e(e){return(e-(0|e))*4294967296|0}for(var t=2,r=0;r<64;)(function(e){for(var t=i.sqrt(e),r=2;r<=t;r++)if(!(e%r))return!1;return!0})(t)&&(r<8&&(u[r]=e(i.pow(t,.5))),l[r]=e(i.pow(t,1/3)),r++),t++}(),f=[],h=c.SHA256=s.extend({_doReset:function(){this._hash=new a.init(u.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],c=r[5],u=r[6],h=r[7],p=0;p<64;p++){if(p<16)f[p]=0|e[t+p];else{var d=f[p-15],g=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,y=f[p-2],v=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;f[p]=g+f[p-7]+v+f[p-16]}var m=s&c^~s&u,_=n&i^n&o^i&o,w=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),A=h+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+m+l[p]+f[p],k=w+_;h=u,u=c,c=s,s=a+A|0,a=o,o=i,i=n,n=A+k|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0,r[5]=r[5]+c|0,r[6]=r[6]+u|0,r[7]=r[7]+h|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[(n+64>>>9<<4)+14]=i.floor(r/4294967296),t[(n+64>>>9<<4)+15]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),n.SHA256=s._createHelper(h),n.HmacSHA256=s._createHmacHelper(h),n.SHA256)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[1638,6206],()=>r(64340));module.exports=n})();