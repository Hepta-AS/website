(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{9280:function(e,r,t){Promise.resolve().then(t.bind(t,722))},722:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return j}});var s=t(7437),a=t(2265),n=t(2869),i=t(6070),l=t(5186),c=t(6815),d=t(3022),o=t(8730),u=t(7168),m=t(3247),f=t(5863),x=t(9763);let h=(0,x.Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),p=(0,x.Z)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);var g=t(5974),b=t(9376);function j(){let{sessionToken:e,userRole:r}=(0,o.a)(),t=(0,b.useRouter)(),[x,j]=(0,a.useState)([]),[y,v]=(0,a.useState)(!0),[N,k]=(0,a.useState)(null),[w,_]=(0,a.useState)(""),[S,C]=(0,a.useState)(null),[Z,O]=(0,a.useState)(""),[E,I]=(0,a.useState)(null),[F="admin"===r,z]=(0,a.useState)("admin"===r);if((0,a.useEffect)(()=>{F||t.push("/dashboard")},[F,t]),!F)return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold",children:"Administrer brukere"}),(0,s.jsxs)(i.Zb,{className:"border-red-800 bg-red-900/20",children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{children:"Ingen tilgang"})}),(0,s.jsxs)(i.aY,{children:[(0,s.jsx)("p",{className:"text-red-400",children:"Du har ikke tilgang til denne siden. Kun administratorer kan se denne siden."}),(0,s.jsx)(n.z,{onClick:()=>t.push("/dashboard"),variant:"outline",className:"mt-4",children:"Tilbake til dashboard"})]})]})]});let P=async()=>{try{v(!0),k(null);let r=await fetch("/api/admin/users",{headers:{Authorization:"Bearer ".concat(e||"test_session")}});if(!r.ok)throw Error("Failed to fetch users: ".concat(await r.text()));let t=await r.json();j(t.users||[])}catch(e){console.error("Error fetching users:",e),k(e instanceof Error?e.message:"Failed to fetch users")}finally{v(!1)}};(0,a.useEffect)(()=>{P()},[e]);let D=async(r,t,s)=>{try{C(r);let a=await fetch("/api/admin/create-stripe-customer",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e||"test_session")},body:JSON.stringify({userId:r,email:t,name:s})});if(!a.ok)throw Error("Failed to create Stripe customer: ".concat(await a.text()));let n=await a.json();return j(x.map(e=>e.id===r?{...e,stripe_customer_id:n.customerId}:e)),n.customerId}catch(e){return console.error("Error creating Stripe customer:",e),alert(e instanceof Error?e.message:"Failed to create Stripe customer"),null}finally{C(null)}},L=async r=>{if(!Z){alert("Please enter a Stripe customer ID");return}try{I(r);let t=await fetch("/api/admin/assign-stripe-customer",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e||"test_session")},body:JSON.stringify({userId:r,customerId:Z})});if(!t.ok)throw Error("Failed to assign Stripe customer: ".concat(await t.text()));j(x.map(e=>e.id===r?{...e,stripe_customer_id:Z}:e)),O("")}catch(e){console.error("Error assigning Stripe customer:",e),alert(e instanceof Error?e.message:"Failed to assign Stripe customer")}finally{I(null)}},A=x.filter(e=>{var r,t,s;return(null===(r=e.email)||void 0===r?void 0:r.toLowerCase().includes(w.toLowerCase()))||(null===(t=e.full_name)||void 0===t?void 0:t.toLowerCase().includes(w.toLowerCase()))||(null===(s=e.stripe_customer_id)||void 0===s?void 0:s.includes(w))});return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold",children:"Administrer brukere"}),(0,s.jsxs)(n.z,{onClick:P,variant:"outline",className:"gap-2",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4"}),"Oppdater"]})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(m.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-500"}),(0,s.jsx)(l.I,{placeholder:"S\xf8k etter brukere...",className:"pl-10",value:w,onChange:e=>_(e.target.value)})]}),y?(0,s.jsx)("div",{className:"space-y-4",children:[1,2,3].map(e=>(0,s.jsxs)(i.Zb,{className:"border-gray-800 bg-gray-900/50",children:[(0,s.jsx)(i.Ol,{className:"pb-2",children:(0,s.jsx)(d.O,{className:"h-6 w-1/3"})}),(0,s.jsx)(i.aY,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(d.O,{className:"h-5 w-1/4"}),(0,s.jsx)(d.O,{className:"h-9 w-24"})]})})]},e))}):N?(0,s.jsxs)(i.Zb,{className:"border-red-800 bg-red-900/20",children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{children:"Feil ved lasting av brukere"})}),(0,s.jsxs)(i.aY,{children:[(0,s.jsx)("p",{className:"text-red-400",children:N}),(0,s.jsx)(n.z,{onClick:P,variant:"outline",className:"mt-4",children:"Pr\xf8v igjen"})]})]}):0===A.length?(0,s.jsx)(i.Zb,{className:"border-gray-800 bg-gray-900/50",children:(0,s.jsxs)(i.Ol,{children:[(0,s.jsx)(i.ll,{children:"Ingen brukere funnet"}),(0,s.jsx)(i.SZ,{children:w?"Ingen brukere matcher s\xf8ket ditt.":"Det er ingen brukere i systemet enn\xe5."})]})}):(0,s.jsx)("div",{className:"space-y-4",children:A.map(e=>(0,s.jsxs)(i.Zb,{className:"border-gray-800 bg-gray-900/50",children:[(0,s.jsxs)(i.Ol,{className:"pb-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(i.ll,{children:e.full_name||e.email}),e.stripe_customer_id?(0,s.jsx)(g.C,{className:"bg-green-600",children:"Stripe kunde"}):(0,s.jsx)(g.C,{className:"bg-gray-600",children:"Ingen Stripe kunde"})]}),(0,s.jsx)(i.SZ,{children:e.email})]}),(0,s.jsxs)(i.aY,{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("div",{children:e.stripe_customer_id?(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Stripe kunde ID:"})," ",(0,s.jsx)("code",{className:"bg-gray-800 px-1 py-0.5 rounded text-xs",children:e.stripe_customer_id})]}):(0,s.jsx)("div",{className:"text-sm text-gray-400",children:"Ingen Stripe kunde tilknyttet"})}),(0,s.jsx)(n.z,{onClick:()=>D(e.id,e.email,e.full_name),disabled:!!S||!!e.stripe_customer_id,className:"gap-2",children:S===e.id?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Z,{className:"h-4 w-4 animate-spin"}),"Oppretter..."]}):e.stripe_customer_id?"Allerede opprettet":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h,{className:"h-4 w-4"}),"Opprett Stripe kunde"]})})]}),!e.stripe_customer_id&&(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-800",children:[(0,s.jsx)(c._,{htmlFor:"manual-customer-".concat(e.id),className:"text-sm text-gray-400 mb-2 block",children:"Eller tilknytt eksisterende Stripe kunde ID:"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(l.I,{id:"manual-customer-".concat(e.id),placeholder:"cus_...",value:e.id===E?Z:"",onChange:e=>O(e.target.value)}),(0,s.jsx)(n.z,{onClick:()=>L(e.id),disabled:!!E||!Z,variant:"outline",className:"gap-2",children:E===e.id?(0,s.jsx)(f.Z,{className:"h-4 w-4 animate-spin"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p,{className:"h-4 w-4"}),"Tilknytt"]})})]})]})]})]},e.id))})]})}},5974:function(e,r,t){"use strict";t.d(r,{C:function(){return l}});var s=t(7437);t(2265);var a=t(535),n=t(4508);let i=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:r,variant:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)(i({variant:t}),r),...a})}},5186:function(e,r,t){"use strict";t.d(r,{I:function(){return i}});var s=t(7437),a=t(2265),n=t(4508);let i=a.forwardRef((e,r)=>{let{className:t,type:a,...i}=e;return(0,s.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...i})});i.displayName="Input"},6815:function(e,r,t){"use strict";t.d(r,{_:function(){return d}});var s=t(7437),a=t(2265),n=t(6394),i=t(535),l=t(4508);let c=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.f,{ref:r,className:(0,l.cn)(c(),t),...a})});d.displayName=n.f.displayName},5863:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9763).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3247:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},6394:function(e,r,t){"use strict";t.d(r,{f:function(){return l}});var s=t(2265),a=t(6840),n=t(7437),i=s.forwardRef((e,r)=>(0,n.jsx)(a.WV.label,{...e,ref:r,onMouseDown:r=>{var t;r.target.closest("button, input, select, textarea")||(null===(t=e.onMouseDown)||void 0===t||t.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));i.displayName="Label";var l=i},6840:function(e,r,t){"use strict";t.d(r,{WV:function(){return l},jH:function(){return c}});var s=t(2265),a=t(4887),n=t(7053),i=t(7437),l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{let t=(0,n.Z8)(`Primitive.${r}`),a=s.forwardRef((e,s)=>{let{asChild:a,...n}=e,l=a?t:r;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(l,{...n,ref:s})});return a.displayName=`Primitive.${r}`,{...e,[r]:a}},{});function c(e,r){e&&a.flushSync(()=>e.dispatchEvent(r))}}},function(e){e.O(0,[569,523,273,971,117,744],function(){return e(e.s=9280)}),_N_E=e.O()}]);