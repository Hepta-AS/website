"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/stripe/webhook/route";
exports.ids = ["app/api/stripe/webhook/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fwebhook%2Froute&page=%2Fapi%2Fstripe%2Fwebhook%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fwebhook%2Froute.ts&appDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fwebhook%2Froute&page=%2Fapi%2Fstripe%2Fwebhook%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fwebhook%2Froute.ts&appDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_alexanderamundsen_WebstormProjects_wasd_app_api_stripe_webhook_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/stripe/webhook/route.ts */ \"(rsc)/./app/api/stripe/webhook/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/stripe/webhook/route\",\n        pathname: \"/api/stripe/webhook\",\n        filename: \"route\",\n        bundlePath: \"app/api/stripe/webhook/route\"\n    },\n    resolvedPagePath: \"/Users/alexanderamundsen/WebstormProjects/wasd/app/api/stripe/webhook/route.ts\",\n    nextConfigOutput,\n    userland: _Users_alexanderamundsen_WebstormProjects_wasd_app_api_stripe_webhook_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/stripe/webhook/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZzdHJpcGUlMkZ3ZWJob29rJTJGcm91dGUmcGFnZT0lMkZhcGklMkZzdHJpcGUlMkZ3ZWJob29rJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGc3RyaXBlJTJGd2ViaG9vayUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmFsZXhhbmRlcmFtdW5kc2VuJTJGV2Vic3Rvcm1Qcm9qZWN0cyUyRndhc2QlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGYWxleGFuZGVyYW11bmRzZW4lMkZXZWJzdG9ybVByb2plY3RzJTJGd2FzZCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDOEI7QUFDM0c7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oZXB0YS1kYXNoYm9hcmQvPzdkZmUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2FsZXhhbmRlcmFtdW5kc2VuL1dlYnN0b3JtUHJvamVjdHMvd2FzZC9hcHAvYXBpL3N0cmlwZS93ZWJob29rL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9zdHJpcGUvd2ViaG9vay9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3N0cmlwZS93ZWJob29rXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9zdHJpcGUvd2ViaG9vay9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9hbGV4YW5kZXJhbXVuZHNlbi9XZWJzdG9ybVByb2plY3RzL3dhc2QvYXBwL2FwaS9zdHJpcGUvd2ViaG9vay9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvc3RyaXBlL3dlYmhvb2svcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fwebhook%2Froute&page=%2Fapi%2Fstripe%2Fwebhook%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fwebhook%2Froute.ts&appDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/stripe/webhook/route.ts":
/*!*****************************************!*\
  !*** ./app/api/stripe/webhook/route.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_stripe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/stripe */ \"(rsc)/./lib/stripe.ts\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @supabase/auth-helpers-nextjs */ \"(rsc)/./node_modules/@supabase/auth-helpers-nextjs/dist/index.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n// api/stripe/webhook/route.ts\n\n// REMOVED: import { headers } from \"next/headers\"; // We will get headers directly from req.headers\n // Your Stripe lib initialization\n\n // Keep for Supabase\n// const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET; // We will get this inside the function\nconsole.log(\"\\uD83E\\uDE9D /api/stripe/webhook/route.ts file TOP LEVEL LOG\"); // Check if file is loaded\nasync function POST(req) {\n    console.log(\"\\uD83E\\uDE9D POST /api/stripe/webhook ROUTE HANDLER INVOKED\");\n    console.log(\"Method:\", req.method);\n    // Log all incoming headers\n    const headerEntries = [];\n    for (const pair of req.headers.entries()){\n        headerEntries.push([\n            pair[0],\n            pair[1]\n        ]);\n    }\n    console.log(\"Incoming Headers:\", JSON.stringify(Object.fromEntries(headerEntries), null, 2));\n    const body = await req.text();\n    const signature = req.headers.get(\"stripe-signature\"); // Get signature directly from req.headers\n    console.log(\"\\uD83D\\uDCC4 Raw Body received (first 500 chars):\", body.substring(0, 500));\n    console.log(\"\\uD83D\\uDD11 Signature Header value received:\", signature); // Will be null if not present\n    const webhookSecret = \"whsec_81bb8c2505b7b8af2511740588e6f59407c04246bbd196ad7fce2b43367fbe69\";\n    console.log(\"\\uD83E\\uDD2B Webhook Secret used from env:\", webhookSecret); // Check if it's loaded correctly\n    let event;\n    // 1. Validate prerequisites for signature verification\n    if (!signature) {\n        console.error(\"❌ CRITICAL: Stripe-Signature header is missing or null in req.headers!\");\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Stripe-Signature header missing\"\n        }, {\n            status: 400\n        });\n    }\n    if (!webhookSecret) {\n        console.error(\"❌ CRITICAL: STRIPE_WEBHOOK_SECRET is not set in environment!\");\n        // This is a server configuration issue.\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Webhook secret not configured on server\"\n        }, {\n            status: 500\n        });\n    }\n    if (!body) {\n        // This case is unlikely if req.text() succeeds but good to have\n        console.error(\"❌ CRITICAL: Request body is empty after req.text()!\");\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Request body is empty\"\n        }, {\n            status: 400\n        });\n    }\n    if (!_lib_stripe__WEBPACK_IMPORTED_MODULE_1__.stripe) {\n        console.error(\"❌ CRITICAL: Stripe instance from '@/lib/stripe' is not initialized!\");\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Stripe service unavailable\"\n        }, {\n            status: 500\n        });\n    }\n    // 2. Attempt to construct the event (verify signature)\n    try {\n        console.log(\"Attempting stripe.webhooks.constructEvent...\");\n        event = _lib_stripe__WEBPACK_IMPORTED_MODULE_1__.stripe.webhooks.constructEvent(body, signature, webhookSecret);\n        console.log(\"✅ Stripe Webhook Event Verified:\", event.type, `ID: ${event.id}`);\n    } catch (err) {\n        console.error(`❌ Webhook signature verification failed: ${err.message}`, {\n            errorName: err.name,\n            errorMessage: err.message\n        });\n        // The error from constructEvent often includes hints, e.g. \"No signatures found matching...\"\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: `Webhook Error: ${err.message}`\n        }, {\n            status: 400\n        });\n    }\n    // 3. Log the received event type (already done above after successful verification)\n    const supabase = (0,_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_2__.createRouteHandlerClient)({\n        cookies: next_headers__WEBPACK_IMPORTED_MODULE_3__.cookies\n    }); // Assuming cookies() works here as intended\n    // 4. Handle the event\n    console.log(`🔄 Processing event type: ${event.type}`);\n    try {\n        switch(event.type){\n            case \"invoice.paid\":\n                const invoicePaid = event.data.object;\n                console.log(`  Processing invoice.paid for invoice ID: ${invoicePaid.id}, Customer: ${invoicePaid.customer}`);\n                const { error: paidError } = await supabase.from(\"invoices\").update({\n                    status: \"paid\",\n                    paid_at: new Date().toISOString()\n                }).eq(\"stripe_invoice_id\", invoicePaid.id);\n                if (paidError) {\n                    console.error(`  ❌ Supabase error updating invoice ${invoicePaid.id} to paid:`, paidError);\n                } else {\n                    console.log(`  ✅ Supabase: Invoice ${invoicePaid.id} marked as paid.`);\n                }\n                break;\n            case \"invoice.payment_failed\":\n                const invoiceFailed = event.data.object;\n                console.log(`  Processing invoice.payment_failed for invoice ID: ${invoiceFailed.id}, Customer: ${invoiceFailed.customer}`);\n                const { error: failedError } = await supabase.from(\"invoices\").update({\n                    status: \"payment_failed\"\n                }).eq(\"stripe_invoice_id\", invoiceFailed.id);\n                if (failedError) {\n                    console.error(`  ❌ Supabase error updating invoice ${invoiceFailed.id} to payment_failed:`, failedError);\n                } else {\n                    console.log(`  ✅ Supabase: Invoice ${invoiceFailed.id} marked as payment_failed.`);\n                }\n                break;\n            case \"customer.subscription.created\":\n                const subscription = event.data.object;\n                console.log(`  Processing customer.subscription.created for subscription ID: ${subscription.id}, Customer: ${subscription.customer}`);\n                break;\n            default:\n                console.log(`  🤷‍♀️ Unhandled event type: ${event.type}`);\n        }\n    } catch (error) {\n        console.error(`❌ Error during event handling for ${event.id} (type: ${event.type}): ${error.message}`, error);\n    }\n    // 5. Acknowledge receipt to Stripe\n    console.log(`👍 Event ${event.id} processed. Responding 200 to Stripe.`);\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        received: true\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNoQ00sSUFBSSxDQUFDLFlBQ0xDLE1BQU0sQ0FBQztvQkFBRWpCLFFBQVE7Z0JBQWlCLEdBQ2xDcUIsRUFBRSxDQUFDLHFCQUFxQkMsY0FBY2xCLEVBQUU7Z0JBRTdDLElBQUltQixhQUFhO29CQUNmakQsUUFBUXdCLEtBQUssQ0FBQyxDQUFDLG9DQUFvQyxFQUFFd0IsY0FBY2xCLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFbUI7Z0JBQzlGLE9BQU87b0JBQ0xqRCxRQUFRQyxHQUFHLENBQUMsQ0FBQyxzQkFBc0IsRUFBRStDLGNBQWNsQixFQUFFLENBQUMsMEJBQTBCLENBQUM7Z0JBQ25GO2dCQUNBO1lBRUYsS0FBSztnQkFDSCxNQUFNb0IsZUFBZTNCLE1BQU1lLElBQUksQ0FBQ0MsTUFBTTtnQkFDdEN2QyxRQUFRQyxHQUFHLENBQUMsQ0FBQyxnRUFBZ0UsRUFBRWlELGFBQWFwQixFQUFFLENBQUMsWUFBWSxFQUFFb0IsYUFBYVYsUUFBUSxDQUFDLENBQUM7Z0JBRXBJO1lBRUY7Z0JBQ0V4QyxRQUFRQyxHQUFHLENBQUMsQ0FBQyw4QkFBOEIsRUFBRXNCLE1BQU1NLElBQUksQ0FBQyxDQUFDO1FBQzdEO0lBQ0YsRUFBRSxPQUFPTCxPQUFZO1FBQ25CeEIsUUFBUXdCLEtBQUssQ0FBQyxDQUFDLGtDQUFrQyxFQUFFRCxNQUFNTyxFQUFFLENBQUMsUUFBUSxFQUFFUCxNQUFNTSxJQUFJLENBQUMsR0FBRyxFQUFFTCxNQUFNUSxPQUFPLENBQUMsQ0FBQyxFQUFFUjtJQUN6RztJQUVBLG1DQUFtQztJQUNuQ3hCLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsRUFBRXNCLE1BQU1PLEVBQUUsQ0FBQyxxQ0FBcUMsQ0FBQztJQUN2RSxPQUFPbEMscURBQVlBLENBQUM2QixJQUFJLENBQUM7UUFBRTBCLFVBQVU7SUFBSztBQUM1QyIsInNvdXJjZXMiOlsid2VicGFjazovL2hlcHRhLWRhc2hib2FyZC8uL2FwcC9hcGkvc3RyaXBlL3dlYmhvb2svcm91dGUudHM/YzU5NCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBhcGkvc3RyaXBlL3dlYmhvb2svcm91dGUudHNcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuLy8gUkVNT1ZFRDogaW1wb3J0IHsgaGVhZGVycyB9IGZyb20gXCJuZXh0L2hlYWRlcnNcIjsgLy8gV2Ugd2lsbCBnZXQgaGVhZGVycyBkaXJlY3RseSBmcm9tIHJlcS5oZWFkZXJzXG5pbXBvcnQgeyBzdHJpcGUgfSBmcm9tIFwiQC9saWIvc3RyaXBlXCI7IC8vIFlvdXIgU3RyaXBlIGxpYiBpbml0aWFsaXphdGlvblxuaW1wb3J0IHsgY3JlYXRlUm91dGVIYW5kbGVyQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9hdXRoLWhlbHBlcnMtbmV4dGpzXCI7XG5pbXBvcnQgeyBjb29raWVzIH0gZnJvbSBcIm5leHQvaGVhZGVyc1wiOyAvLyBLZWVwIGZvciBTdXBhYmFzZVxuaW1wb3J0IHR5cGUgU3RyaXBlIGZyb20gJ3N0cmlwZSc7IC8vIEltcG9ydCBTdHJpcGUgdHlwZXNcblxuLy8gY29uc3Qgd2ViaG9va1NlY3JldCA9IHByb2Nlc3MuZW52LlNUUklQRV9XRUJIT09LX1NFQ1JFVDsgLy8gV2Ugd2lsbCBnZXQgdGhpcyBpbnNpZGUgdGhlIGZ1bmN0aW9uXG5cbmNvbnNvbGUubG9nKFwi8J+qnSAvYXBpL3N0cmlwZS93ZWJob29rL3JvdXRlLnRzIGZpbGUgVE9QIExFVkVMIExPR1wiKTsgLy8gQ2hlY2sgaWYgZmlsZSBpcyBsb2FkZWRcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxOiBSZXF1ZXN0KSB7XG4gIGNvbnNvbGUubG9nKFwi8J+qnSBQT1NUIC9hcGkvc3RyaXBlL3dlYmhvb2sgUk9VVEUgSEFORExFUiBJTlZPS0VEXCIpO1xuICBjb25zb2xlLmxvZyhcIk1ldGhvZDpcIiwgcmVxLm1ldGhvZCk7XG5cbiAgLy8gTG9nIGFsbCBpbmNvbWluZyBoZWFkZXJzXG4gIGNvbnN0IGhlYWRlckVudHJpZXMgPSBbXTtcbiAgZm9yIChjb25zdCBwYWlyIG9mIHJlcS5oZWFkZXJzLmVudHJpZXMoKSkge1xuICAgIGhlYWRlckVudHJpZXMucHVzaChbcGFpclswXSwgcGFpclsxXV0pO1xuICB9XG4gIGNvbnNvbGUubG9nKFwiSW5jb21pbmcgSGVhZGVyczpcIiwgSlNPTi5zdHJpbmdpZnkoT2JqZWN0LmZyb21FbnRyaWVzKGhlYWRlckVudHJpZXMpLCBudWxsLCAyKSk7XG5cbiAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS50ZXh0KCk7XG4gIGNvbnN0IHNpZ25hdHVyZSA9IHJlcS5oZWFkZXJzLmdldChcInN0cmlwZS1zaWduYXR1cmVcIik7IC8vIEdldCBzaWduYXR1cmUgZGlyZWN0bHkgZnJvbSByZXEuaGVhZGVyc1xuXG4gIGNvbnNvbGUubG9nKFwi8J+ThCBSYXcgQm9keSByZWNlaXZlZCAoZmlyc3QgNTAwIGNoYXJzKTpcIiwgYm9keS5zdWJzdHJpbmcoMCwgNTAwKSk7XG4gIGNvbnNvbGUubG9nKFwi8J+UkSBTaWduYXR1cmUgSGVhZGVyIHZhbHVlIHJlY2VpdmVkOlwiLCBzaWduYXR1cmUpOyAvLyBXaWxsIGJlIG51bGwgaWYgbm90IHByZXNlbnRcblxuICBjb25zdCB3ZWJob29rU2VjcmV0ID0gcHJvY2Vzcy5lbnYuU1RSSVBFX1dFQkhPT0tfU0VDUkVUO1xuICBjb25zb2xlLmxvZyhcIvCfpKsgV2ViaG9vayBTZWNyZXQgdXNlZCBmcm9tIGVudjpcIiwgd2ViaG9va1NlY3JldCk7IC8vIENoZWNrIGlmIGl0J3MgbG9hZGVkIGNvcnJlY3RseVxuXG4gIGxldCBldmVudDogU3RyaXBlLkV2ZW50O1xuXG4gIC8vIDEuIFZhbGlkYXRlIHByZXJlcXVpc2l0ZXMgZm9yIHNpZ25hdHVyZSB2ZXJpZmljYXRpb25cbiAgaWYgKCFzaWduYXR1cmUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIENSSVRJQ0FMOiBTdHJpcGUtU2lnbmF0dXJlIGhlYWRlciBpcyBtaXNzaW5nIG9yIG51bGwgaW4gcmVxLmhlYWRlcnMhXCIpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlN0cmlwZS1TaWduYXR1cmUgaGVhZGVyIG1pc3NpbmdcIiB9LCB7IHN0YXR1czogNDAwIH0pO1xuICB9XG4gIGlmICghd2ViaG9va1NlY3JldCkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgQ1JJVElDQUw6IFNUUklQRV9XRUJIT09LX1NFQ1JFVCBpcyBub3Qgc2V0IGluIGVudmlyb25tZW50IVwiKTtcbiAgICAvLyBUaGlzIGlzIGEgc2VydmVyIGNvbmZpZ3VyYXRpb24gaXNzdWUuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiV2ViaG9vayBzZWNyZXQgbm90IGNvbmZpZ3VyZWQgb24gc2VydmVyXCIgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxuICBpZiAoIWJvZHkpIHtcbiAgICAvLyBUaGlzIGNhc2UgaXMgdW5saWtlbHkgaWYgcmVxLnRleHQoKSBzdWNjZWVkcyBidXQgZ29vZCB0byBoYXZlXG4gICAgY29uc29sZS5lcnJvcihcIuKdjCBDUklUSUNBTDogUmVxdWVzdCBib2R5IGlzIGVtcHR5IGFmdGVyIHJlcS50ZXh0KCkhXCIpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlJlcXVlc3QgYm9keSBpcyBlbXB0eVwiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG4gIH1cbiAgaWYgKCFzdHJpcGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIENSSVRJQ0FMOiBTdHJpcGUgaW5zdGFuY2UgZnJvbSAnQC9saWIvc3RyaXBlJyBpcyBub3QgaW5pdGlhbGl6ZWQhXCIpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlN0cmlwZSBzZXJ2aWNlIHVuYXZhaWxhYmxlXCIgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxuXG4gIC8vIDIuIEF0dGVtcHQgdG8gY29uc3RydWN0IHRoZSBldmVudCAodmVyaWZ5IHNpZ25hdHVyZSlcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhcIkF0dGVtcHRpbmcgc3RyaXBlLndlYmhvb2tzLmNvbnN0cnVjdEV2ZW50Li4uXCIpO1xuICAgIGV2ZW50ID0gc3RyaXBlLndlYmhvb2tzLmNvbnN0cnVjdEV2ZW50KGJvZHksIHNpZ25hdHVyZSwgd2ViaG9va1NlY3JldCk7XG4gICAgY29uc29sZS5sb2coJ+KchSBTdHJpcGUgV2ViaG9vayBFdmVudCBWZXJpZmllZDonLCBldmVudC50eXBlLCBgSUQ6ICR7ZXZlbnQuaWR9YCk7XG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcihg4p2MIFdlYmhvb2sgc2lnbmF0dXJlIHZlcmlmaWNhdGlvbiBmYWlsZWQ6ICR7ZXJyLm1lc3NhZ2V9YCwge1xuICAgICAgZXJyb3JOYW1lOiBlcnIubmFtZSwgLy8gZS5nLiwgU3RyaXBlU2lnbmF0dXJlVmVyaWZpY2F0aW9uRXJyb3JcbiAgICAgIGVycm9yTWVzc2FnZTogZXJyLm1lc3NhZ2UsXG4gICAgICAvLyBDb25zaWRlciBsb2dnaW5nIGVyci5zdGFjayBpbiBkZXYgb25seSBpZiBpdCBoZWxwcywgbWlnaHQgYmUgdG9vIHZlcmJvc2Ugb3Igc2Vuc2l0aXZlXG4gICAgfSk7XG4gICAgLy8gVGhlIGVycm9yIGZyb20gY29uc3RydWN0RXZlbnQgb2Z0ZW4gaW5jbHVkZXMgaGludHMsIGUuZy4gXCJObyBzaWduYXR1cmVzIGZvdW5kIG1hdGNoaW5nLi4uXCJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogYFdlYmhvb2sgRXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCB9LCB7IHN0YXR1czogNDAwIH0pO1xuICB9XG5cbiAgLy8gMy4gTG9nIHRoZSByZWNlaXZlZCBldmVudCB0eXBlIChhbHJlYWR5IGRvbmUgYWJvdmUgYWZ0ZXIgc3VjY2Vzc2Z1bCB2ZXJpZmljYXRpb24pXG5cbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVSb3V0ZUhhbmRsZXJDbGllbnQoeyBjb29raWVzIH0pOyAvLyBBc3N1bWluZyBjb29raWVzKCkgd29ya3MgaGVyZSBhcyBpbnRlbmRlZFxuXG4gIC8vIDQuIEhhbmRsZSB0aGUgZXZlbnRcbiAgY29uc29sZS5sb2coYPCflIQgUHJvY2Vzc2luZyBldmVudCB0eXBlOiAke2V2ZW50LnR5cGV9YCk7XG4gIHRyeSB7XG4gICAgc3dpdGNoIChldmVudC50eXBlKSB7XG4gICAgICBjYXNlIFwiaW52b2ljZS5wYWlkXCI6XG4gICAgICAgIGNvbnN0IGludm9pY2VQYWlkID0gZXZlbnQuZGF0YS5vYmplY3QgYXMgU3RyaXBlLkludm9pY2U7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgIFByb2Nlc3NpbmcgaW52b2ljZS5wYWlkIGZvciBpbnZvaWNlIElEOiAke2ludm9pY2VQYWlkLmlkfSwgQ3VzdG9tZXI6ICR7aW52b2ljZVBhaWQuY3VzdG9tZXJ9YCk7XG4gICAgICAgIGNvbnN0IHsgZXJyb3I6IHBhaWRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgIC5mcm9tKFwiaW52b2ljZXNcIilcbiAgICAgICAgICAgIC51cGRhdGUoeyBzdGF0dXM6IFwicGFpZFwiLCBwYWlkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfSlcbiAgICAgICAgICAgIC5lcShcInN0cmlwZV9pbnZvaWNlX2lkXCIsIGludm9pY2VQYWlkLmlkKTtcblxuICAgICAgICBpZiAocGFpZEVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgICDinYwgU3VwYWJhc2UgZXJyb3IgdXBkYXRpbmcgaW52b2ljZSAke2ludm9pY2VQYWlkLmlkfSB0byBwYWlkOmAsIHBhaWRFcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYCAg4pyFIFN1cGFiYXNlOiBJbnZvaWNlICR7aW52b2ljZVBhaWQuaWR9IG1hcmtlZCBhcyBwYWlkLmApO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwiaW52b2ljZS5wYXltZW50X2ZhaWxlZFwiOlxuICAgICAgICBjb25zdCBpbnZvaWNlRmFpbGVkID0gZXZlbnQuZGF0YS5vYmplY3QgYXMgU3RyaXBlLkludm9pY2U7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgIFByb2Nlc3NpbmcgaW52b2ljZS5wYXltZW50X2ZhaWxlZCBmb3IgaW52b2ljZSBJRDogJHtpbnZvaWNlRmFpbGVkLmlkfSwgQ3VzdG9tZXI6ICR7aW52b2ljZUZhaWxlZC5jdXN0b21lcn1gKTtcbiAgICAgICAgY29uc3QgeyBlcnJvcjogZmFpbGVkRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgICAuZnJvbShcImludm9pY2VzXCIpXG4gICAgICAgICAgICAudXBkYXRlKHsgc3RhdHVzOiBcInBheW1lbnRfZmFpbGVkXCIgfSlcbiAgICAgICAgICAgIC5lcShcInN0cmlwZV9pbnZvaWNlX2lkXCIsIGludm9pY2VGYWlsZWQuaWQpO1xuXG4gICAgICAgIGlmIChmYWlsZWRFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYCAg4p2MIFN1cGFiYXNlIGVycm9yIHVwZGF0aW5nIGludm9pY2UgJHtpbnZvaWNlRmFpbGVkLmlkfSB0byBwYXltZW50X2ZhaWxlZDpgLCBmYWlsZWRFcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYCAg4pyFIFN1cGFiYXNlOiBJbnZvaWNlICR7aW52b2ljZUZhaWxlZC5pZH0gbWFya2VkIGFzIHBheW1lbnRfZmFpbGVkLmApO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwiY3VzdG9tZXIuc3Vic2NyaXB0aW9uLmNyZWF0ZWRcIjpcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gZXZlbnQuZGF0YS5vYmplY3QgYXMgU3RyaXBlLlN1YnNjcmlwdGlvbjtcbiAgICAgICAgY29uc29sZS5sb2coYCAgUHJvY2Vzc2luZyBjdXN0b21lci5zdWJzY3JpcHRpb24uY3JlYXRlZCBmb3Igc3Vic2NyaXB0aW9uIElEOiAke3N1YnNjcmlwdGlvbi5pZH0sIEN1c3RvbWVyOiAke3N1YnNjcmlwdGlvbi5jdXN0b21lcn1gKTtcbiAgICAgICAgLy8gQWRkIHlvdXIgbG9naWMgaGVyZVxuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY29uc29sZS5sb2coYCAg8J+kt+KAjeKZgO+4jyBVbmhhbmRsZWQgZXZlbnQgdHlwZTogJHtldmVudC50eXBlfWApO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBFcnJvciBkdXJpbmcgZXZlbnQgaGFuZGxpbmcgZm9yICR7ZXZlbnQuaWR9ICh0eXBlOiAke2V2ZW50LnR5cGV9KTogJHtlcnJvci5tZXNzYWdlfWAsIGVycm9yKTtcbiAgfVxuXG4gIC8vIDUuIEFja25vd2xlZGdlIHJlY2VpcHQgdG8gU3RyaXBlXG4gIGNvbnNvbGUubG9nKGDwn5GNIEV2ZW50ICR7ZXZlbnQuaWR9IHByb2Nlc3NlZC4gUmVzcG9uZGluZyAyMDAgdG8gU3RyaXBlLmApO1xuICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyByZWNlaXZlZDogdHJ1ZSB9KTtcbn0iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwic3RyaXBlIiwiY3JlYXRlUm91dGVIYW5kbGVyQ2xpZW50IiwiY29va2llcyIsImNvbnNvbGUiLCJsb2ciLCJQT1NUIiwicmVxIiwibWV0aG9kIiwiaGVhZGVyRW50cmllcyIsInBhaXIiLCJoZWFkZXJzIiwiZW50cmllcyIsInB1c2giLCJKU09OIiwic3RyaW5naWZ5IiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJib2R5IiwidGV4dCIsInNpZ25hdHVyZSIsImdldCIsInN1YnN0cmluZyIsIndlYmhvb2tTZWNyZXQiLCJwcm9jZXNzIiwiZW52IiwiU1RSSVBFX1dFQkhPT0tfU0VDUkVUIiwiZXZlbnQiLCJlcnJvciIsImpzb24iLCJzdGF0dXMiLCJ3ZWJob29rcyIsImNvbnN0cnVjdEV2ZW50IiwidHlwZSIsImlkIiwiZXJyIiwibWVzc2FnZSIsImVycm9yTmFtZSIsIm5hbWUiLCJlcnJvck1lc3NhZ2UiLCJzdXBhYmFzZSIsImludm9pY2VQYWlkIiwiZGF0YSIsIm9iamVjdCIsImN1c3RvbWVyIiwicGFpZEVycm9yIiwiZnJvbSIsInVwZGF0ZSIsInBhaWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJlcSIsImludm9pY2VGYWlsZWQiLCJmYWlsZWRFcnJvciIsInN1YnNjcmlwdGlvbiIsInJlY2VpdmVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/stripe/webhook/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/stripe.ts":
/*!***********************!*\
  !*** ./lib/stripe.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createCustomer: () => (/* binding */ createCustomer),\n/* harmony export */   createInvoice: () => (/* binding */ createInvoice),\n/* harmony export */   createPaymentIntent: () => (/* binding */ createPaymentIntent),\n/* harmony export */   createTestInvoice: () => (/* binding */ createTestInvoice),\n/* harmony export */   formatAmountForStripe: () => (/* binding */ formatAmountForStripe),\n/* harmony export */   formatAmountFromStripe: () => (/* binding */ formatAmountFromStripe),\n/* harmony export */   getCustomerInvoices: () => (/* binding */ getCustomerInvoices),\n/* harmony export */   payInvoice: () => (/* binding */ payInvoice),\n/* harmony export */   stripe: () => (/* binding */ stripe)\n/* harmony export */ });\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! stripe */ \"(rsc)/./node_modules/stripe/esm/stripe.esm.node.js\");\n// lib/stripe.ts\n\nconst isDevelopment = \"development\" === \"development\";\n// --- Funksjon for å initialisere Stripe ---\nconst getStripeInstance = ()=>{\n    const apiKeyFromEnv = \"sk_test_51NTj6ECBZbubqLlTavZEEYr8YqLtMwVYfzIY8EyT3kXY2yuSv6z7hsiQ2omjZnQ1TMIFee3emq7HIcMAe4rWdAoc00CZhpLtEf\";\n    console.log(\"\\n--- DEBUG: lib/stripe.ts -> getStripeInstance ---\");\n    console.log(\"NODE_ENV:\", \"development\");\n    console.log(\"Raw STRIPE_SECRET_KEY from env:\", apiKeyFromEnv);\n    if (!apiKeyFromEnv) {\n        console.warn(\"⚠️ lib/stripe.ts: STRIPE_SECRET_KEY is NOT SET in environment variables. Stripe operations will be mocked or fail.\");\n        return null;\n    }\n    if (apiKeyFromEnv.startsWith(\"sk_live_\")) {\n        console.warn(\"\\uD83D\\uDD34 lib/stripe.ts: WARNING: Attempting to use a LIVE Stripe key (sk_live_).\");\n        if (isDevelopment) {\n            console.warn(\"\\uD83D\\uDD34\\uD83D\\uDD34\\uD83D\\uDD34 lib/stripe.ts: Using a LIVE Stripe key in DEVELOPMENT. This is dangerous and likely unintended. Stripe will NOT be initialized with a live key in dev.\");\n            return null; // Forhindre bruk av live-nøkkel i dev\n        }\n    } else if (apiKeyFromEnv.startsWith(\"sk_test_\")) {\n        console.log(\"✅ lib/stripe.ts: Using a TEST Stripe key (sk_test_). This is good for development.\");\n    } else {\n        // Viser kun de første og siste tegnene av nøkkelen av sikkerhetshensyn i loggen\n        const maskedDisplayKey = apiKeyFromEnv.length > 14 ? apiKeyFromEnv.substring(0, 7) + \"...\" + apiKeyFromEnv.substring(apiKeyFromEnv.length - 4) : apiKeyFromEnv;\n        console.warn(`⚠️ lib/stripe.ts: STRIPE_SECRET_KEY (\"${maskedDisplayKey}\") does not look like a valid Stripe secret key (should start with sk_test_ or sk_live_).`);\n        return null;\n    }\n    try {\n        const maskedDisplayKey = apiKeyFromEnv.length > 14 ? apiKeyFromEnv.substring(0, 7) + \"...\" + apiKeyFromEnv.substring(apiKeyFromEnv.length - 4) : apiKeyFromEnv;\n        console.log(`lib/stripe.ts: Attempting to initialize Stripe with API key: ${maskedDisplayKey}`);\n        const stripeInstance = new stripe__WEBPACK_IMPORTED_MODULE_0__[\"default\"](apiKeyFromEnv, {\n            apiVersion: \"2023-10-16\",\n            typescript: true\n        });\n        console.log(\"✅ lib/stripe.ts: Stripe initialized successfully.\");\n        return stripeInstance;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Failed to initialize Stripe with API key. Error:\", error);\n        return null;\n    }\n};\n// Initialiser Stripe-instansen én gang\nconst stripe = getStripeInstance();\n// --- Hjelpefunksjoner ---\nconst logStripeOperation = (operation, ...args)=>{\n    if (isDevelopment) {\n        console.log(`🔄 lib/stripe.ts: Stripe Operation - ${operation}:`, ...args);\n    }\n};\nconst formatAmountForStripe = (amount)=>{\n    return Math.round(amount * 100); // Konverterer NOK til øre\n};\nconst formatAmountFromStripe = (amount)=>{\n    return amount / 100; // Konverterer øre til NOK\n};\n// --- Stripe API-kall funksjoner ---\nconst createCustomer = async (email, name, metadata)=>{\n    logStripeOperation(\"createCustomer - Start\", {\n        email,\n        name,\n        metadata\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> createCustomer ---\");\n    console.log(\"Is 'stripe' object initialized here?\", stripe ? \"YES\" : \"NO - Stripe key likely missing/invalid in env!\");\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in createCustomer. Returning MOCK customer.\");\n        return {\n            id: \"cus_mock_STRIPE_NULL_\" + Date.now().toString(36) + Math.random().toString(36).substring(2),\n            email,\n            name,\n            metadata,\n            object: \"customer\",\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: \"Stripe not initialized (null instance), returning mock customer.\"\n        };\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call: customers.create for email: ${email}`);\n        const customerParams = {\n            email\n        };\n        if (name) customerParams.name = name;\n        if (metadata) customerParams.metadata = metadata;\n        const customer = await stripe.customers.create(customerParams);\n        console.log(\"✅ lib/stripe.ts: Stripe customer created successfully via API. ID:\", customer.id);\n        return customer;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error calling Stripe API (customers.create):\", error);\n        return {\n            id: \"cus_mock_API_ERROR_\" + Date.now().toString(36) + Math.random().toString(36).substring(2),\n            email,\n            name,\n            metadata,\n            object: \"customer\",\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: error.message || \"Unknown error during Stripe API call to create customer\"\n        };\n    }\n};\nconst createPaymentIntent = async (amount, currency = \"nok\", customerId)=>{\n    logStripeOperation(\"createPaymentIntent - Start\", {\n        amount,\n        currency,\n        customerId\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> createPaymentIntent ---\");\n    console.log(\"Is 'stripe' object initialized here?\", stripe ? \"YES\" : \"NO - Stripe key likely missing/invalid in env!\");\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in createPaymentIntent. Returning MOCK Payment Intent.\");\n        const mockClientSecret = \"pi_mock_secret_STRIPE_NULL_\" + Date.now().toString(36) + Math.random().toString(36).substring(2);\n        return {\n            id: \"pi_mock_STRIPE_NULL_\" + Date.now().toString(36) + Math.random().toString(36).substring(2),\n            amount: formatAmountForStripe(amount),\n            currency,\n            client_secret: mockClientSecret,\n            customer: customerId,\n            status: \"requires_payment_method\",\n            object: \"payment_intent\",\n            error: true,\n            message: \"Stripe not initialized (null instance), returning mock payment intent.\"\n        };\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call: paymentIntents.create. Amount: ${amount}, Currency: ${currency}, CustomerID: ${customerId || \"None\"}`);\n        const paymentIntentParams = {\n            amount: formatAmountForStripe(amount),\n            currency,\n            automatic_payment_methods: {\n                enabled: true\n            }\n        };\n        if (customerId) {\n            paymentIntentParams.customer = customerId;\n        }\n        const paymentIntent = await stripe.paymentIntents.create(paymentIntentParams);\n        console.log(\"✅ lib/stripe.ts: REAL Stripe Payment Intent created. Client Secret starts with:\", paymentIntent.client_secret?.substring(0, 15) + \"...\");\n        return paymentIntent;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error calling Stripe API (paymentIntents.create):\", error);\n        const mockClientSecret = \"pi_mock_secret_API_ERROR_\" + Date.now().toString(36) + Math.random().toString(36).substring(2);\n        return {\n            id: \"pi_mock_API_ERROR_\" + Date.now().toString(36) + Math.random().toString(36).substring(2),\n            amount: formatAmountForStripe(amount),\n            currency,\n            client_secret: mockClientSecret,\n            customer: customerId,\n            status: \"requires_payment_method\",\n            object: \"payment_intent\",\n            error: true,\n            message: error.message || \"Unknown error during Stripe API call to create payment intent\"\n        };\n    }\n};\n// --- Dine andre Stripe-hjelpefunksjoner ---\n// Du bør gå gjennom disse og legge til lignende `if (!stripe)` sjekker og logging\n// hvis du vil at de skal håndtere manglende Stripe-initialisering grasiøst\n// eller alltid prøve ekte kall hvis `stripe` er tilgjengelig.\nconst createInvoice = async (customerId, description, amount, currency = \"nok\")=>{\n    logStripeOperation(\"createInvoice - Start\", {\n        customerId,\n        description,\n        amount,\n        currency\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> createInvoice --- 'stripe' initialized?\", stripe ? \"YES\" : \"NO\");\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in createInvoice. Returning MOCK invoice.\");\n        return {\n            id: \"in_mock_STRIPE_NULL_\" + Date.now().toString(36),\n            customer: customerId,\n            amount_due: formatAmountForStripe(amount),\n            currency,\n            description,\n            status: \"open\",\n            due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: \"Stripe not initialized\"\n        };\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call for createInvoice. Customer: ${customerId}`);\n        const invoiceItem = await stripe.invoiceItems.create({\n            customer: customerId,\n            amount: formatAmountForStripe(amount),\n            currency,\n            description\n        });\n        const invoice = await stripe.invoices.create({\n            customer: customerId,\n            auto_advance: true,\n            collection_method: \"send_invoice\",\n            days_until_due: 30\n        });\n        const finalizedInvoice = await stripe.invoices.finalizeInvoice(invoice.id);\n        await stripe.invoices.sendInvoice(finalizedInvoice.id);\n        console.log(\"✅ lib/stripe.ts: REAL Stripe Invoice created and sent. ID:\", finalizedInvoice.id);\n        return finalizedInvoice;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error creating REAL Stripe invoice:\", error);\n        return {\n            id: \"in_mock_API_ERROR_\" + Date.now().toString(36),\n            customer: customerId,\n            amount_due: formatAmountForStripe(amount),\n            currency,\n            description,\n            status: \"open\",\n            due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: error.message || \"Unknown API error creating invoice\"\n        };\n    }\n};\nconst getCustomerInvoices = async (customerId)=>{\n    logStripeOperation(\"getCustomerInvoices - Start\", {\n        customerId\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> getCustomerInvoices --- 'stripe' initialized?\", stripe ? \"YES\" : \"NO\");\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in getCustomerInvoices. Returning MOCK invoices.\");\n        return [\n            {\n                id: \"in_mock_STRIPE_NULL_cust_inv\",\n                customer: customerId,\n                amount_due: 10000,\n                currency: \"nok\",\n                status: \"open\",\n                due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n                hosted_invoice_url: \"#\",\n                created: Math.floor(Date.now() / 1000) - 86400,\n                error: true,\n                message: \"Stripe not initialized\"\n            }\n        ];\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call for getCustomerInvoices. Customer: ${customerId}`);\n        const invoices = await stripe.invoices.list({\n            customer: customerId,\n            limit: 100\n        });\n        console.log(`✅ lib/stripe.ts: Fetched ${invoices.data.length} REAL Stripe Invoices for customer.`);\n        return invoices.data;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error fetching REAL customer invoices:\", error);\n        return [\n            {\n                id: \"in_mock_API_ERROR_cust_inv\",\n                customer: customerId,\n                amount_due: 10000,\n                currency: \"nok\",\n                status: \"open\",\n                due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n                hosted_invoice_url: \"#\",\n                created: Math.floor(Date.now() / 1000) - 86400,\n                error: true,\n                message: error.message || \"Unknown API error fetching invoices\"\n            }\n        ];\n    }\n};\nconst payInvoice = async (invoiceId)=>{\n    logStripeOperation(\"payInvoice - Start\", {\n        invoiceId\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> payInvoice --- 'stripe' initialized?\", stripe ? \"YES\" : \"NO\");\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in payInvoice. Returning MOCK payment status.\");\n        return {\n            id: invoiceId,\n            status: \"paid\",\n            paid: true,\n            amount_paid: 10000,\n            currency: \"nok\",\n            error: true,\n            message: \"Stripe not initialized\"\n        };\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call for payInvoice. Invoice ID: ${invoiceId}`);\n        const invoice = await stripe.invoices.pay(invoiceId);\n        console.log(\"✅ lib/stripe.ts: REAL Stripe Invoice paid. Status:\", invoice.status);\n        return invoice;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error paying REAL Stripe invoice:\", error);\n        return {\n            id: invoiceId,\n            status: \"open\",\n            paid: false,\n            /*amount_paid might not be set*/ error: true,\n            message: error.message || \"Unknown API error paying invoice\"\n        };\n    }\n};\nconst createTestInvoice = async (customerId)=>{\n    logStripeOperation(\"createTestInvoice - Start\", {\n        customerId\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> createTestInvoice --- 'stripe' initialized?\", stripe ? \"YES\" : \"NO\");\n    if (!isDevelopment) {\n        console.error(\"❌ lib/stripe.ts: createTestInvoice called outside development mode.\");\n        throw new Error(\"Test invoices can only be created in development mode\");\n    }\n    if (!customerId) {\n        console.error(\"❌ lib/stripe.ts: Customer ID is required for createTestInvoice.\");\n        throw new Error(\"Customer ID is required to create a test invoice\");\n    }\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in createTestInvoice. Returning MOCK test invoice.\");\n        const amount = Math.floor(Math.random() * 900) + 100;\n        return {\n            id: \"in_test_mock_STRIPE_NULL_\" + Date.now().toString(36),\n            number: \"TEST_MOCK\" + Math.floor(Math.random() * 10000),\n            customer: customerId,\n            amount_due: formatAmountForStripe(amount),\n            currency: \"nok\",\n            description: \"Mock Test Invoice - Stripe Not Initialized\",\n            status: \"open\",\n            due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: \"Stripe not initialized\"\n        };\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call for createTestInvoice. Customer: ${customerId}`);\n        const amount = Math.floor(Math.random() * 900) + 100;\n        const invoiceItem = await stripe.invoiceItems.create({\n            customer: customerId,\n            amount: formatAmountForStripe(amount),\n            currency: \"nok\",\n            description: \"Test Invoice - Development Only (REAL CALL)\"\n        });\n        const invoice = await stripe.invoices.create({\n            customer: customerId,\n            auto_advance: true,\n            collection_method: \"send_invoice\",\n            days_until_due: 30\n        });\n        const finalizedInvoice = await stripe.invoices.finalizeInvoice(invoice.id);\n        console.log(\"✅ lib/stripe.ts: REAL Stripe Test Invoice created. ID:\", finalizedInvoice.id);\n        return finalizedInvoice;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error creating REAL test invoice:\", error);\n        const amount = Math.floor(Math.random() * 900) + 100;\n        return {\n            id: \"in_test_mock_API_ERROR_\" + Date.now().toString(36),\n            number: \"TEST_MOCK_ERROR\" + Math.floor(Math.random() * 10000),\n            customer: customerId,\n            amount_due: formatAmountForStripe(amount),\n            currency: \"nok\",\n            description: \"Mock Test Invoice - API Error\",\n            status: \"open\",\n            due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: error.message || \"Unknown error\"\n        };\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUk7UUFDNUI7SUFDRjtBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oZXB0YS1kYXNoYm9hcmQvLi9saWIvc3RyaXBlLnRzPzBlMzMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL3N0cmlwZS50c1xuaW1wb3J0IFN0cmlwZSBmcm9tIFwic3RyaXBlXCI7XG5cbmNvbnN0IGlzRGV2ZWxvcG1lbnQgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJkZXZlbG9wbWVudFwiO1xuXG4vLyAtLS0gRnVua3Nqb24gZm9yIMOlIGluaXRpYWxpc2VyZSBTdHJpcGUgLS0tXG5jb25zdCBnZXRTdHJpcGVJbnN0YW5jZSA9ICgpOiBTdHJpcGUgfCBudWxsID0+IHtcbiAgY29uc3QgYXBpS2V5RnJvbUVudiA9IHByb2Nlc3MuZW52LlNUUklQRV9TRUNSRVRfS0VZO1xuXG4gIGNvbnNvbGUubG9nKFwiXFxuLS0tIERFQlVHOiBsaWIvc3RyaXBlLnRzIC0+IGdldFN0cmlwZUluc3RhbmNlIC0tLVwiKTtcbiAgY29uc29sZS5sb2coXCJOT0RFX0VOVjpcIiwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYpO1xuICBjb25zb2xlLmxvZyhcIlJhdyBTVFJJUEVfU0VDUkVUX0tFWSBmcm9tIGVudjpcIiwgYXBpS2V5RnJvbUVudik7XG5cbiAgaWYgKCFhcGlLZXlGcm9tRW52KSB7XG4gICAgY29uc29sZS53YXJuKFwi4pqg77iPIGxpYi9zdHJpcGUudHM6IFNUUklQRV9TRUNSRVRfS0VZIGlzIE5PVCBTRVQgaW4gZW52aXJvbm1lbnQgdmFyaWFibGVzLiBTdHJpcGUgb3BlcmF0aW9ucyB3aWxsIGJlIG1vY2tlZCBvciBmYWlsLlwiKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGlmIChhcGlLZXlGcm9tRW52LnN0YXJ0c1dpdGgoXCJza19saXZlX1wiKSkge1xuICAgIGNvbnNvbGUud2FybihcIvCflLQgbGliL3N0cmlwZS50czogV0FSTklORzogQXR0ZW1wdGluZyB0byB1c2UgYSBMSVZFIFN0cmlwZSBrZXkgKHNrX2xpdmVfKS5cIik7XG4gICAgaWYgKGlzRGV2ZWxvcG1lbnQpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIvCflLTwn5S08J+UtCBsaWIvc3RyaXBlLnRzOiBVc2luZyBhIExJVkUgU3RyaXBlIGtleSBpbiBERVZFTE9QTUVOVC4gVGhpcyBpcyBkYW5nZXJvdXMgYW5kIGxpa2VseSB1bmludGVuZGVkLiBTdHJpcGUgd2lsbCBOT1QgYmUgaW5pdGlhbGl6ZWQgd2l0aCBhIGxpdmUga2V5IGluIGRldi5cIik7XG4gICAgICByZXR1cm4gbnVsbDsgLy8gRm9yaGluZHJlIGJydWsgYXYgbGl2ZS1uw7hra2VsIGkgZGV2XG4gICAgfVxuICB9IGVsc2UgaWYgKGFwaUtleUZyb21FbnYuc3RhcnRzV2l0aChcInNrX3Rlc3RfXCIpKSB7XG4gICAgY29uc29sZS5sb2coXCLinIUgbGliL3N0cmlwZS50czogVXNpbmcgYSBURVNUIFN0cmlwZSBrZXkgKHNrX3Rlc3RfKS4gVGhpcyBpcyBnb29kIGZvciBkZXZlbG9wbWVudC5cIik7XG4gIH0gZWxzZSB7XG4gICAgLy8gVmlzZXIga3VuIGRlIGbDuHJzdGUgb2cgc2lzdGUgdGVnbmVuZSBhdiBuw7hra2VsZW4gYXYgc2lra2VyaGV0c2hlbnN5biBpIGxvZ2dlblxuICAgIGNvbnN0IG1hc2tlZERpc3BsYXlLZXkgPSBhcGlLZXlGcm9tRW52Lmxlbmd0aCA+IDE0ID8gYXBpS2V5RnJvbUVudi5zdWJzdHJpbmcoMCwgNykgKyBcIi4uLlwiICsgYXBpS2V5RnJvbUVudi5zdWJzdHJpbmcoYXBpS2V5RnJvbUVudi5sZW5ndGggLSA0KSA6IGFwaUtleUZyb21FbnY7XG4gICAgY29uc29sZS53YXJuKGDimqDvuI8gbGliL3N0cmlwZS50czogU1RSSVBFX1NFQ1JFVF9LRVkgKFwiJHttYXNrZWREaXNwbGF5S2V5fVwiKSBkb2VzIG5vdCBsb29rIGxpa2UgYSB2YWxpZCBTdHJpcGUgc2VjcmV0IGtleSAoc2hvdWxkIHN0YXJ0IHdpdGggc2tfdGVzdF8gb3Igc2tfbGl2ZV8pLmApO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBtYXNrZWREaXNwbGF5S2V5ID0gYXBpS2V5RnJvbUVudi5sZW5ndGggPiAxNCA/IGFwaUtleUZyb21FbnYuc3Vic3RyaW5nKDAsIDcpICsgXCIuLi5cIiArIGFwaUtleUZyb21FbnYuc3Vic3RyaW5nKGFwaUtleUZyb21FbnYubGVuZ3RoIC0gNCkgOiBhcGlLZXlGcm9tRW52O1xuICAgIGNvbnNvbGUubG9nKGBsaWIvc3RyaXBlLnRzOiBBdHRlbXB0aW5nIHRvIGluaXRpYWxpemUgU3RyaXBlIHdpdGggQVBJIGtleTogJHttYXNrZWREaXNwbGF5S2V5fWApO1xuXG4gICAgY29uc3Qgc3RyaXBlSW5zdGFuY2UgPSBuZXcgU3RyaXBlKGFwaUtleUZyb21FbnYsIHtcbiAgICAgIGFwaVZlcnNpb246IFwiMjAyMy0xMC0xNlwiLCAvLyBEdSBrYW4gb3BwZGF0ZXJlIGRlbm5lIHRpbCBueWVzdGUgU3RyaXBlIGFuYmVmYWxlclxuICAgICAgdHlwZXNjcmlwdDogdHJ1ZSwgLy8gQnJhIGZvciB0eXBlLXNpa2tlcmhldFxuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKFwi4pyFIGxpYi9zdHJpcGUudHM6IFN0cmlwZSBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHkuXCIpO1xuICAgIHJldHVybiBzdHJpcGVJbnN0YW5jZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIGxpYi9zdHJpcGUudHM6IEZhaWxlZCB0byBpbml0aWFsaXplIFN0cmlwZSB3aXRoIEFQSSBrZXkuIEVycm9yOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5cbi8vIEluaXRpYWxpc2VyIFN0cmlwZS1pbnN0YW5zZW4gw6luIGdhbmdcbmV4cG9ydCBjb25zdCBzdHJpcGUgPSBnZXRTdHJpcGVJbnN0YW5jZSgpO1xuXG4vLyAtLS0gSGplbHBlZnVua3Nqb25lciAtLS1cbmNvbnN0IGxvZ1N0cmlwZU9wZXJhdGlvbiA9IChvcGVyYXRpb246IHN0cmluZywgLi4uYXJnczogYW55W10pID0+IHtcbiAgaWYgKGlzRGV2ZWxvcG1lbnQpIHsgLy8gTG9nZyBrdW4gaSB1dHZpa2xpbmdcbiAgICBjb25zb2xlLmxvZyhg8J+UhCBsaWIvc3RyaXBlLnRzOiBTdHJpcGUgT3BlcmF0aW9uIC0gJHtvcGVyYXRpb259OmAsIC4uLmFyZ3MpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZm9ybWF0QW1vdW50Rm9yU3RyaXBlID0gKGFtb3VudDogbnVtYmVyKTogbnVtYmVyID0+IHtcbiAgcmV0dXJuIE1hdGgucm91bmQoYW1vdW50ICogMTAwKTsgLy8gS29udmVydGVyZXIgTk9LIHRpbCDDuHJlXG59O1xuXG5leHBvcnQgY29uc3QgZm9ybWF0QW1vdW50RnJvbVN0cmlwZSA9IChhbW91bnQ6IG51bWJlcik6IG51bWJlciA9PiB7XG4gIHJldHVybiBhbW91bnQgLyAxMDA7IC8vIEtvbnZlcnRlcmVyIMO4cmUgdGlsIE5PS1xufTtcblxuLy8gLS0tIFN0cmlwZSBBUEkta2FsbCBmdW5rc2pvbmVyIC0tLVxuXG5leHBvcnQgY29uc3QgY3JlYXRlQ3VzdG9tZXIgPSBhc3luYyAoZW1haWw6IHN0cmluZywgbmFtZT86IHN0cmluZywgbWV0YWRhdGE/OiBTdHJpcGUuTWV0YWRhdGFQYXJhbSkgPT4ge1xuICBsb2dTdHJpcGVPcGVyYXRpb24oXCJjcmVhdGVDdXN0b21lciAtIFN0YXJ0XCIsIHsgZW1haWwsIG5hbWUsIG1ldGFkYXRhIH0pO1xuICBjb25zb2xlLmxvZyhcIi0tLSBERUJVRzogbGliL3N0cmlwZS50cyAtPiBjcmVhdGVDdXN0b21lciAtLS1cIik7XG4gIGNvbnNvbGUubG9nKFwiSXMgJ3N0cmlwZScgb2JqZWN0IGluaXRpYWxpemVkIGhlcmU/XCIsIHN0cmlwZSA/IFwiWUVTXCIgOiBcIk5PIC0gU3RyaXBlIGtleSBsaWtlbHkgbWlzc2luZy9pbnZhbGlkIGluIGVudiFcIik7XG5cbiAgaWYgKCFzdHJpcGUpIHtcbiAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gbGliL3N0cmlwZS50czogU3RyaXBlIGluc3RhbmNlIGlzIG51bGwgaW4gY3JlYXRlQ3VzdG9tZXIuIFJldHVybmluZyBNT0NLIGN1c3RvbWVyLlwiKTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IFwiY3VzX21vY2tfU1RSSVBFX05VTExfXCIgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KSArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyKSxcbiAgICAgIGVtYWlsLFxuICAgICAgbmFtZSxcbiAgICAgIG1ldGFkYXRhLFxuICAgICAgb2JqZWN0OiAnY3VzdG9tZXInIGFzIGNvbnN0LCAvLyBMZWdnIHRpbCBvYmplY3QgdHlwZSBmb3IgYmVkcmUgdHlwZS1tYXRjaGluZ1xuICAgICAgY3JlYXRlZDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCksXG4gICAgICBlcnJvcjogdHJ1ZSwgLy8gSW5kaWtlcmVyIGF0IGRldHRlIGVyIGVuIG1vY2sgcGdhLiBmZWlsXG4gICAgICBtZXNzYWdlOiBcIlN0cmlwZSBub3QgaW5pdGlhbGl6ZWQgKG51bGwgaW5zdGFuY2UpLCByZXR1cm5pbmcgbW9jayBjdXN0b21lci5cIlxuICAgIH07XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGBsaWIvc3RyaXBlLnRzOiBBdHRlbXB0aW5nIFJFQUwgU3RyaXBlIEFQSSBjYWxsOiBjdXN0b21lcnMuY3JlYXRlIGZvciBlbWFpbDogJHtlbWFpbH1gKTtcbiAgICBjb25zdCBjdXN0b21lclBhcmFtczogU3RyaXBlLkN1c3RvbWVyQ3JlYXRlUGFyYW1zID0geyBlbWFpbCB9O1xuICAgIGlmIChuYW1lKSBjdXN0b21lclBhcmFtcy5uYW1lID0gbmFtZTtcbiAgICBpZiAobWV0YWRhdGEpIGN1c3RvbWVyUGFyYW1zLm1ldGFkYXRhID0gbWV0YWRhdGE7XG5cbiAgICBjb25zdCBjdXN0b21lciA9IGF3YWl0IHN0cmlwZS5jdXN0b21lcnMuY3JlYXRlKGN1c3RvbWVyUGFyYW1zKTtcbiAgICBjb25zb2xlLmxvZyhcIuKchSBsaWIvc3RyaXBlLnRzOiBTdHJpcGUgY3VzdG9tZXIgY3JlYXRlZCBzdWNjZXNzZnVsbHkgdmlhIEFQSS4gSUQ6XCIsIGN1c3RvbWVyLmlkKTtcbiAgICByZXR1cm4gY3VzdG9tZXI7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIGxpYi9zdHJpcGUudHM6IEVycm9yIGNhbGxpbmcgU3RyaXBlIEFQSSAoY3VzdG9tZXJzLmNyZWF0ZSk6XCIsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IFwiY3VzX21vY2tfQVBJX0VSUk9SX1wiICsgRGF0ZS5ub3coKS50b1N0cmluZygzNikgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiksXG4gICAgICBlbWFpbCxcbiAgICAgIG5hbWUsXG4gICAgICBtZXRhZGF0YSxcbiAgICAgIG9iamVjdDogJ2N1c3RvbWVyJyBhcyBjb25zdCxcbiAgICAgIGNyZWF0ZWQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApLFxuICAgICAgZXJyb3I6IHRydWUsXG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8IFwiVW5rbm93biBlcnJvciBkdXJpbmcgU3RyaXBlIEFQSSBjYWxsIHRvIGNyZWF0ZSBjdXN0b21lclwiXG4gICAgfTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVBheW1lbnRJbnRlbnQgPSBhc3luYyAoYW1vdW50OiBudW1iZXIsIGN1cnJlbmN5ID0gXCJub2tcIiwgY3VzdG9tZXJJZD86IHN0cmluZykgPT4ge1xuICBsb2dTdHJpcGVPcGVyYXRpb24oXCJjcmVhdGVQYXltZW50SW50ZW50IC0gU3RhcnRcIiwgeyBhbW91bnQsIGN1cnJlbmN5LCBjdXN0b21lcklkIH0pO1xuICBjb25zb2xlLmxvZyhcIi0tLSBERUJVRzogbGliL3N0cmlwZS50cyAtPiBjcmVhdGVQYXltZW50SW50ZW50IC0tLVwiKTtcbiAgY29uc29sZS5sb2coXCJJcyAnc3RyaXBlJyBvYmplY3QgaW5pdGlhbGl6ZWQgaGVyZT9cIiwgc3RyaXBlID8gXCJZRVNcIiA6IFwiTk8gLSBTdHJpcGUga2V5IGxpa2VseSBtaXNzaW5nL2ludmFsaWQgaW4gZW52IVwiKTtcblxuICBpZiAoIXN0cmlwZSkge1xuICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyBsaWIvc3RyaXBlLnRzOiBTdHJpcGUgaW5zdGFuY2UgaXMgbnVsbCBpbiBjcmVhdGVQYXltZW50SW50ZW50LiBSZXR1cm5pbmcgTU9DSyBQYXltZW50IEludGVudC5cIik7XG4gICAgY29uc3QgbW9ja0NsaWVudFNlY3JldCA9IFwicGlfbW9ja19zZWNyZXRfU1RSSVBFX05VTExfXCIgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KSArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyKTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IFwicGlfbW9ja19TVFJJUEVfTlVMTF9cIiArIERhdGUubm93KCkudG9TdHJpbmcoMzYpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIpLFxuICAgICAgYW1vdW50OiBmb3JtYXRBbW91bnRGb3JTdHJpcGUoYW1vdW50KSxcbiAgICAgIGN1cnJlbmN5LFxuICAgICAgY2xpZW50X3NlY3JldDogbW9ja0NsaWVudFNlY3JldCxcbiAgICAgIGN1c3RvbWVyOiBjdXN0b21lcklkLFxuICAgICAgc3RhdHVzOiAncmVxdWlyZXNfcGF5bWVudF9tZXRob2QnIGFzIFN0cmlwZS5QYXltZW50SW50ZW50LlN0YXR1cyxcbiAgICAgIG9iamVjdDogJ3BheW1lbnRfaW50ZW50JyBhcyBjb25zdCxcbiAgICAgIGVycm9yOiB0cnVlLFxuICAgICAgbWVzc2FnZTogXCJTdHJpcGUgbm90IGluaXRpYWxpemVkIChudWxsIGluc3RhbmNlKSwgcmV0dXJuaW5nIG1vY2sgcGF5bWVudCBpbnRlbnQuXCJcbiAgICB9O1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhgbGliL3N0cmlwZS50czogQXR0ZW1wdGluZyBSRUFMIFN0cmlwZSBBUEkgY2FsbDogcGF5bWVudEludGVudHMuY3JlYXRlLiBBbW91bnQ6ICR7YW1vdW50fSwgQ3VycmVuY3k6ICR7Y3VycmVuY3l9LCBDdXN0b21lcklEOiAke2N1c3RvbWVySWQgfHwgJ05vbmUnfWApO1xuICAgIGNvbnN0IHBheW1lbnRJbnRlbnRQYXJhbXM6IFN0cmlwZS5QYXltZW50SW50ZW50Q3JlYXRlUGFyYW1zID0ge1xuICAgICAgYW1vdW50OiBmb3JtYXRBbW91bnRGb3JTdHJpcGUoYW1vdW50KSxcbiAgICAgIGN1cnJlbmN5LFxuICAgICAgYXV0b21hdGljX3BheW1lbnRfbWV0aG9kczoge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgaWYgKGN1c3RvbWVySWQpIHtcbiAgICAgIHBheW1lbnRJbnRlbnRQYXJhbXMuY3VzdG9tZXIgPSBjdXN0b21lcklkO1xuICAgIH1cblxuICAgIGNvbnN0IHBheW1lbnRJbnRlbnQgPSBhd2FpdCBzdHJpcGUucGF5bWVudEludGVudHMuY3JlYXRlKHBheW1lbnRJbnRlbnRQYXJhbXMpO1xuICAgIGNvbnNvbGUubG9nKFwi4pyFIGxpYi9zdHJpcGUudHM6IFJFQUwgU3RyaXBlIFBheW1lbnQgSW50ZW50IGNyZWF0ZWQuIENsaWVudCBTZWNyZXQgc3RhcnRzIHdpdGg6XCIsIHBheW1lbnRJbnRlbnQuY2xpZW50X3NlY3JldD8uc3Vic3RyaW5nKDAsMTUpICsgXCIuLi5cIik7XG4gICAgcmV0dXJuIHBheW1lbnRJbnRlbnQ7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIGxpYi9zdHJpcGUudHM6IEVycm9yIGNhbGxpbmcgU3RyaXBlIEFQSSAocGF5bWVudEludGVudHMuY3JlYXRlKTpcIiwgZXJyb3IpO1xuICAgIGNvbnN0IG1vY2tDbGllbnRTZWNyZXQgPSBcInBpX21vY2tfc2VjcmV0X0FQSV9FUlJPUl9cIiArIERhdGUubm93KCkudG9TdHJpbmcoMzYpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIpO1xuICAgIHJldHVybiB7XG4gICAgICBpZDogXCJwaV9tb2NrX0FQSV9FUlJPUl9cIiArIERhdGUubm93KCkudG9TdHJpbmcoMzYpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIpLFxuICAgICAgYW1vdW50OiBmb3JtYXRBbW91bnRGb3JTdHJpcGUoYW1vdW50KSxcbiAgICAgIGN1cnJlbmN5LFxuICAgICAgY2xpZW50X3NlY3JldDogbW9ja0NsaWVudFNlY3JldCxcbiAgICAgIGN1c3RvbWVyOiBjdXN0b21lcklkLFxuICAgICAgc3RhdHVzOiAncmVxdWlyZXNfcGF5bWVudF9tZXRob2QnIGFzIFN0cmlwZS5QYXltZW50SW50ZW50LlN0YXR1cyxcbiAgICAgIG9iamVjdDogJ3BheW1lbnRfaW50ZW50JyBhcyBjb25zdCxcbiAgICAgIGVycm9yOiB0cnVlLFxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCBcIlVua25vd24gZXJyb3IgZHVyaW5nIFN0cmlwZSBBUEkgY2FsbCB0byBjcmVhdGUgcGF5bWVudCBpbnRlbnRcIlxuICAgIH07XG4gIH1cbn07XG5cblxuLy8gLS0tIERpbmUgYW5kcmUgU3RyaXBlLWhqZWxwZWZ1bmtzam9uZXIgLS0tXG4vLyBEdSBiw7hyIGfDpSBnamVubm9tIGRpc3NlIG9nIGxlZ2dlIHRpbCBsaWduZW5kZSBgaWYgKCFzdHJpcGUpYCBzamVra2VyIG9nIGxvZ2dpbmdcbi8vIGh2aXMgZHUgdmlsIGF0IGRlIHNrYWwgaMOlbmR0ZXJlIG1hbmdsZW5kZSBTdHJpcGUtaW5pdGlhbGlzZXJpbmcgZ3Jhc2nDuHN0XG4vLyBlbGxlciBhbGx0aWQgcHLDuHZlIGVrdGUga2FsbCBodmlzIGBzdHJpcGVgIGVyIHRpbGdqZW5nZWxpZy5cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUludm9pY2UgPSBhc3luYyAoY3VzdG9tZXJJZDogc3RyaW5nLCBkZXNjcmlwdGlvbjogc3RyaW5nLCBhbW91bnQ6IG51bWJlciwgY3VycmVuY3kgPSBcIm5va1wiKSA9PiB7XG4gIGxvZ1N0cmlwZU9wZXJhdGlvbihcImNyZWF0ZUludm9pY2UgLSBTdGFydFwiLCB7IGN1c3RvbWVySWQsIGRlc2NyaXB0aW9uLCBhbW91bnQsIGN1cnJlbmN5IH0pO1xuICBjb25zb2xlLmxvZyhcIi0tLSBERUJVRzogbGliL3N0cmlwZS50cyAtPiBjcmVhdGVJbnZvaWNlIC0tLSAnc3RyaXBlJyBpbml0aWFsaXplZD9cIiwgc3RyaXBlID8gXCJZRVNcIiA6IFwiTk9cIik7XG4gIGlmICghc3RyaXBlKSB7XG4gICAgY29uc29sZS53YXJuKFwi4pqg77iPIGxpYi9zdHJpcGUudHM6IFN0cmlwZSBpbnN0YW5jZSBpcyBudWxsIGluIGNyZWF0ZUludm9pY2UuIFJldHVybmluZyBNT0NLIGludm9pY2UuXCIpO1xuICAgIHJldHVybiB7XG4gICAgICBpZDogXCJpbl9tb2NrX1NUUklQRV9OVUxMX1wiICsgRGF0ZS5ub3coKS50b1N0cmluZygzNiksXG4gICAgICBjdXN0b21lcjogY3VzdG9tZXJJZCxcbiAgICAgIGFtb3VudF9kdWU6IGZvcm1hdEFtb3VudEZvclN0cmlwZShhbW91bnQpLFxuICAgICAgY3VycmVuY3ksXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHN0YXR1czogXCJvcGVuXCIsXG4gICAgICBkdWVfZGF0ZTogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyA4NjQwMCAqIDMwLFxuICAgICAgY3JlYXRlZDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCksXG4gICAgICBlcnJvcjogdHJ1ZSwgbWVzc2FnZTogXCJTdHJpcGUgbm90IGluaXRpYWxpemVkXCJcbiAgICB9O1xuICB9XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coYGxpYi9zdHJpcGUudHM6IEF0dGVtcHRpbmcgUkVBTCBTdHJpcGUgQVBJIGNhbGwgZm9yIGNyZWF0ZUludm9pY2UuIEN1c3RvbWVyOiAke2N1c3RvbWVySWR9YCk7XG4gICAgY29uc3QgaW52b2ljZUl0ZW0gPSBhd2FpdCBzdHJpcGUuaW52b2ljZUl0ZW1zLmNyZWF0ZSh7XG4gICAgICBjdXN0b21lcjogY3VzdG9tZXJJZCxcbiAgICAgIGFtb3VudDogZm9ybWF0QW1vdW50Rm9yU3RyaXBlKGFtb3VudCksXG4gICAgICBjdXJyZW5jeSxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgIH0pO1xuICAgIGNvbnN0IGludm9pY2UgPSBhd2FpdCBzdHJpcGUuaW52b2ljZXMuY3JlYXRlKHtcbiAgICAgIGN1c3RvbWVyOiBjdXN0b21lcklkLFxuICAgICAgYXV0b19hZHZhbmNlOiB0cnVlLFxuICAgICAgY29sbGVjdGlvbl9tZXRob2Q6IFwic2VuZF9pbnZvaWNlXCIsXG4gICAgICBkYXlzX3VudGlsX2R1ZTogMzAsXG4gICAgfSk7XG4gICAgY29uc3QgZmluYWxpemVkSW52b2ljZSA9IGF3YWl0IHN0cmlwZS5pbnZvaWNlcy5maW5hbGl6ZUludm9pY2UoaW52b2ljZS5pZCk7XG4gICAgYXdhaXQgc3RyaXBlLmludm9pY2VzLnNlbmRJbnZvaWNlKGZpbmFsaXplZEludm9pY2UuaWQpO1xuICAgIGNvbnNvbGUubG9nKFwi4pyFIGxpYi9zdHJpcGUudHM6IFJFQUwgU3RyaXBlIEludm9pY2UgY3JlYXRlZCBhbmQgc2VudC4gSUQ6XCIsIGZpbmFsaXplZEludm9pY2UuaWQpO1xuICAgIHJldHVybiBmaW5hbGl6ZWRJbnZvaWNlO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcihcIuKdjCBsaWIvc3RyaXBlLnRzOiBFcnJvciBjcmVhdGluZyBSRUFMIFN0cmlwZSBpbnZvaWNlOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBcImluX21vY2tfQVBJX0VSUk9SX1wiICsgRGF0ZS5ub3coKS50b1N0cmluZygzNiksXG4gICAgICBjdXN0b21lcjogY3VzdG9tZXJJZCxcbiAgICAgIGFtb3VudF9kdWU6IGZvcm1hdEFtb3VudEZvclN0cmlwZShhbW91bnQpLFxuICAgICAgY3VycmVuY3ksXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHN0YXR1czogXCJvcGVuXCIsXG4gICAgICBkdWVfZGF0ZTogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyA4NjQwMCAqIDMwLFxuICAgICAgY3JlYXRlZDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCksXG4gICAgICBlcnJvcjogdHJ1ZSwgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCBcIlVua25vd24gQVBJIGVycm9yIGNyZWF0aW5nIGludm9pY2VcIlxuICAgIH07XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZXRDdXN0b21lckludm9pY2VzID0gYXN5bmMgKGN1c3RvbWVySWQ6IHN0cmluZykgPT4ge1xuICBsb2dTdHJpcGVPcGVyYXRpb24oXCJnZXRDdXN0b21lckludm9pY2VzIC0gU3RhcnRcIiwgeyBjdXN0b21lcklkIH0pO1xuICBjb25zb2xlLmxvZyhcIi0tLSBERUJVRzogbGliL3N0cmlwZS50cyAtPiBnZXRDdXN0b21lckludm9pY2VzIC0tLSAnc3RyaXBlJyBpbml0aWFsaXplZD9cIiwgc3RyaXBlID8gXCJZRVNcIiA6IFwiTk9cIik7XG4gIGlmICghc3RyaXBlKSB7XG4gICAgY29uc29sZS53YXJuKFwi4pqg77iPIGxpYi9zdHJpcGUudHM6IFN0cmlwZSBpbnN0YW5jZSBpcyBudWxsIGluIGdldEN1c3RvbWVySW52b2ljZXMuIFJldHVybmluZyBNT0NLIGludm9pY2VzLlwiKTtcbiAgICByZXR1cm4gW1xuICAgICAge1xuICAgICAgICBpZDogXCJpbl9tb2NrX1NUUklQRV9OVUxMX2N1c3RfaW52XCIsIGN1c3RvbWVyOiBjdXN0b21lcklkLCBhbW91bnRfZHVlOiAxMDAwMCwgY3VycmVuY3k6IFwibm9rXCIsIHN0YXR1czogXCJvcGVuXCIsXG4gICAgICAgIGR1ZV9kYXRlOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSArIDg2NDAwICogMzAsIGhvc3RlZF9pbnZvaWNlX3VybDogXCIjXCIsIGNyZWF0ZWQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApIC0gODY0MDAsXG4gICAgICAgIGVycm9yOiB0cnVlLCBtZXNzYWdlOiBcIlN0cmlwZSBub3QgaW5pdGlhbGl6ZWRcIlxuICAgICAgfVxuICAgIF07XG4gIH1cbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhgbGliL3N0cmlwZS50czogQXR0ZW1wdGluZyBSRUFMIFN0cmlwZSBBUEkgY2FsbCBmb3IgZ2V0Q3VzdG9tZXJJbnZvaWNlcy4gQ3VzdG9tZXI6ICR7Y3VzdG9tZXJJZH1gKTtcbiAgICBjb25zdCBpbnZvaWNlcyA9IGF3YWl0IHN0cmlwZS5pbnZvaWNlcy5saXN0KHsgY3VzdG9tZXI6IGN1c3RvbWVySWQsIGxpbWl0OiAxMDAgfSk7XG4gICAgY29uc29sZS5sb2coYOKchSBsaWIvc3RyaXBlLnRzOiBGZXRjaGVkICR7aW52b2ljZXMuZGF0YS5sZW5ndGh9IFJFQUwgU3RyaXBlIEludm9pY2VzIGZvciBjdXN0b21lci5gKTtcbiAgICByZXR1cm4gaW52b2ljZXMuZGF0YTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgbGliL3N0cmlwZS50czogRXJyb3IgZmV0Y2hpbmcgUkVBTCBjdXN0b21lciBpbnZvaWNlczpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBbXG4gICAgICB7XG4gICAgICAgIGlkOiBcImluX21vY2tfQVBJX0VSUk9SX2N1c3RfaW52XCIsIGN1c3RvbWVyOiBjdXN0b21lcklkLCBhbW91bnRfZHVlOiAxMDAwMCwgY3VycmVuY3k6IFwibm9rXCIsIHN0YXR1czogXCJvcGVuXCIsXG4gICAgICAgIGR1ZV9kYXRlOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSArIDg2NDAwICogMzAsIGhvc3RlZF9pbnZvaWNlX3VybDogXCIjXCIsIGNyZWF0ZWQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApIC0gODY0MDAsXG4gICAgICAgIGVycm9yOiB0cnVlLCBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8IFwiVW5rbm93biBBUEkgZXJyb3IgZmV0Y2hpbmcgaW52b2ljZXNcIlxuICAgICAgfVxuICAgIF07XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBwYXlJbnZvaWNlID0gYXN5bmMgKGludm9pY2VJZDogc3RyaW5nKSA9PiB7XG4gIGxvZ1N0cmlwZU9wZXJhdGlvbihcInBheUludm9pY2UgLSBTdGFydFwiLCB7IGludm9pY2VJZCB9KTtcbiAgY29uc29sZS5sb2coXCItLS0gREVCVUc6IGxpYi9zdHJpcGUudHMgLT4gcGF5SW52b2ljZSAtLS0gJ3N0cmlwZScgaW5pdGlhbGl6ZWQ/XCIsIHN0cmlwZSA/IFwiWUVTXCIgOiBcIk5PXCIpO1xuICBpZiAoIXN0cmlwZSkge1xuICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyBsaWIvc3RyaXBlLnRzOiBTdHJpcGUgaW5zdGFuY2UgaXMgbnVsbCBpbiBwYXlJbnZvaWNlLiBSZXR1cm5pbmcgTU9DSyBwYXltZW50IHN0YXR1cy5cIik7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBpbnZvaWNlSWQsIHN0YXR1czogXCJwYWlkXCIsIHBhaWQ6IHRydWUsIGFtb3VudF9wYWlkOiAxMDAwMCwgY3VycmVuY3k6IFwibm9rXCIsXG4gICAgICBlcnJvcjogdHJ1ZSwgbWVzc2FnZTogXCJTdHJpcGUgbm90IGluaXRpYWxpemVkXCJcbiAgICB9O1xuICB9XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coYGxpYi9zdHJpcGUudHM6IEF0dGVtcHRpbmcgUkVBTCBTdHJpcGUgQVBJIGNhbGwgZm9yIHBheUludm9pY2UuIEludm9pY2UgSUQ6ICR7aW52b2ljZUlkfWApO1xuICAgIGNvbnN0IGludm9pY2UgPSBhd2FpdCBzdHJpcGUuaW52b2ljZXMucGF5KGludm9pY2VJZCk7XG4gICAgY29uc29sZS5sb2coXCLinIUgbGliL3N0cmlwZS50czogUkVBTCBTdHJpcGUgSW52b2ljZSBwYWlkLiBTdGF0dXM6XCIsIGludm9pY2Uuc3RhdHVzKTtcbiAgICByZXR1cm4gaW52b2ljZTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgbGliL3N0cmlwZS50czogRXJyb3IgcGF5aW5nIFJFQUwgU3RyaXBlIGludm9pY2U6XCIsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGludm9pY2VJZCwgc3RhdHVzOiBcIm9wZW5cIiwgcGFpZDogZmFsc2UsIC8qYW1vdW50X3BhaWQgbWlnaHQgbm90IGJlIHNldCovXG4gICAgICBlcnJvcjogdHJ1ZSwgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCBcIlVua25vd24gQVBJIGVycm9yIHBheWluZyBpbnZvaWNlXCJcbiAgICB9O1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgY3JlYXRlVGVzdEludm9pY2UgPSBhc3luYyAoY3VzdG9tZXJJZDogc3RyaW5nKSA9PiB7XG4gIGxvZ1N0cmlwZU9wZXJhdGlvbihcImNyZWF0ZVRlc3RJbnZvaWNlIC0gU3RhcnRcIiwgeyBjdXN0b21lcklkIH0pO1xuICBjb25zb2xlLmxvZyhcIi0tLSBERUJVRzogbGliL3N0cmlwZS50cyAtPiBjcmVhdGVUZXN0SW52b2ljZSAtLS0gJ3N0cmlwZScgaW5pdGlhbGl6ZWQ/XCIsIHN0cmlwZSA/IFwiWUVTXCIgOiBcIk5PXCIpO1xuXG4gIGlmICghaXNEZXZlbG9wbWVudCkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgbGliL3N0cmlwZS50czogY3JlYXRlVGVzdEludm9pY2UgY2FsbGVkIG91dHNpZGUgZGV2ZWxvcG1lbnQgbW9kZS5cIik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVGVzdCBpbnZvaWNlcyBjYW4gb25seSBiZSBjcmVhdGVkIGluIGRldmVsb3BtZW50IG1vZGVcIik7XG4gIH1cbiAgaWYgKCFjdXN0b21lcklkKSB7XG4gICAgY29uc29sZS5lcnJvcihcIuKdjCBsaWIvc3RyaXBlLnRzOiBDdXN0b21lciBJRCBpcyByZXF1aXJlZCBmb3IgY3JlYXRlVGVzdEludm9pY2UuXCIpO1xuICAgIHRocm93IG5ldyBFcnJvcihcIkN1c3RvbWVyIElEIGlzIHJlcXVpcmVkIHRvIGNyZWF0ZSBhIHRlc3QgaW52b2ljZVwiKTtcbiAgfVxuICBpZiAoIXN0cmlwZSkge1xuICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyBsaWIvc3RyaXBlLnRzOiBTdHJpcGUgaW5zdGFuY2UgaXMgbnVsbCBpbiBjcmVhdGVUZXN0SW52b2ljZS4gUmV0dXJuaW5nIE1PQ0sgdGVzdCBpbnZvaWNlLlwiKTtcbiAgICBjb25zdCBhbW91bnQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA5MDApICsgMTAwO1xuICAgIHJldHVybiB7XG4gICAgICBpZDogXCJpbl90ZXN0X21vY2tfU1RSSVBFX05VTExfXCIgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KSxcbiAgICAgIG51bWJlcjogXCJURVNUX01PQ0tcIiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwKSxcbiAgICAgIGN1c3RvbWVyOiBjdXN0b21lcklkLFxuICAgICAgYW1vdW50X2R1ZTogZm9ybWF0QW1vdW50Rm9yU3RyaXBlKGFtb3VudCksXG4gICAgICBjdXJyZW5jeTogXCJub2tcIixcbiAgICAgIGRlc2NyaXB0aW9uOiBcIk1vY2sgVGVzdCBJbnZvaWNlIC0gU3RyaXBlIE5vdCBJbml0aWFsaXplZFwiLFxuICAgICAgc3RhdHVzOiBcIm9wZW5cIixcbiAgICAgIGR1ZV9kYXRlOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSArIDg2NDAwICogMzAsXG4gICAgICBjcmVhdGVkOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSxcbiAgICAgIGVycm9yOiB0cnVlLFxuICAgICAgbWVzc2FnZTogXCJTdHJpcGUgbm90IGluaXRpYWxpemVkXCJcbiAgICB9O1xuICB9XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coYGxpYi9zdHJpcGUudHM6IEF0dGVtcHRpbmcgUkVBTCBTdHJpcGUgQVBJIGNhbGwgZm9yIGNyZWF0ZVRlc3RJbnZvaWNlLiBDdXN0b21lcjogJHtjdXN0b21lcklkfWApO1xuICAgIGNvbnN0IGFtb3VudCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDkwMCkgKyAxMDA7XG4gICAgY29uc3QgaW52b2ljZUl0ZW0gPSBhd2FpdCBzdHJpcGUuaW52b2ljZUl0ZW1zLmNyZWF0ZSh7XG4gICAgICBjdXN0b21lcjogY3VzdG9tZXJJZCxcbiAgICAgIGFtb3VudDogZm9ybWF0QW1vdW50Rm9yU3RyaXBlKGFtb3VudCksXG4gICAgICBjdXJyZW5jeTogXCJub2tcIixcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlRlc3QgSW52b2ljZSAtIERldmVsb3BtZW50IE9ubHkgKFJFQUwgQ0FMTClcIixcbiAgICB9KTtcbiAgICBjb25zdCBpbnZvaWNlID0gYXdhaXQgc3RyaXBlLmludm9pY2VzLmNyZWF0ZSh7XG4gICAgICBjdXN0b21lcjogY3VzdG9tZXJJZCxcbiAgICAgIGF1dG9fYWR2YW5jZTogdHJ1ZSxcbiAgICAgIGNvbGxlY3Rpb25fbWV0aG9kOiBcInNlbmRfaW52b2ljZVwiLFxuICAgICAgZGF5c191bnRpbF9kdWU6IDMwLFxuICAgIH0pO1xuICAgIGNvbnN0IGZpbmFsaXplZEludm9pY2UgPSBhd2FpdCBzdHJpcGUuaW52b2ljZXMuZmluYWxpemVJbnZvaWNlKGludm9pY2UuaWQpO1xuICAgIGNvbnNvbGUubG9nKFwi4pyFIGxpYi9zdHJpcGUudHM6IFJFQUwgU3RyaXBlIFRlc3QgSW52b2ljZSBjcmVhdGVkLiBJRDpcIiwgZmluYWxpemVkSW52b2ljZS5pZCk7XG4gICAgcmV0dXJuIGZpbmFsaXplZEludm9pY2U7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIGxpYi9zdHJpcGUudHM6IEVycm9yIGNyZWF0aW5nIFJFQUwgdGVzdCBpbnZvaWNlOlwiLCBlcnJvcik7XG4gICAgY29uc3QgYW1vdW50ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogOTAwKSArIDEwMDtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IFwiaW5fdGVzdF9tb2NrX0FQSV9FUlJPUl9cIiArIERhdGUubm93KCkudG9TdHJpbmcoMzYpLFxuICAgICAgbnVtYmVyOiBcIlRFU1RfTU9DS19FUlJPUlwiICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApLFxuICAgICAgY3VzdG9tZXI6IGN1c3RvbWVySWQsXG4gICAgICBhbW91bnRfZHVlOiBmb3JtYXRBbW91bnRGb3JTdHJpcGUoYW1vdW50KSxcbiAgICAgIGN1cnJlbmN5OiBcIm5va1wiLFxuICAgICAgZGVzY3JpcHRpb246IFwiTW9jayBUZXN0IEludm9pY2UgLSBBUEkgRXJyb3JcIixcbiAgICAgIHN0YXR1czogXCJvcGVuXCIsXG4gICAgICBkdWVfZGF0ZTogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyA4NjQwMCAqIDMwLFxuICAgICAgY3JlYXRlZDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCksXG4gICAgICBlcnJvcjogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJVbmtub3duIGVycm9yXCJcbiAgICB9O1xuICB9XG59OyJdLCJuYW1lcyI6WyJTdHJpcGUiLCJpc0RldmVsb3BtZW50IiwicHJvY2VzcyIsImdldFN0cmlwZUluc3RhbmNlIiwiYXBpS2V5RnJvbUVudiIsImVudiIsIlNUUklQRV9TRUNSRVRfS0VZIiwiY29uc29sZSIsImxvZyIsIndhcm4iLCJzdGFydHNXaXRoIiwibWFza2VkRGlzcGxheUtleSIsImxlbmd0aCIsInN1YnN0cmluZyIsInN0cmlwZUluc3RhbmNlIiwiYXBpVmVyc2lvbiIsInR5cGVzY3JpcHQiLCJlcnJvciIsInN0cmlwZSIsImxvZ1N0cmlwZU9wZXJhdGlvbiIsIm9wZXJhdGlvbiIsImFyZ3MiLCJmb3JtYXRBbW91bnRGb3JTdHJpcGUiLCJhbW91bnQiLCJNYXRoIiwicm91bmQiLCJmb3JtYXRBbW91bnRGcm9tU3RyaXBlIiwiY3JlYXRlQ3VzdG9tZXIiLCJlbWFpbCIsIm5hbWUiLCJtZXRhZGF0YSIsImlkIiwiRGF0ZSIsIm5vdyIsInRvU3RyaW5nIiwicmFuZG9tIiwib2JqZWN0IiwiY3JlYXRlZCIsImZsb29yIiwibWVzc2FnZSIsImN1c3RvbWVyUGFyYW1zIiwiY3VzdG9tZXIiLCJjdXN0b21lcnMiLCJjcmVhdGUiLCJjcmVhdGVQYXltZW50SW50ZW50IiwiY3VycmVuY3kiLCJjdXN0b21lcklkIiwibW9ja0NsaWVudFNlY3JldCIsImNsaWVudF9zZWNyZXQiLCJzdGF0dXMiLCJwYXltZW50SW50ZW50UGFyYW1zIiwiYXV0b21hdGljX3BheW1lbnRfbWV0aG9kcyIsImVuYWJsZWQiLCJwYXltZW50SW50ZW50IiwicGF5bWVudEludGVudHMiLCJjcmVhdGVJbnZvaWNlIiwiZGVzY3JpcHRpb24iLCJhbW91bnRfZHVlIiwiZHVlX2RhdGUiLCJpbnZvaWNlSXRlbSIsImludm9pY2VJdGVtcyIsImludm9pY2UiLCJpbnZvaWNlcyIsImF1dG9fYWR2YW5jZSIsImNvbGxlY3Rpb25fbWV0aG9kIiwiZGF5c191bnRpbF9kdWUiLCJmaW5hbGl6ZWRJbnZvaWNlIiwiZmluYWxpemVJbnZvaWNlIiwic2VuZEludm9pY2UiLCJnZXRDdXN0b21lckludm9pY2VzIiwiaG9zdGVkX2ludm9pY2VfdXJsIiwibGlzdCIsImxpbWl0IiwiZGF0YSIsInBheUludm9pY2UiLCJpbnZvaWNlSWQiLCJwYWlkIiwiYW1vdW50X3BhaWQiLCJwYXkiLCJjcmVhdGVUZXN0SW52b2ljZSIsIkVycm9yIiwibnVtYmVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/stripe.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/set-cookie-parser","vendor-chunks/webidl-conversions","vendor-chunks/jose","vendor-chunks/stripe","vendor-chunks/qs","vendor-chunks/object-inspect","vendor-chunks/get-intrinsic","vendor-chunks/side-channel-list","vendor-chunks/side-channel-weakmap","vendor-chunks/has-symbols","vendor-chunks/function-bind","vendor-chunks/side-channel-map","vendor-chunks/side-channel","vendor-chunks/get-proto","vendor-chunks/call-bind-apply-helpers","vendor-chunks/dunder-proto","vendor-chunks/math-intrinsics","vendor-chunks/call-bound","vendor-chunks/es-errors","vendor-chunks/gopd","vendor-chunks/es-define-property","vendor-chunks/hasown","vendor-chunks/es-object-atoms"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fwebhook%2Froute&page=%2Fapi%2Fstripe%2Fwebhook%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fwebhook%2Froute.ts&appDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();