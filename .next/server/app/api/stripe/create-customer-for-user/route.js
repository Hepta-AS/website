"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/stripe/create-customer-for-user/route";
exports.ids = ["app/api/stripe/create-customer-for-user/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute&page=%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute.ts&appDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute&page=%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute.ts&appDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_alexanderamundsen_WebstormProjects_wasd_app_api_stripe_create_customer_for_user_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/stripe/create-customer-for-user/route.ts */ \"(rsc)/./app/api/stripe/create-customer-for-user/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/stripe/create-customer-for-user/route\",\n        pathname: \"/api/stripe/create-customer-for-user\",\n        filename: \"route\",\n        bundlePath: \"app/api/stripe/create-customer-for-user/route\"\n    },\n    resolvedPagePath: \"/Users/alexanderamundsen/WebstormProjects/wasd/app/api/stripe/create-customer-for-user/route.ts\",\n    nextConfigOutput,\n    userland: _Users_alexanderamundsen_WebstormProjects_wasd_app_api_stripe_create_customer_for_user_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/stripe/create-customer-for-user/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZzdHJpcGUlMkZjcmVhdGUtY3VzdG9tZXItZm9yLXVzZXIlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnN0cmlwZSUyRmNyZWF0ZS1jdXN0b21lci1mb3ItdXNlciUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnN0cmlwZSUyRmNyZWF0ZS1jdXN0b21lci1mb3ItdXNlciUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmFsZXhhbmRlcmFtdW5kc2VuJTJGV2Vic3Rvcm1Qcm9qZWN0cyUyRndhc2QlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGYWxleGFuZGVyYW11bmRzZW4lMkZXZWJzdG9ybVByb2plY3RzJTJGd2FzZCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDK0M7QUFDNUg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oZXB0YS1kYXNoYm9hcmQvPzA2YjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2FsZXhhbmRlcmFtdW5kc2VuL1dlYnN0b3JtUHJvamVjdHMvd2FzZC9hcHAvYXBpL3N0cmlwZS9jcmVhdGUtY3VzdG9tZXItZm9yLXVzZXIvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3N0cmlwZS9jcmVhdGUtY3VzdG9tZXItZm9yLXVzZXIvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zdHJpcGUvY3JlYXRlLWN1c3RvbWVyLWZvci11c2VyXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9zdHJpcGUvY3JlYXRlLWN1c3RvbWVyLWZvci11c2VyL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2FsZXhhbmRlcmFtdW5kc2VuL1dlYnN0b3JtUHJvamVjdHMvd2FzZC9hcHAvYXBpL3N0cmlwZS9jcmVhdGUtY3VzdG9tZXItZm9yLXVzZXIvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3N0cmlwZS9jcmVhdGUtY3VzdG9tZXItZm9yLXVzZXIvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute&page=%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute.ts&appDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/stripe/create-customer-for-user/route.ts":
/*!**********************************************************!*\
  !*** ./app/api/stripe/create-customer-for-user/route.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/auth-helpers-nextjs */ \"(rsc)/./node_modules/@supabase/auth-helpers-nextjs/dist/index.js\");\n/* harmony import */ var _supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _lib_stripe__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/stripe */ \"(rsc)/./lib/stripe.ts\");\n// app/api/stripe/create-customer-for-user/route.ts\n\n\n\n // Anta at createCustomer er justert som tidligere diskutert\nasync function POST(req) {\n    try {\n        // Hent brukerdata direkte fra Supabase Auth sesjonen på serveren\n        // i stedet for å stole på at klienten sender korrekt userId.\n        // Dette er sikrere og mer pålitelig.\n        const supabase = (0,_supabase_auth_helpers_nextjs__WEBPACK_IMPORTED_MODULE_1__.createRouteHandlerClient)({\n            cookies: next_headers__WEBPACK_IMPORTED_MODULE_2__.cookies\n        });\n        const { data: { user: authUser }, error: authError } = await supabase.auth.getUser();\n        if (authError || !authUser) {\n            console.error(\"Auth error or no user:\", authError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"User not authenticated or session expired\"\n            }, {\n                status: 401\n            });\n        }\n        const authUserId = authUser.id; // Dette er brukerens UUID fra auth.users\n        const userEmail = authUser.email;\n        // Hent navn fra request body hvis det sendes, ellers kanskje fra user_metadata\n        const { name: requestName } = await req.json().catch(()=>({\n                name: undefined\n            })); // Håndter hvis body er tom/feil\n        const name = requestName || authUser.user_metadata?.full_name; // Eksempel på fallback\n        if (!authUserId || !userEmail) {\n            // Dette burde ikke skje hvis authUser er gyldig, men som en ekstra sjekk\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"User ID or email missing from session\"\n            }, {\n                status: 400\n            });\n        }\n        // Sjekk om brukeren allerede har en customer ID\n        // Bruk 'user_id'-kolonnen (som er UUID) for å slå opp profilen\n        const { data: profile, error: profileError } = await supabase.from(\"profiles\").select(\"stripe_customer_id, id\") // Velg også den numeriske 'id' hvis du trenger den senere\n        .eq(\"user_id\", authUserId) // <--- KORRIGERT: Bruk 'user_id'-kolonnen\n        .single();\n        if (profileError && profileError.code !== \"PGRST116\") {\n            console.error(\"Error fetching profile:\", profileError);\n            // Ikke kast feilen her, la den gå videre til generell feilhåndtering\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `Error fetching profile: ${profileError.message}`\n            }, {\n                status: 500\n            });\n        }\n        // If the user already has a customer ID, return it\n        if (profile?.stripe_customer_id) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                customerId: profile.stripe_customer_id\n            });\n        }\n        // Create a new Stripe customer\n        // Sørg for at createCustomer-funksjonen i lib/stripe.ts er robust\n        const customer = await (0,_lib_stripe__WEBPACK_IMPORTED_MODULE_3__.createCustomer)(userEmail, name, {\n            supabaseUUID: authUserId\n        }); // Send med supabaseUUID som metadata\n        if (!customer || customer.error || !customer.id) {\n            console.error(\"Failed to create Stripe customer object or customer ID missing:\", customer);\n            const stripeErrorMessage = customer?.message || \"Stripe customer creation returned invalid data\";\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `Failed to create Stripe customer: ${stripeErrorMessage}`\n            }, {\n                status: 500\n            });\n        }\n        // Lagre/oppdater customer ID til brukerens profil\n        // Bruk 'user_id' for å identifisere raden, og la 'id' (bigint) auto-inkrementere hvis det er en ny profil\n        const upsertData = {\n            user_id: authUserId,\n            stripe_customer_id: customer.id,\n            updated_at: new Date().toISOString()\n        };\n        // Hvis det er en ny profil, må du også sette inn verdier for andre påkrevde felter\n        // eller la dem ha default-verdier i databasen.\n        // Siden 'id' (bigint) er primærnøkkel og sannsynligvis auto-generert,\n        // trenger vi ikke å spesifisere den for en ny rad hvis 'user_id' er den unike nøkkelen for upsert.\n        // Supabase upsert vil bruke 'user_id' for konfliktløsning hvis du har en UNIQUE constraint på den.\n        // Hvis 'id' (bigint) er den du vil upsert-e på (og du har den fra 'profile' hvis den fantes), juster deretter.\n        // Mest sannsynlig vil du upsert-e basert på user_id for å sikre at én auth-bruker har én profil.\n        // Forutsetter at 'user_id' i 'profiles' har en UNIQUE constraint for at upsert skal fungere som forventet.\n        // Eller at du vil oppdatere basert på den numeriske 'id' hvis profilen ble funnet.\n        let finalUpsertData;\n        if (profile && profile.id) {\n            finalUpsertData = {\n                ...upsertData,\n                id: profile.id\n            };\n        } else {\n            finalUpsertData = {\n                ...upsertData\n            };\n            // Hvis du også setter navn/epost ved profil-opprettelse:\n            if (name) finalUpsertData.name = name;\n        // if (userEmail && !profile) finalUpsertData.email = userEmail; // hvis profiles har en email-kolonne\n        }\n        const { error: upsertError } = await supabase.from(\"profiles\").upsert(finalUpsertData, {\n            onConflict: \"user_id\"\n        }); // Upsert basert på user_id (krever UNIQUE constraint på user_id)\n        // Hvis du vil upsert-e på den numeriske 'id', bruk { onConflict: 'id' } og sørg for at 'id' er i finalUpsertData\n        if (upsertError) {\n            console.error(\"Error saving customer ID to profile:\", upsertError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `Error saving Stripe customer ID: ${upsertError.message}`\n            }, {\n                status: 500\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            customerId: customer.id\n        });\n    } catch (error) {\n        console.error(\"Unhandled error in create Stripe customer endpoint:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: `Failed to create Stripe customer (unhandled): ${error.message}`\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3N0cmlwZS9jcmVhdGUtY3VzdG9tZXItZm9yLXVzZXIvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsbURBQW1EO0FBQ1I7QUFDOEI7QUFDbEM7QUFDTyxDQUFDLDREQUE0RDtBQUVwRyxlQUFlSSxLQUFLQyxHQUFZO0lBQ3JDLElBQUk7UUFDRixpRUFBaUU7UUFDakUsNkRBQTZEO1FBQzdELHFDQUFxQztRQUNyQyxNQUFNQyxXQUFXTCx1RkFBd0JBLENBQUM7WUFBRUMsT0FBT0EsbURBQUFBO1FBQUM7UUFDcEQsTUFBTSxFQUFFSyxNQUFNLEVBQUVDLE1BQU1DLFFBQVEsRUFBRSxFQUFFQyxPQUFPQyxTQUFTLEVBQUUsR0FBRyxNQUFNTCxTQUFTTSxJQUFJLENBQUNDLE9BQU87UUFFbEYsSUFBSUYsYUFBYSxDQUFDRixVQUFVO1lBQzFCSyxRQUFRSixLQUFLLENBQUMsMEJBQTBCQztZQUN4QyxPQUFPWCxxREFBWUEsQ0FBQ2UsSUFBSSxDQUFDO2dCQUFFTCxPQUFPO1lBQTRDLEdBQUc7Z0JBQUVNLFFBQVE7WUFBSTtRQUNqRztRQUVBLE1BQU1DLGFBQWFSLFNBQVNTLEVBQUUsRUFBRSx5Q0FBeUM7UUFDekUsTUFBTUMsWUFBWVYsU0FBU1csS0FBSztRQUVoQywrRUFBK0U7UUFDL0UsTUFBTSxFQUFFQyxNQUFNQyxXQUFXLEVBQUUsR0FBRyxNQUFNakIsSUFBSVUsSUFBSSxHQUFHUSxLQUFLLENBQUMsSUFBTztnQkFBRUYsTUFBTUc7WUFBVSxLQUFLLGdDQUFnQztRQUNuSCxNQUFNSCxPQUFPQyxlQUFlYixTQUFTZ0IsYUFBYSxFQUFFQyxXQUFXLHVCQUF1QjtRQUV0RixJQUFJLENBQUNULGNBQWMsQ0FBQ0UsV0FBVztZQUM3Qix5RUFBeUU7WUFDekUsT0FBT25CLHFEQUFZQSxDQUFDZSxJQUFJLENBQUM7Z0JBQUVMLE9BQU87WUFBd0MsR0FBRztnQkFBRU0sUUFBUTtZQUFJO1FBQzdGO1FBRUEsZ0RBQWdEO1FBQ2hE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QztRQUFDLEdBQzFFO1lBQUVsQixRQUFRO1FBQUk7SUFFcEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2hlcHRhLWRhc2hib2FyZC8uL2FwcC9hcGkvc3RyaXBlL2NyZWF0ZS1jdXN0b21lci1mb3ItdXNlci9yb3V0ZS50cz80MzIyIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGFwcC9hcGkvc3RyaXBlL2NyZWF0ZS1jdXN0b21lci1mb3ItdXNlci9yb3V0ZS50c1xuaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XG5pbXBvcnQgeyBjcmVhdGVSb3V0ZUhhbmRsZXJDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL2F1dGgtaGVscGVycy1uZXh0anNcIjtcbmltcG9ydCB7IGNvb2tpZXMgfSBmcm9tIFwibmV4dC9oZWFkZXJzXCI7XG5pbXBvcnQgeyBjcmVhdGVDdXN0b21lciB9IGZyb20gXCJAL2xpYi9zdHJpcGVcIjsgLy8gQW50YSBhdCBjcmVhdGVDdXN0b21lciBlciBqdXN0ZXJ0IHNvbSB0aWRsaWdlcmUgZGlza3V0ZXJ0XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogUmVxdWVzdCkge1xuICB0cnkge1xuICAgIC8vIEhlbnQgYnJ1a2VyZGF0YSBkaXJla3RlIGZyYSBTdXBhYmFzZSBBdXRoIHNlc2pvbmVuIHDDpSBzZXJ2ZXJlblxuICAgIC8vIGkgc3RlZGV0IGZvciDDpSBzdG9sZSBww6UgYXQga2xpZW50ZW4gc2VuZGVyIGtvcnJla3QgdXNlcklkLlxuICAgIC8vIERldHRlIGVyIHNpa3JlcmUgb2cgbWVyIHDDpWxpdGVsaWcuXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVSb3V0ZUhhbmRsZXJDbGllbnQoeyBjb29raWVzIH0pO1xuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyOiBhdXRoVXNlciB9LCBlcnJvcjogYXV0aEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblxuICAgIGlmIChhdXRoRXJyb3IgfHwgIWF1dGhVc2VyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiQXV0aCBlcnJvciBvciBubyB1c2VyOlwiLCBhdXRoRXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiVXNlciBub3QgYXV0aGVudGljYXRlZCBvciBzZXNzaW9uIGV4cGlyZWRcIiB9LCB7IHN0YXR1czogNDAxIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGF1dGhVc2VySWQgPSBhdXRoVXNlci5pZDsgLy8gRGV0dGUgZXIgYnJ1a2VyZW5zIFVVSUQgZnJhIGF1dGgudXNlcnNcbiAgICBjb25zdCB1c2VyRW1haWwgPSBhdXRoVXNlci5lbWFpbDtcblxuICAgIC8vIEhlbnQgbmF2biBmcmEgcmVxdWVzdCBib2R5IGh2aXMgZGV0IHNlbmRlcywgZWxsZXJzIGthbnNramUgZnJhIHVzZXJfbWV0YWRhdGFcbiAgICBjb25zdCB7IG5hbWU6IHJlcXVlc3ROYW1lIH0gPSBhd2FpdCByZXEuanNvbigpLmNhdGNoKCgpID0+ICh7IG5hbWU6IHVuZGVmaW5lZCB9KSk7IC8vIEjDpW5kdGVyIGh2aXMgYm9keSBlciB0b20vZmVpbFxuICAgIGNvbnN0IG5hbWUgPSByZXF1ZXN0TmFtZSB8fCBhdXRoVXNlci51c2VyX21ldGFkYXRhPy5mdWxsX25hbWU7IC8vIEVrc2VtcGVsIHDDpSBmYWxsYmFja1xuXG4gICAgaWYgKCFhdXRoVXNlcklkIHx8ICF1c2VyRW1haWwpIHtcbiAgICAgIC8vIERldHRlIGJ1cmRlIGlra2Ugc2tqZSBodmlzIGF1dGhVc2VyIGVyIGd5bGRpZywgbWVuIHNvbSBlbiBla3N0cmEgc2pla2tcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlVzZXIgSUQgb3IgZW1haWwgbWlzc2luZyBmcm9tIHNlc3Npb25cIiB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIC8vIFNqZWtrIG9tIGJydWtlcmVuIGFsbGVyZWRlIGhhciBlbiBjdXN0b21lciBJRFxuICAgIC8vIEJydWsgJ3VzZXJfaWQnLWtvbG9ubmVuIChzb20gZXIgVVVJRCkgZm9yIMOlIHNsw6Ugb3BwIHByb2ZpbGVuXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlLCBlcnJvcjogcHJvZmlsZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbShcInByb2ZpbGVzXCIpXG4gICAgICAgIC5zZWxlY3QoXCJzdHJpcGVfY3VzdG9tZXJfaWQsIGlkXCIpIC8vIFZlbGcgb2dzw6UgZGVuIG51bWVyaXNrZSAnaWQnIGh2aXMgZHUgdHJlbmdlciBkZW4gc2VuZXJlXG4gICAgICAgIC5lcShcInVzZXJfaWRcIiwgYXV0aFVzZXJJZCkgLy8gPC0tLSBLT1JSSUdFUlQ6IEJydWsgJ3VzZXJfaWQnLWtvbG9ubmVuXG4gICAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChwcm9maWxlRXJyb3IgJiYgcHJvZmlsZUVycm9yLmNvZGUgIT09IFwiUEdSU1QxMTZcIikgeyAvLyBQR1JTVDExNiA9IG5vIHJvd3MgZm91bmRcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBwcm9maWxlOlwiLCBwcm9maWxlRXJyb3IpO1xuICAgICAgLy8gSWtrZSBrYXN0IGZlaWxlbiBoZXIsIGxhIGRlbiBnw6UgdmlkZXJlIHRpbCBnZW5lcmVsbCBmZWlsaMOlbmR0ZXJpbmdcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBgRXJyb3IgZmV0Y2hpbmcgcHJvZmlsZTogJHtwcm9maWxlRXJyb3IubWVzc2FnZX1gIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIHVzZXIgYWxyZWFkeSBoYXMgYSBjdXN0b21lciBJRCwgcmV0dXJuIGl0XG4gICAgaWYgKHByb2ZpbGU/LnN0cmlwZV9jdXN0b21lcl9pZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgY3VzdG9tZXJJZDogcHJvZmlsZS5zdHJpcGVfY3VzdG9tZXJfaWQgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGEgbmV3IFN0cmlwZSBjdXN0b21lclxuICAgIC8vIFPDuHJnIGZvciBhdCBjcmVhdGVDdXN0b21lci1mdW5rc2pvbmVuIGkgbGliL3N0cmlwZS50cyBlciByb2J1c3RcbiAgICBjb25zdCBjdXN0b21lciA9IGF3YWl0IGNyZWF0ZUN1c3RvbWVyKHVzZXJFbWFpbCEsIG5hbWUsIHsgc3VwYWJhc2VVVUlEOiBhdXRoVXNlcklkIH0pOyAvLyBTZW5kIG1lZCBzdXBhYmFzZVVVSUQgc29tIG1ldGFkYXRhXG5cbiAgICBpZiAoIWN1c3RvbWVyIHx8IGN1c3RvbWVyLmVycm9yIHx8ICFjdXN0b21lci5pZCkgeyAvLyBTamVrayBvbSBjdXN0b21lci1vYmpla3RldCBlciBneWxkaWdcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIFN0cmlwZSBjdXN0b21lciBvYmplY3Qgb3IgY3VzdG9tZXIgSUQgbWlzc2luZzpcIiwgY3VzdG9tZXIpO1xuICAgICAgY29uc3Qgc3RyaXBlRXJyb3JNZXNzYWdlID0gY3VzdG9tZXI/Lm1lc3NhZ2UgfHwgXCJTdHJpcGUgY3VzdG9tZXIgY3JlYXRpb24gcmV0dXJuZWQgaW52YWxpZCBkYXRhXCI7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogYEZhaWxlZCB0byBjcmVhdGUgU3RyaXBlIGN1c3RvbWVyOiAke3N0cmlwZUVycm9yTWVzc2FnZX1gIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuXG5cbiAgICAvLyBMYWdyZS9vcHBkYXRlciBjdXN0b21lciBJRCB0aWwgYnJ1a2VyZW5zIHByb2ZpbFxuICAgIC8vIEJydWsgJ3VzZXJfaWQnIGZvciDDpSBpZGVudGlmaXNlcmUgcmFkZW4sIG9nIGxhICdpZCcgKGJpZ2ludCkgYXV0by1pbmtyZW1lbnRlcmUgaHZpcyBkZXQgZXIgZW4gbnkgcHJvZmlsXG4gICAgY29uc3QgdXBzZXJ0RGF0YTogYW55ID0ge1xuICAgICAgdXNlcl9pZDogYXV0aFVzZXJJZCwgLy8gSWRlbnRpZmlzZXIvc2V0dCBVVUlELWxpbmtlblxuICAgICAgc3RyaXBlX2N1c3RvbWVyX2lkOiBjdXN0b21lci5pZCxcbiAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9O1xuXG4gICAgLy8gSHZpcyBkZXQgZXIgZW4gbnkgcHJvZmlsLCBtw6UgZHUgb2dzw6Ugc2V0dGUgaW5uIHZlcmRpZXIgZm9yIGFuZHJlIHDDpWtyZXZkZSBmZWx0ZXJcbiAgICAvLyBlbGxlciBsYSBkZW0gaGEgZGVmYXVsdC12ZXJkaWVyIGkgZGF0YWJhc2VuLlxuICAgIC8vIFNpZGVuICdpZCcgKGJpZ2ludCkgZXIgcHJpbcOmcm7DuGtrZWwgb2cgc2FubnN5bmxpZ3ZpcyBhdXRvLWdlbmVyZXJ0LFxuICAgIC8vIHRyZW5nZXIgdmkgaWtrZSDDpSBzcGVzaWZpc2VyZSBkZW4gZm9yIGVuIG55IHJhZCBodmlzICd1c2VyX2lkJyBlciBkZW4gdW5pa2UgbsO4a2tlbGVuIGZvciB1cHNlcnQuXG4gICAgLy8gU3VwYWJhc2UgdXBzZXJ0IHZpbCBicnVrZSAndXNlcl9pZCcgZm9yIGtvbmZsaWt0bMO4c25pbmcgaHZpcyBkdSBoYXIgZW4gVU5JUVVFIGNvbnN0cmFpbnQgcMOlIGRlbi5cbiAgICAvLyBIdmlzICdpZCcgKGJpZ2ludCkgZXIgZGVuIGR1IHZpbCB1cHNlcnQtZSBww6UgKG9nIGR1IGhhciBkZW4gZnJhICdwcm9maWxlJyBodmlzIGRlbiBmYW50ZXMpLCBqdXN0ZXIgZGVyZXR0ZXIuXG4gICAgLy8gTWVzdCBzYW5uc3lubGlnIHZpbCBkdSB1cHNlcnQtZSBiYXNlcnQgcMOlIHVzZXJfaWQgZm9yIMOlIHNpa3JlIGF0IMOpbiBhdXRoLWJydWtlciBoYXIgw6luIHByb2ZpbC5cblxuICAgIC8vIEZvcnV0c2V0dGVyIGF0ICd1c2VyX2lkJyBpICdwcm9maWxlcycgaGFyIGVuIFVOSVFVRSBjb25zdHJhaW50IGZvciBhdCB1cHNlcnQgc2thbCBmdW5nZXJlIHNvbSBmb3J2ZW50ZXQuXG4gICAgLy8gRWxsZXIgYXQgZHUgdmlsIG9wcGRhdGVyZSBiYXNlcnQgcMOlIGRlbiBudW1lcmlza2UgJ2lkJyBodmlzIHByb2ZpbGVuIGJsZSBmdW5uZXQuXG4gICAgbGV0IGZpbmFsVXBzZXJ0RGF0YTtcbiAgICBpZiAocHJvZmlsZSAmJiBwcm9maWxlLmlkKSB7IC8vIFByb2ZpbCBmYW50ZXMsIGJydWsgZGVucyBudW1lcmlza2UgaWQgZm9yIMOlIHbDpnJlIGVrc3BsaXNpdHRcbiAgICAgIGZpbmFsVXBzZXJ0RGF0YSA9IHsgLi4udXBzZXJ0RGF0YSwgaWQ6IHByb2ZpbGUuaWQgfTtcbiAgICB9IGVsc2UgeyAvLyBOeSBwcm9maWwsIGlkIChiaWdpbnQpIHZpbCBibGkgYXV0by1nZW5lcmVydCwgdXNlcl9pZCBzZXR0ZXNcbiAgICAgIGZpbmFsVXBzZXJ0RGF0YSA9IHsgLi4udXBzZXJ0RGF0YSB9O1xuICAgICAgLy8gSHZpcyBkdSBvZ3PDpSBzZXR0ZXIgbmF2bi9lcG9zdCB2ZWQgcHJvZmlsLW9wcHJldHRlbHNlOlxuICAgICAgaWYgKG5hbWUpIGZpbmFsVXBzZXJ0RGF0YS5uYW1lID0gbmFtZTtcbiAgICAgIC8vIGlmICh1c2VyRW1haWwgJiYgIXByb2ZpbGUpIGZpbmFsVXBzZXJ0RGF0YS5lbWFpbCA9IHVzZXJFbWFpbDsgLy8gaHZpcyBwcm9maWxlcyBoYXIgZW4gZW1haWwta29sb25uZVxuICAgIH1cblxuXG4gICAgY29uc3QgeyBlcnJvcjogdXBzZXJ0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKFwicHJvZmlsZXNcIilcbiAgICAgICAgLnVwc2VydChmaW5hbFVwc2VydERhdGEsIHsgb25Db25mbGljdDogJ3VzZXJfaWQnIH0pOyAvLyBVcHNlcnQgYmFzZXJ0IHDDpSB1c2VyX2lkIChrcmV2ZXIgVU5JUVVFIGNvbnN0cmFpbnQgcMOlIHVzZXJfaWQpXG4gICAgLy8gSHZpcyBkdSB2aWwgdXBzZXJ0LWUgcMOlIGRlbiBudW1lcmlza2UgJ2lkJywgYnJ1ayB7IG9uQ29uZmxpY3Q6ICdpZCcgfSBvZyBzw7hyZyBmb3IgYXQgJ2lkJyBlciBpIGZpbmFsVXBzZXJ0RGF0YVxuXG4gICAgaWYgKHVwc2VydEVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2F2aW5nIGN1c3RvbWVyIElEIHRvIHByb2ZpbGU6XCIsIHVwc2VydEVycm9yKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBgRXJyb3Igc2F2aW5nIFN0cmlwZSBjdXN0b21lciBJRDogJHt1cHNlcnRFcnJvci5tZXNzYWdlfWAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBjdXN0b21lcklkOiBjdXN0b21lci5pZCB9KTtcblxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcihcIlVuaGFuZGxlZCBlcnJvciBpbiBjcmVhdGUgU3RyaXBlIGN1c3RvbWVyIGVuZHBvaW50OlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiBgRmFpbGVkIHRvIGNyZWF0ZSBTdHJpcGUgY3VzdG9tZXIgKHVuaGFuZGxlZCk6ICR7ZXJyb3IubWVzc2FnZX1gIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfSxcbiAgICApO1xuICB9XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNyZWF0ZVJvdXRlSGFuZGxlckNsaWVudCIsImNvb2tpZXMiLCJjcmVhdGVDdXN0b21lciIsIlBPU1QiLCJyZXEiLCJzdXBhYmFzZSIsImRhdGEiLCJ1c2VyIiwiYXV0aFVzZXIiLCJlcnJvciIsImF1dGhFcnJvciIsImF1dGgiLCJnZXRVc2VyIiwiY29uc29sZSIsImpzb24iLCJzdGF0dXMiLCJhdXRoVXNlcklkIiwiaWQiLCJ1c2VyRW1haWwiLCJlbWFpbCIsIm5hbWUiLCJyZXF1ZXN0TmFtZSIsImNhdGNoIiwidW5kZWZpbmVkIiwidXNlcl9tZXRhZGF0YSIsImZ1bGxfbmFtZSIsInByb2ZpbGUiLCJwcm9maWxlRXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJjb2RlIiwibWVzc2FnZSIsInN0cmlwZV9jdXN0b21lcl9pZCIsImN1c3RvbWVySWQiLCJjdXN0b21lciIsInN1cGFiYXNlVVVJRCIsInN0cmlwZUVycm9yTWVzc2FnZSIsInVwc2VydERhdGEiLCJ1c2VyX2lkIiwidXBkYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImZpbmFsVXBzZXJ0RGF0YSIsInVwc2VydEVycm9yIiwidXBzZXJ0Iiwib25Db25mbGljdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/stripe/create-customer-for-user/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/stripe.ts":
/*!***********************!*\
  !*** ./lib/stripe.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createCustomer: () => (/* binding */ createCustomer),\n/* harmony export */   createInvoice: () => (/* binding */ createInvoice),\n/* harmony export */   createPaymentIntent: () => (/* binding */ createPaymentIntent),\n/* harmony export */   createTestInvoice: () => (/* binding */ createTestInvoice),\n/* harmony export */   formatAmountForStripe: () => (/* binding */ formatAmountForStripe),\n/* harmony export */   formatAmountFromStripe: () => (/* binding */ formatAmountFromStripe),\n/* harmony export */   getCustomerInvoices: () => (/* binding */ getCustomerInvoices),\n/* harmony export */   payInvoice: () => (/* binding */ payInvoice),\n/* harmony export */   stripe: () => (/* binding */ stripe)\n/* harmony export */ });\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! stripe */ \"(rsc)/./node_modules/stripe/esm/stripe.esm.node.js\");\n// lib/stripe.ts\n\nconst isDevelopment = \"development\" === \"development\";\n// --- Funksjon for å initialisere Stripe ---\nconst getStripeInstance = ()=>{\n    const apiKeyFromEnv = \"sk_test_51NTj6ECBZbubqLlTavZEEYr8YqLtMwVYfzIY8EyT3kXY2yuSv6z7hsiQ2omjZnQ1TMIFee3emq7HIcMAe4rWdAoc00CZhpLtEf\";\n    console.log(\"\\n--- DEBUG: lib/stripe.ts -> getStripeInstance ---\");\n    console.log(\"NODE_ENV:\", \"development\");\n    console.log(\"Raw STRIPE_SECRET_KEY from env:\", apiKeyFromEnv);\n    if (!apiKeyFromEnv) {\n        console.warn(\"⚠️ lib/stripe.ts: STRIPE_SECRET_KEY is NOT SET in environment variables. Stripe operations will be mocked or fail.\");\n        return null;\n    }\n    if (apiKeyFromEnv.startsWith(\"sk_live_\")) {\n        console.warn(\"\\uD83D\\uDD34 lib/stripe.ts: WARNING: Attempting to use a LIVE Stripe key (sk_live_).\");\n        if (isDevelopment) {\n            console.warn(\"\\uD83D\\uDD34\\uD83D\\uDD34\\uD83D\\uDD34 lib/stripe.ts: Using a LIVE Stripe key in DEVELOPMENT. This is dangerous and likely unintended. Stripe will NOT be initialized with a live key in dev.\");\n            return null; // Forhindre bruk av live-nøkkel i dev\n        }\n    } else if (apiKeyFromEnv.startsWith(\"sk_test_\")) {\n        console.log(\"✅ lib/stripe.ts: Using a TEST Stripe key (sk_test_). This is good for development.\");\n    } else {\n        // Viser kun de første og siste tegnene av nøkkelen av sikkerhetshensyn i loggen\n        const maskedDisplayKey = apiKeyFromEnv.length > 14 ? apiKeyFromEnv.substring(0, 7) + \"...\" + apiKeyFromEnv.substring(apiKeyFromEnv.length - 4) : apiKeyFromEnv;\n        console.warn(`⚠️ lib/stripe.ts: STRIPE_SECRET_KEY (\"${maskedDisplayKey}\") does not look like a valid Stripe secret key (should start with sk_test_ or sk_live_).`);\n        return null;\n    }\n    try {\n        const maskedDisplayKey = apiKeyFromEnv.length > 14 ? apiKeyFromEnv.substring(0, 7) + \"...\" + apiKeyFromEnv.substring(apiKeyFromEnv.length - 4) : apiKeyFromEnv;\n        console.log(`lib/stripe.ts: Attempting to initialize Stripe with API key: ${maskedDisplayKey}`);\n        const stripeInstance = new stripe__WEBPACK_IMPORTED_MODULE_0__[\"default\"](apiKeyFromEnv, {\n            apiVersion: \"2023-10-16\",\n            typescript: true\n        });\n        console.log(\"✅ lib/stripe.ts: Stripe initialized successfully.\");\n        return stripeInstance;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Failed to initialize Stripe with API key. Error:\", error);\n        return null;\n    }\n};\n// Initialiser Stripe-instansen én gang\nconst stripe = getStripeInstance();\n// --- Hjelpefunksjoner ---\nconst logStripeOperation = (operation, ...args)=>{\n    if (isDevelopment) {\n        console.log(`🔄 lib/stripe.ts: Stripe Operation - ${operation}:`, ...args);\n    }\n};\nconst formatAmountForStripe = (amount)=>{\n    return Math.round(amount * 100); // Konverterer NOK til øre\n};\nconst formatAmountFromStripe = (amount)=>{\n    return amount / 100; // Konverterer øre til NOK\n};\n// --- Stripe API-kall funksjoner ---\nconst createCustomer = async (email, name, metadata)=>{\n    logStripeOperation(\"createCustomer - Start\", {\n        email,\n        name,\n        metadata\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> createCustomer ---\");\n    console.log(\"Is 'stripe' object initialized here?\", stripe ? \"YES\" : \"NO - Stripe key likely missing/invalid in env!\");\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in createCustomer. Returning MOCK customer.\");\n        return {\n            id: \"cus_mock_STRIPE_NULL_\" + Date.now().toString(36) + Math.random().toString(36).substring(2),\n            email,\n            name,\n            metadata,\n            object: \"customer\",\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: \"Stripe not initialized (null instance), returning mock customer.\"\n        };\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call: customers.create for email: ${email}`);\n        const customerParams = {\n            email\n        };\n        if (name) customerParams.name = name;\n        if (metadata) customerParams.metadata = metadata;\n        const customer = await stripe.customers.create(customerParams);\n        console.log(\"✅ lib/stripe.ts: Stripe customer created successfully via API. ID:\", customer.id);\n        return customer;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error calling Stripe API (customers.create):\", error);\n        return {\n            id: \"cus_mock_API_ERROR_\" + Date.now().toString(36) + Math.random().toString(36).substring(2),\n            email,\n            name,\n            metadata,\n            object: \"customer\",\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: error.message || \"Unknown error during Stripe API call to create customer\"\n        };\n    }\n};\nconst createPaymentIntent = async (amount, currency = \"nok\", customerId)=>{\n    logStripeOperation(\"createPaymentIntent - Start\", {\n        amount,\n        currency,\n        customerId\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> createPaymentIntent ---\");\n    console.log(\"Is 'stripe' object initialized here?\", stripe ? \"YES\" : \"NO - Stripe key likely missing/invalid in env!\");\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in createPaymentIntent. Returning MOCK Payment Intent.\");\n        const mockClientSecret = \"pi_mock_secret_STRIPE_NULL_\" + Date.now().toString(36) + Math.random().toString(36).substring(2);\n        return {\n            id: \"pi_mock_STRIPE_NULL_\" + Date.now().toString(36) + Math.random().toString(36).substring(2),\n            amount: formatAmountForStripe(amount),\n            currency,\n            client_secret: mockClientSecret,\n            customer: customerId,\n            status: \"requires_payment_method\",\n            object: \"payment_intent\",\n            error: true,\n            message: \"Stripe not initialized (null instance), returning mock payment intent.\"\n        };\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call: paymentIntents.create. Amount: ${amount}, Currency: ${currency}, CustomerID: ${customerId || \"None\"}`);\n        const paymentIntentParams = {\n            amount: formatAmountForStripe(amount),\n            currency,\n            automatic_payment_methods: {\n                enabled: true\n            }\n        };\n        if (customerId) {\n            paymentIntentParams.customer = customerId;\n        }\n        const paymentIntent = await stripe.paymentIntents.create(paymentIntentParams);\n        console.log(\"✅ lib/stripe.ts: REAL Stripe Payment Intent created. Client Secret starts with:\", paymentIntent.client_secret?.substring(0, 15) + \"...\");\n        return paymentIntent;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error calling Stripe API (paymentIntents.create):\", error);\n        const mockClientSecret = \"pi_mock_secret_API_ERROR_\" + Date.now().toString(36) + Math.random().toString(36).substring(2);\n        return {\n            id: \"pi_mock_API_ERROR_\" + Date.now().toString(36) + Math.random().toString(36).substring(2),\n            amount: formatAmountForStripe(amount),\n            currency,\n            client_secret: mockClientSecret,\n            customer: customerId,\n            status: \"requires_payment_method\",\n            object: \"payment_intent\",\n            error: true,\n            message: error.message || \"Unknown error during Stripe API call to create payment intent\"\n        };\n    }\n};\n// --- Dine andre Stripe-hjelpefunksjoner ---\n// Du bør gå gjennom disse og legge til lignende `if (!stripe)` sjekker og logging\n// hvis du vil at de skal håndtere manglende Stripe-initialisering grasiøst\n// eller alltid prøve ekte kall hvis `stripe` er tilgjengelig.\nconst createInvoice = async (customerId, description, amount, currency = \"nok\")=>{\n    logStripeOperation(\"createInvoice - Start\", {\n        customerId,\n        description,\n        amount,\n        currency\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> createInvoice --- 'stripe' initialized?\", stripe ? \"YES\" : \"NO\");\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in createInvoice. Returning MOCK invoice.\");\n        return {\n            id: \"in_mock_STRIPE_NULL_\" + Date.now().toString(36),\n            customer: customerId,\n            amount_due: formatAmountForStripe(amount),\n            currency,\n            description,\n            status: \"open\",\n            due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: \"Stripe not initialized\"\n        };\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call for createInvoice. Customer: ${customerId}`);\n        const invoiceItem = await stripe.invoiceItems.create({\n            customer: customerId,\n            amount: formatAmountForStripe(amount),\n            currency,\n            description\n        });\n        const invoice = await stripe.invoices.create({\n            customer: customerId,\n            auto_advance: true,\n            collection_method: \"send_invoice\",\n            days_until_due: 30\n        });\n        const finalizedInvoice = await stripe.invoices.finalizeInvoice(invoice.id);\n        await stripe.invoices.sendInvoice(finalizedInvoice.id);\n        console.log(\"✅ lib/stripe.ts: REAL Stripe Invoice created and sent. ID:\", finalizedInvoice.id);\n        return finalizedInvoice;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error creating REAL Stripe invoice:\", error);\n        return {\n            id: \"in_mock_API_ERROR_\" + Date.now().toString(36),\n            customer: customerId,\n            amount_due: formatAmountForStripe(amount),\n            currency,\n            description,\n            status: \"open\",\n            due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: error.message || \"Unknown API error creating invoice\"\n        };\n    }\n};\nconst getCustomerInvoices = async (customerId)=>{\n    logStripeOperation(\"getCustomerInvoices - Start\", {\n        customerId\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> getCustomerInvoices --- 'stripe' initialized?\", stripe ? \"YES\" : \"NO\");\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in getCustomerInvoices. Returning MOCK invoices.\");\n        return [\n            {\n                id: \"in_mock_STRIPE_NULL_cust_inv\",\n                customer: customerId,\n                amount_due: 10000,\n                currency: \"nok\",\n                status: \"open\",\n                due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n                hosted_invoice_url: \"#\",\n                created: Math.floor(Date.now() / 1000) - 86400,\n                error: true,\n                message: \"Stripe not initialized\"\n            }\n        ];\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call for getCustomerInvoices. Customer: ${customerId}`);\n        const invoices = await stripe.invoices.list({\n            customer: customerId,\n            limit: 100\n        });\n        console.log(`✅ lib/stripe.ts: Fetched ${invoices.data.length} REAL Stripe Invoices for customer.`);\n        return invoices.data;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error fetching REAL customer invoices:\", error);\n        return [\n            {\n                id: \"in_mock_API_ERROR_cust_inv\",\n                customer: customerId,\n                amount_due: 10000,\n                currency: \"nok\",\n                status: \"open\",\n                due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n                hosted_invoice_url: \"#\",\n                created: Math.floor(Date.now() / 1000) - 86400,\n                error: true,\n                message: error.message || \"Unknown API error fetching invoices\"\n            }\n        ];\n    }\n};\nconst payInvoice = async (invoiceId)=>{\n    logStripeOperation(\"payInvoice - Start\", {\n        invoiceId\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> payInvoice --- 'stripe' initialized?\", stripe ? \"YES\" : \"NO\");\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in payInvoice. Returning MOCK payment status.\");\n        return {\n            id: invoiceId,\n            status: \"paid\",\n            paid: true,\n            amount_paid: 10000,\n            currency: \"nok\",\n            error: true,\n            message: \"Stripe not initialized\"\n        };\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call for payInvoice. Invoice ID: ${invoiceId}`);\n        const invoice = await stripe.invoices.pay(invoiceId);\n        console.log(\"✅ lib/stripe.ts: REAL Stripe Invoice paid. Status:\", invoice.status);\n        return invoice;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error paying REAL Stripe invoice:\", error);\n        return {\n            id: invoiceId,\n            status: \"open\",\n            paid: false,\n            /*amount_paid might not be set*/ error: true,\n            message: error.message || \"Unknown API error paying invoice\"\n        };\n    }\n};\nconst createTestInvoice = async (customerId)=>{\n    logStripeOperation(\"createTestInvoice - Start\", {\n        customerId\n    });\n    console.log(\"--- DEBUG: lib/stripe.ts -> createTestInvoice --- 'stripe' initialized?\", stripe ? \"YES\" : \"NO\");\n    if (!isDevelopment) {\n        console.error(\"❌ lib/stripe.ts: createTestInvoice called outside development mode.\");\n        throw new Error(\"Test invoices can only be created in development mode\");\n    }\n    if (!customerId) {\n        console.error(\"❌ lib/stripe.ts: Customer ID is required for createTestInvoice.\");\n        throw new Error(\"Customer ID is required to create a test invoice\");\n    }\n    if (!stripe) {\n        console.warn(\"⚠️ lib/stripe.ts: Stripe instance is null in createTestInvoice. Returning MOCK test invoice.\");\n        const amount = Math.floor(Math.random() * 900) + 100;\n        return {\n            id: \"in_test_mock_STRIPE_NULL_\" + Date.now().toString(36),\n            number: \"TEST_MOCK\" + Math.floor(Math.random() * 10000),\n            customer: customerId,\n            amount_due: formatAmountForStripe(amount),\n            currency: \"nok\",\n            description: \"Mock Test Invoice - Stripe Not Initialized\",\n            status: \"open\",\n            due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: \"Stripe not initialized\"\n        };\n    }\n    try {\n        console.log(`lib/stripe.ts: Attempting REAL Stripe API call for createTestInvoice. Customer: ${customerId}`);\n        const amount = Math.floor(Math.random() * 900) + 100;\n        const invoiceItem = await stripe.invoiceItems.create({\n            customer: customerId,\n            amount: formatAmountForStripe(amount),\n            currency: \"nok\",\n            description: \"Test Invoice - Development Only (REAL CALL)\"\n        });\n        const invoice = await stripe.invoices.create({\n            customer: customerId,\n            auto_advance: true,\n            collection_method: \"send_invoice\",\n            days_until_due: 30\n        });\n        const finalizedInvoice = await stripe.invoices.finalizeInvoice(invoice.id);\n        console.log(\"✅ lib/stripe.ts: REAL Stripe Test Invoice created. ID:\", finalizedInvoice.id);\n        return finalizedInvoice;\n    } catch (error) {\n        console.error(\"❌ lib/stripe.ts: Error creating REAL test invoice:\", error);\n        const amount = Math.floor(Math.random() * 900) + 100;\n        return {\n            id: \"in_test_mock_API_ERROR_\" + Date.now().toString(36),\n            number: \"TEST_MOCK_ERROR\" + Math.floor(Math.random() * 10000),\n            customer: customerId,\n            amount_due: formatAmountForStripe(amount),\n            currency: \"nok\",\n            description: \"Mock Test Invoice - API Error\",\n            status: \"open\",\n            due_date: Math.floor(Date.now() / 1000) + 86400 * 30,\n            created: Math.floor(Date.now() / 1000),\n            error: true,\n            message: error.message || \"Unknown error\"\n        };\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUk7UUFDNUI7SUFDRjtBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oZXB0YS1kYXNoYm9hcmQvLi9saWIvc3RyaXBlLnRzPzBlMzMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL3N0cmlwZS50c1xuaW1wb3J0IFN0cmlwZSBmcm9tIFwic3RyaXBlXCI7XG5cbmNvbnN0IGlzRGV2ZWxvcG1lbnQgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJkZXZlbG9wbWVudFwiO1xuXG4vLyAtLS0gRnVua3Nqb24gZm9yIMOlIGluaXRpYWxpc2VyZSBTdHJpcGUgLS0tXG5jb25zdCBnZXRTdHJpcGVJbnN0YW5jZSA9ICgpOiBTdHJpcGUgfCBudWxsID0+IHtcbiAgY29uc3QgYXBpS2V5RnJvbUVudiA9IHByb2Nlc3MuZW52LlNUUklQRV9TRUNSRVRfS0VZO1xuXG4gIGNvbnNvbGUubG9nKFwiXFxuLS0tIERFQlVHOiBsaWIvc3RyaXBlLnRzIC0+IGdldFN0cmlwZUluc3RhbmNlIC0tLVwiKTtcbiAgY29uc29sZS5sb2coXCJOT0RFX0VOVjpcIiwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYpO1xuICBjb25zb2xlLmxvZyhcIlJhdyBTVFJJUEVfU0VDUkVUX0tFWSBmcm9tIGVudjpcIiwgYXBpS2V5RnJvbUVudik7XG5cbiAgaWYgKCFhcGlLZXlGcm9tRW52KSB7XG4gICAgY29uc29sZS53YXJuKFwi4pqg77iPIGxpYi9zdHJpcGUudHM6IFNUUklQRV9TRUNSRVRfS0VZIGlzIE5PVCBTRVQgaW4gZW52aXJvbm1lbnQgdmFyaWFibGVzLiBTdHJpcGUgb3BlcmF0aW9ucyB3aWxsIGJlIG1vY2tlZCBvciBmYWlsLlwiKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGlmIChhcGlLZXlGcm9tRW52LnN0YXJ0c1dpdGgoXCJza19saXZlX1wiKSkge1xuICAgIGNvbnNvbGUud2FybihcIvCflLQgbGliL3N0cmlwZS50czogV0FSTklORzogQXR0ZW1wdGluZyB0byB1c2UgYSBMSVZFIFN0cmlwZSBrZXkgKHNrX2xpdmVfKS5cIik7XG4gICAgaWYgKGlzRGV2ZWxvcG1lbnQpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIvCflLTwn5S08J+UtCBsaWIvc3RyaXBlLnRzOiBVc2luZyBhIExJVkUgU3RyaXBlIGtleSBpbiBERVZFTE9QTUVOVC4gVGhpcyBpcyBkYW5nZXJvdXMgYW5kIGxpa2VseSB1bmludGVuZGVkLiBTdHJpcGUgd2lsbCBOT1QgYmUgaW5pdGlhbGl6ZWQgd2l0aCBhIGxpdmUga2V5IGluIGRldi5cIik7XG4gICAgICByZXR1cm4gbnVsbDsgLy8gRm9yaGluZHJlIGJydWsgYXYgbGl2ZS1uw7hra2VsIGkgZGV2XG4gICAgfVxuICB9IGVsc2UgaWYgKGFwaUtleUZyb21FbnYuc3RhcnRzV2l0aChcInNrX3Rlc3RfXCIpKSB7XG4gICAgY29uc29sZS5sb2coXCLinIUgbGliL3N0cmlwZS50czogVXNpbmcgYSBURVNUIFN0cmlwZSBrZXkgKHNrX3Rlc3RfKS4gVGhpcyBpcyBnb29kIGZvciBkZXZlbG9wbWVudC5cIik7XG4gIH0gZWxzZSB7XG4gICAgLy8gVmlzZXIga3VuIGRlIGbDuHJzdGUgb2cgc2lzdGUgdGVnbmVuZSBhdiBuw7hra2VsZW4gYXYgc2lra2VyaGV0c2hlbnN5biBpIGxvZ2dlblxuICAgIGNvbnN0IG1hc2tlZERpc3BsYXlLZXkgPSBhcGlLZXlGcm9tRW52Lmxlbmd0aCA+IDE0ID8gYXBpS2V5RnJvbUVudi5zdWJzdHJpbmcoMCwgNykgKyBcIi4uLlwiICsgYXBpS2V5RnJvbUVudi5zdWJzdHJpbmcoYXBpS2V5RnJvbUVudi5sZW5ndGggLSA0KSA6IGFwaUtleUZyb21FbnY7XG4gICAgY29uc29sZS53YXJuKGDimqDvuI8gbGliL3N0cmlwZS50czogU1RSSVBFX1NFQ1JFVF9LRVkgKFwiJHttYXNrZWREaXNwbGF5S2V5fVwiKSBkb2VzIG5vdCBsb29rIGxpa2UgYSB2YWxpZCBTdHJpcGUgc2VjcmV0IGtleSAoc2hvdWxkIHN0YXJ0IHdpdGggc2tfdGVzdF8gb3Igc2tfbGl2ZV8pLmApO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBtYXNrZWREaXNwbGF5S2V5ID0gYXBpS2V5RnJvbUVudi5sZW5ndGggPiAxNCA/IGFwaUtleUZyb21FbnYuc3Vic3RyaW5nKDAsIDcpICsgXCIuLi5cIiArIGFwaUtleUZyb21FbnYuc3Vic3RyaW5nKGFwaUtleUZyb21FbnYubGVuZ3RoIC0gNCkgOiBhcGlLZXlGcm9tRW52O1xuICAgIGNvbnNvbGUubG9nKGBsaWIvc3RyaXBlLnRzOiBBdHRlbXB0aW5nIHRvIGluaXRpYWxpemUgU3RyaXBlIHdpdGggQVBJIGtleTogJHttYXNrZWREaXNwbGF5S2V5fWApO1xuXG4gICAgY29uc3Qgc3RyaXBlSW5zdGFuY2UgPSBuZXcgU3RyaXBlKGFwaUtleUZyb21FbnYsIHtcbiAgICAgIGFwaVZlcnNpb246IFwiMjAyMy0xMC0xNlwiLCAvLyBEdSBrYW4gb3BwZGF0ZXJlIGRlbm5lIHRpbCBueWVzdGUgU3RyaXBlIGFuYmVmYWxlclxuICAgICAgdHlwZXNjcmlwdDogdHJ1ZSwgLy8gQnJhIGZvciB0eXBlLXNpa2tlcmhldFxuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKFwi4pyFIGxpYi9zdHJpcGUudHM6IFN0cmlwZSBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHkuXCIpO1xuICAgIHJldHVybiBzdHJpcGVJbnN0YW5jZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIGxpYi9zdHJpcGUudHM6IEZhaWxlZCB0byBpbml0aWFsaXplIFN0cmlwZSB3aXRoIEFQSSBrZXkuIEVycm9yOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5cbi8vIEluaXRpYWxpc2VyIFN0cmlwZS1pbnN0YW5zZW4gw6luIGdhbmdcbmV4cG9ydCBjb25zdCBzdHJpcGUgPSBnZXRTdHJpcGVJbnN0YW5jZSgpO1xuXG4vLyAtLS0gSGplbHBlZnVua3Nqb25lciAtLS1cbmNvbnN0IGxvZ1N0cmlwZU9wZXJhdGlvbiA9IChvcGVyYXRpb246IHN0cmluZywgLi4uYXJnczogYW55W10pID0+IHtcbiAgaWYgKGlzRGV2ZWxvcG1lbnQpIHsgLy8gTG9nZyBrdW4gaSB1dHZpa2xpbmdcbiAgICBjb25zb2xlLmxvZyhg8J+UhCBsaWIvc3RyaXBlLnRzOiBTdHJpcGUgT3BlcmF0aW9uIC0gJHtvcGVyYXRpb259OmAsIC4uLmFyZ3MpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZm9ybWF0QW1vdW50Rm9yU3RyaXBlID0gKGFtb3VudDogbnVtYmVyKTogbnVtYmVyID0+IHtcbiAgcmV0dXJuIE1hdGgucm91bmQoYW1vdW50ICogMTAwKTsgLy8gS29udmVydGVyZXIgTk9LIHRpbCDDuHJlXG59O1xuXG5leHBvcnQgY29uc3QgZm9ybWF0QW1vdW50RnJvbVN0cmlwZSA9IChhbW91bnQ6IG51bWJlcik6IG51bWJlciA9PiB7XG4gIHJldHVybiBhbW91bnQgLyAxMDA7IC8vIEtvbnZlcnRlcmVyIMO4cmUgdGlsIE5PS1xufTtcblxuLy8gLS0tIFN0cmlwZSBBUEkta2FsbCBmdW5rc2pvbmVyIC0tLVxuXG5leHBvcnQgY29uc3QgY3JlYXRlQ3VzdG9tZXIgPSBhc3luYyAoZW1haWw6IHN0cmluZywgbmFtZT86IHN0cmluZywgbWV0YWRhdGE/OiBTdHJpcGUuTWV0YWRhdGFQYXJhbSkgPT4ge1xuICBsb2dTdHJpcGVPcGVyYXRpb24oXCJjcmVhdGVDdXN0b21lciAtIFN0YXJ0XCIsIHsgZW1haWwsIG5hbWUsIG1ldGFkYXRhIH0pO1xuICBjb25zb2xlLmxvZyhcIi0tLSBERUJVRzogbGliL3N0cmlwZS50cyAtPiBjcmVhdGVDdXN0b21lciAtLS1cIik7XG4gIGNvbnNvbGUubG9nKFwiSXMgJ3N0cmlwZScgb2JqZWN0IGluaXRpYWxpemVkIGhlcmU/XCIsIHN0cmlwZSA/IFwiWUVTXCIgOiBcIk5PIC0gU3RyaXBlIGtleSBsaWtlbHkgbWlzc2luZy9pbnZhbGlkIGluIGVudiFcIik7XG5cbiAgaWYgKCFzdHJpcGUpIHtcbiAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gbGliL3N0cmlwZS50czogU3RyaXBlIGluc3RhbmNlIGlzIG51bGwgaW4gY3JlYXRlQ3VzdG9tZXIuIFJldHVybmluZyBNT0NLIGN1c3RvbWVyLlwiKTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IFwiY3VzX21vY2tfU1RSSVBFX05VTExfXCIgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KSArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyKSxcbiAgICAgIGVtYWlsLFxuICAgICAgbmFtZSxcbiAgICAgIG1ldGFkYXRhLFxuICAgICAgb2JqZWN0OiAnY3VzdG9tZXInIGFzIGNvbnN0LCAvLyBMZWdnIHRpbCBvYmplY3QgdHlwZSBmb3IgYmVkcmUgdHlwZS1tYXRjaGluZ1xuICAgICAgY3JlYXRlZDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCksXG4gICAgICBlcnJvcjogdHJ1ZSwgLy8gSW5kaWtlcmVyIGF0IGRldHRlIGVyIGVuIG1vY2sgcGdhLiBmZWlsXG4gICAgICBtZXNzYWdlOiBcIlN0cmlwZSBub3QgaW5pdGlhbGl6ZWQgKG51bGwgaW5zdGFuY2UpLCByZXR1cm5pbmcgbW9jayBjdXN0b21lci5cIlxuICAgIH07XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGBsaWIvc3RyaXBlLnRzOiBBdHRlbXB0aW5nIFJFQUwgU3RyaXBlIEFQSSBjYWxsOiBjdXN0b21lcnMuY3JlYXRlIGZvciBlbWFpbDogJHtlbWFpbH1gKTtcbiAgICBjb25zdCBjdXN0b21lclBhcmFtczogU3RyaXBlLkN1c3RvbWVyQ3JlYXRlUGFyYW1zID0geyBlbWFpbCB9O1xuICAgIGlmIChuYW1lKSBjdXN0b21lclBhcmFtcy5uYW1lID0gbmFtZTtcbiAgICBpZiAobWV0YWRhdGEpIGN1c3RvbWVyUGFyYW1zLm1ldGFkYXRhID0gbWV0YWRhdGE7XG5cbiAgICBjb25zdCBjdXN0b21lciA9IGF3YWl0IHN0cmlwZS5jdXN0b21lcnMuY3JlYXRlKGN1c3RvbWVyUGFyYW1zKTtcbiAgICBjb25zb2xlLmxvZyhcIuKchSBsaWIvc3RyaXBlLnRzOiBTdHJpcGUgY3VzdG9tZXIgY3JlYXRlZCBzdWNjZXNzZnVsbHkgdmlhIEFQSS4gSUQ6XCIsIGN1c3RvbWVyLmlkKTtcbiAgICByZXR1cm4gY3VzdG9tZXI7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIGxpYi9zdHJpcGUudHM6IEVycm9yIGNhbGxpbmcgU3RyaXBlIEFQSSAoY3VzdG9tZXJzLmNyZWF0ZSk6XCIsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IFwiY3VzX21vY2tfQVBJX0VSUk9SX1wiICsgRGF0ZS5ub3coKS50b1N0cmluZygzNikgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiksXG4gICAgICBlbWFpbCxcbiAgICAgIG5hbWUsXG4gICAgICBtZXRhZGF0YSxcbiAgICAgIG9iamVjdDogJ2N1c3RvbWVyJyBhcyBjb25zdCxcbiAgICAgIGNyZWF0ZWQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApLFxuICAgICAgZXJyb3I6IHRydWUsXG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8IFwiVW5rbm93biBlcnJvciBkdXJpbmcgU3RyaXBlIEFQSSBjYWxsIHRvIGNyZWF0ZSBjdXN0b21lclwiXG4gICAgfTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVBheW1lbnRJbnRlbnQgPSBhc3luYyAoYW1vdW50OiBudW1iZXIsIGN1cnJlbmN5ID0gXCJub2tcIiwgY3VzdG9tZXJJZD86IHN0cmluZykgPT4ge1xuICBsb2dTdHJpcGVPcGVyYXRpb24oXCJjcmVhdGVQYXltZW50SW50ZW50IC0gU3RhcnRcIiwgeyBhbW91bnQsIGN1cnJlbmN5LCBjdXN0b21lcklkIH0pO1xuICBjb25zb2xlLmxvZyhcIi0tLSBERUJVRzogbGliL3N0cmlwZS50cyAtPiBjcmVhdGVQYXltZW50SW50ZW50IC0tLVwiKTtcbiAgY29uc29sZS5sb2coXCJJcyAnc3RyaXBlJyBvYmplY3QgaW5pdGlhbGl6ZWQgaGVyZT9cIiwgc3RyaXBlID8gXCJZRVNcIiA6IFwiTk8gLSBTdHJpcGUga2V5IGxpa2VseSBtaXNzaW5nL2ludmFsaWQgaW4gZW52IVwiKTtcblxuICBpZiAoIXN0cmlwZSkge1xuICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyBsaWIvc3RyaXBlLnRzOiBTdHJpcGUgaW5zdGFuY2UgaXMgbnVsbCBpbiBjcmVhdGVQYXltZW50SW50ZW50LiBSZXR1cm5pbmcgTU9DSyBQYXltZW50IEludGVudC5cIik7XG4gICAgY29uc3QgbW9ja0NsaWVudFNlY3JldCA9IFwicGlfbW9ja19zZWNyZXRfU1RSSVBFX05VTExfXCIgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KSArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyKTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IFwicGlfbW9ja19TVFJJUEVfTlVMTF9cIiArIERhdGUubm93KCkudG9TdHJpbmcoMzYpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIpLFxuICAgICAgYW1vdW50OiBmb3JtYXRBbW91bnRGb3JTdHJpcGUoYW1vdW50KSxcbiAgICAgIGN1cnJlbmN5LFxuICAgICAgY2xpZW50X3NlY3JldDogbW9ja0NsaWVudFNlY3JldCxcbiAgICAgIGN1c3RvbWVyOiBjdXN0b21lcklkLFxuICAgICAgc3RhdHVzOiAncmVxdWlyZXNfcGF5bWVudF9tZXRob2QnIGFzIFN0cmlwZS5QYXltZW50SW50ZW50LlN0YXR1cyxcbiAgICAgIG9iamVjdDogJ3BheW1lbnRfaW50ZW50JyBhcyBjb25zdCxcbiAgICAgIGVycm9yOiB0cnVlLFxuICAgICAgbWVzc2FnZTogXCJTdHJpcGUgbm90IGluaXRpYWxpemVkIChudWxsIGluc3RhbmNlKSwgcmV0dXJuaW5nIG1vY2sgcGF5bWVudCBpbnRlbnQuXCJcbiAgICB9O1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhgbGliL3N0cmlwZS50czogQXR0ZW1wdGluZyBSRUFMIFN0cmlwZSBBUEkgY2FsbDogcGF5bWVudEludGVudHMuY3JlYXRlLiBBbW91bnQ6ICR7YW1vdW50fSwgQ3VycmVuY3k6ICR7Y3VycmVuY3l9LCBDdXN0b21lcklEOiAke2N1c3RvbWVySWQgfHwgJ05vbmUnfWApO1xuICAgIGNvbnN0IHBheW1lbnRJbnRlbnRQYXJhbXM6IFN0cmlwZS5QYXltZW50SW50ZW50Q3JlYXRlUGFyYW1zID0ge1xuICAgICAgYW1vdW50OiBmb3JtYXRBbW91bnRGb3JTdHJpcGUoYW1vdW50KSxcbiAgICAgIGN1cnJlbmN5LFxuICAgICAgYXV0b21hdGljX3BheW1lbnRfbWV0aG9kczoge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgaWYgKGN1c3RvbWVySWQpIHtcbiAgICAgIHBheW1lbnRJbnRlbnRQYXJhbXMuY3VzdG9tZXIgPSBjdXN0b21lcklkO1xuICAgIH1cblxuICAgIGNvbnN0IHBheW1lbnRJbnRlbnQgPSBhd2FpdCBzdHJpcGUucGF5bWVudEludGVudHMuY3JlYXRlKHBheW1lbnRJbnRlbnRQYXJhbXMpO1xuICAgIGNvbnNvbGUubG9nKFwi4pyFIGxpYi9zdHJpcGUudHM6IFJFQUwgU3RyaXBlIFBheW1lbnQgSW50ZW50IGNyZWF0ZWQuIENsaWVudCBTZWNyZXQgc3RhcnRzIHdpdGg6XCIsIHBheW1lbnRJbnRlbnQuY2xpZW50X3NlY3JldD8uc3Vic3RyaW5nKDAsMTUpICsgXCIuLi5cIik7XG4gICAgcmV0dXJuIHBheW1lbnRJbnRlbnQ7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIGxpYi9zdHJpcGUudHM6IEVycm9yIGNhbGxpbmcgU3RyaXBlIEFQSSAocGF5bWVudEludGVudHMuY3JlYXRlKTpcIiwgZXJyb3IpO1xuICAgIGNvbnN0IG1vY2tDbGllbnRTZWNyZXQgPSBcInBpX21vY2tfc2VjcmV0X0FQSV9FUlJPUl9cIiArIERhdGUubm93KCkudG9TdHJpbmcoMzYpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIpO1xuICAgIHJldHVybiB7XG4gICAgICBpZDogXCJwaV9tb2NrX0FQSV9FUlJPUl9cIiArIERhdGUubm93KCkudG9TdHJpbmcoMzYpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIpLFxuICAgICAgYW1vdW50OiBmb3JtYXRBbW91bnRGb3JTdHJpcGUoYW1vdW50KSxcbiAgICAgIGN1cnJlbmN5LFxuICAgICAgY2xpZW50X3NlY3JldDogbW9ja0NsaWVudFNlY3JldCxcbiAgICAgIGN1c3RvbWVyOiBjdXN0b21lcklkLFxuICAgICAgc3RhdHVzOiAncmVxdWlyZXNfcGF5bWVudF9tZXRob2QnIGFzIFN0cmlwZS5QYXltZW50SW50ZW50LlN0YXR1cyxcbiAgICAgIG9iamVjdDogJ3BheW1lbnRfaW50ZW50JyBhcyBjb25zdCxcbiAgICAgIGVycm9yOiB0cnVlLFxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCBcIlVua25vd24gZXJyb3IgZHVyaW5nIFN0cmlwZSBBUEkgY2FsbCB0byBjcmVhdGUgcGF5bWVudCBpbnRlbnRcIlxuICAgIH07XG4gIH1cbn07XG5cblxuLy8gLS0tIERpbmUgYW5kcmUgU3RyaXBlLWhqZWxwZWZ1bmtzam9uZXIgLS0tXG4vLyBEdSBiw7hyIGfDpSBnamVubm9tIGRpc3NlIG9nIGxlZ2dlIHRpbCBsaWduZW5kZSBgaWYgKCFzdHJpcGUpYCBzamVra2VyIG9nIGxvZ2dpbmdcbi8vIGh2aXMgZHUgdmlsIGF0IGRlIHNrYWwgaMOlbmR0ZXJlIG1hbmdsZW5kZSBTdHJpcGUtaW5pdGlhbGlzZXJpbmcgZ3Jhc2nDuHN0XG4vLyBlbGxlciBhbGx0aWQgcHLDuHZlIGVrdGUga2FsbCBodmlzIGBzdHJpcGVgIGVyIHRpbGdqZW5nZWxpZy5cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUludm9pY2UgPSBhc3luYyAoY3VzdG9tZXJJZDogc3RyaW5nLCBkZXNjcmlwdGlvbjogc3RyaW5nLCBhbW91bnQ6IG51bWJlciwgY3VycmVuY3kgPSBcIm5va1wiKSA9PiB7XG4gIGxvZ1N0cmlwZU9wZXJhdGlvbihcImNyZWF0ZUludm9pY2UgLSBTdGFydFwiLCB7IGN1c3RvbWVySWQsIGRlc2NyaXB0aW9uLCBhbW91bnQsIGN1cnJlbmN5IH0pO1xuICBjb25zb2xlLmxvZyhcIi0tLSBERUJVRzogbGliL3N0cmlwZS50cyAtPiBjcmVhdGVJbnZvaWNlIC0tLSAnc3RyaXBlJyBpbml0aWFsaXplZD9cIiwgc3RyaXBlID8gXCJZRVNcIiA6IFwiTk9cIik7XG4gIGlmICghc3RyaXBlKSB7XG4gICAgY29uc29sZS53YXJuKFwi4pqg77iPIGxpYi9zdHJpcGUudHM6IFN0cmlwZSBpbnN0YW5jZSBpcyBudWxsIGluIGNyZWF0ZUludm9pY2UuIFJldHVybmluZyBNT0NLIGludm9pY2UuXCIpO1xuICAgIHJldHVybiB7XG4gICAgICBpZDogXCJpbl9tb2NrX1NUUklQRV9OVUxMX1wiICsgRGF0ZS5ub3coKS50b1N0cmluZygzNiksXG4gICAgICBjdXN0b21lcjogY3VzdG9tZXJJZCxcbiAgICAgIGFtb3VudF9kdWU6IGZvcm1hdEFtb3VudEZvclN0cmlwZShhbW91bnQpLFxuICAgICAgY3VycmVuY3ksXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHN0YXR1czogXCJvcGVuXCIsXG4gICAgICBkdWVfZGF0ZTogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyA4NjQwMCAqIDMwLFxuICAgICAgY3JlYXRlZDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCksXG4gICAgICBlcnJvcjogdHJ1ZSwgbWVzc2FnZTogXCJTdHJpcGUgbm90IGluaXRpYWxpemVkXCJcbiAgICB9O1xuICB9XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coYGxpYi9zdHJpcGUudHM6IEF0dGVtcHRpbmcgUkVBTCBTdHJpcGUgQVBJIGNhbGwgZm9yIGNyZWF0ZUludm9pY2UuIEN1c3RvbWVyOiAke2N1c3RvbWVySWR9YCk7XG4gICAgY29uc3QgaW52b2ljZUl0ZW0gPSBhd2FpdCBzdHJpcGUuaW52b2ljZUl0ZW1zLmNyZWF0ZSh7XG4gICAgICBjdXN0b21lcjogY3VzdG9tZXJJZCxcbiAgICAgIGFtb3VudDogZm9ybWF0QW1vdW50Rm9yU3RyaXBlKGFtb3VudCksXG4gICAgICBjdXJyZW5jeSxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgIH0pO1xuICAgIGNvbnN0IGludm9pY2UgPSBhd2FpdCBzdHJpcGUuaW52b2ljZXMuY3JlYXRlKHtcbiAgICAgIGN1c3RvbWVyOiBjdXN0b21lcklkLFxuICAgICAgYXV0b19hZHZhbmNlOiB0cnVlLFxuICAgICAgY29sbGVjdGlvbl9tZXRob2Q6IFwic2VuZF9pbnZvaWNlXCIsXG4gICAgICBkYXlzX3VudGlsX2R1ZTogMzAsXG4gICAgfSk7XG4gICAgY29uc3QgZmluYWxpemVkSW52b2ljZSA9IGF3YWl0IHN0cmlwZS5pbnZvaWNlcy5maW5hbGl6ZUludm9pY2UoaW52b2ljZS5pZCk7XG4gICAgYXdhaXQgc3RyaXBlLmludm9pY2VzLnNlbmRJbnZvaWNlKGZpbmFsaXplZEludm9pY2UuaWQpO1xuICAgIGNvbnNvbGUubG9nKFwi4pyFIGxpYi9zdHJpcGUudHM6IFJFQUwgU3RyaXBlIEludm9pY2UgY3JlYXRlZCBhbmQgc2VudC4gSUQ6XCIsIGZpbmFsaXplZEludm9pY2UuaWQpO1xuICAgIHJldHVybiBmaW5hbGl6ZWRJbnZvaWNlO1xuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcihcIuKdjCBsaWIvc3RyaXBlLnRzOiBFcnJvciBjcmVhdGluZyBSRUFMIFN0cmlwZSBpbnZvaWNlOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBcImluX21vY2tfQVBJX0VSUk9SX1wiICsgRGF0ZS5ub3coKS50b1N0cmluZygzNiksXG4gICAgICBjdXN0b21lcjogY3VzdG9tZXJJZCxcbiAgICAgIGFtb3VudF9kdWU6IGZvcm1hdEFtb3VudEZvclN0cmlwZShhbW91bnQpLFxuICAgICAgY3VycmVuY3ksXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHN0YXR1czogXCJvcGVuXCIsXG4gICAgICBkdWVfZGF0ZTogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyA4NjQwMCAqIDMwLFxuICAgICAgY3JlYXRlZDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCksXG4gICAgICBlcnJvcjogdHJ1ZSwgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCBcIlVua25vd24gQVBJIGVycm9yIGNyZWF0aW5nIGludm9pY2VcIlxuICAgIH07XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZXRDdXN0b21lckludm9pY2VzID0gYXN5bmMgKGN1c3RvbWVySWQ6IHN0cmluZykgPT4ge1xuICBsb2dTdHJpcGVPcGVyYXRpb24oXCJnZXRDdXN0b21lckludm9pY2VzIC0gU3RhcnRcIiwgeyBjdXN0b21lcklkIH0pO1xuICBjb25zb2xlLmxvZyhcIi0tLSBERUJVRzogbGliL3N0cmlwZS50cyAtPiBnZXRDdXN0b21lckludm9pY2VzIC0tLSAnc3RyaXBlJyBpbml0aWFsaXplZD9cIiwgc3RyaXBlID8gXCJZRVNcIiA6IFwiTk9cIik7XG4gIGlmICghc3RyaXBlKSB7XG4gICAgY29uc29sZS53YXJuKFwi4pqg77iPIGxpYi9zdHJpcGUudHM6IFN0cmlwZSBpbnN0YW5jZSBpcyBudWxsIGluIGdldEN1c3RvbWVySW52b2ljZXMuIFJldHVybmluZyBNT0NLIGludm9pY2VzLlwiKTtcbiAgICByZXR1cm4gW1xuICAgICAge1xuICAgICAgICBpZDogXCJpbl9tb2NrX1NUUklQRV9OVUxMX2N1c3RfaW52XCIsIGN1c3RvbWVyOiBjdXN0b21lcklkLCBhbW91bnRfZHVlOiAxMDAwMCwgY3VycmVuY3k6IFwibm9rXCIsIHN0YXR1czogXCJvcGVuXCIsXG4gICAgICAgIGR1ZV9kYXRlOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSArIDg2NDAwICogMzAsIGhvc3RlZF9pbnZvaWNlX3VybDogXCIjXCIsIGNyZWF0ZWQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApIC0gODY0MDAsXG4gICAgICAgIGVycm9yOiB0cnVlLCBtZXNzYWdlOiBcIlN0cmlwZSBub3QgaW5pdGlhbGl6ZWRcIlxuICAgICAgfVxuICAgIF07XG4gIH1cbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhgbGliL3N0cmlwZS50czogQXR0ZW1wdGluZyBSRUFMIFN0cmlwZSBBUEkgY2FsbCBmb3IgZ2V0Q3VzdG9tZXJJbnZvaWNlcy4gQ3VzdG9tZXI6ICR7Y3VzdG9tZXJJZH1gKTtcbiAgICBjb25zdCBpbnZvaWNlcyA9IGF3YWl0IHN0cmlwZS5pbnZvaWNlcy5saXN0KHsgY3VzdG9tZXI6IGN1c3RvbWVySWQsIGxpbWl0OiAxMDAgfSk7XG4gICAgY29uc29sZS5sb2coYOKchSBsaWIvc3RyaXBlLnRzOiBGZXRjaGVkICR7aW52b2ljZXMuZGF0YS5sZW5ndGh9IFJFQUwgU3RyaXBlIEludm9pY2VzIGZvciBjdXN0b21lci5gKTtcbiAgICByZXR1cm4gaW52b2ljZXMuZGF0YTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgbGliL3N0cmlwZS50czogRXJyb3IgZmV0Y2hpbmcgUkVBTCBjdXN0b21lciBpbnZvaWNlczpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBbXG4gICAgICB7XG4gICAgICAgIGlkOiBcImluX21vY2tfQVBJX0VSUk9SX2N1c3RfaW52XCIsIGN1c3RvbWVyOiBjdXN0b21lcklkLCBhbW91bnRfZHVlOiAxMDAwMCwgY3VycmVuY3k6IFwibm9rXCIsIHN0YXR1czogXCJvcGVuXCIsXG4gICAgICAgIGR1ZV9kYXRlOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSArIDg2NDAwICogMzAsIGhvc3RlZF9pbnZvaWNlX3VybDogXCIjXCIsIGNyZWF0ZWQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApIC0gODY0MDAsXG4gICAgICAgIGVycm9yOiB0cnVlLCBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8IFwiVW5rbm93biBBUEkgZXJyb3IgZmV0Y2hpbmcgaW52b2ljZXNcIlxuICAgICAgfVxuICAgIF07XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBwYXlJbnZvaWNlID0gYXN5bmMgKGludm9pY2VJZDogc3RyaW5nKSA9PiB7XG4gIGxvZ1N0cmlwZU9wZXJhdGlvbihcInBheUludm9pY2UgLSBTdGFydFwiLCB7IGludm9pY2VJZCB9KTtcbiAgY29uc29sZS5sb2coXCItLS0gREVCVUc6IGxpYi9zdHJpcGUudHMgLT4gcGF5SW52b2ljZSAtLS0gJ3N0cmlwZScgaW5pdGlhbGl6ZWQ/XCIsIHN0cmlwZSA/IFwiWUVTXCIgOiBcIk5PXCIpO1xuICBpZiAoIXN0cmlwZSkge1xuICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyBsaWIvc3RyaXBlLnRzOiBTdHJpcGUgaW5zdGFuY2UgaXMgbnVsbCBpbiBwYXlJbnZvaWNlLiBSZXR1cm5pbmcgTU9DSyBwYXltZW50IHN0YXR1cy5cIik7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBpbnZvaWNlSWQsIHN0YXR1czogXCJwYWlkXCIsIHBhaWQ6IHRydWUsIGFtb3VudF9wYWlkOiAxMDAwMCwgY3VycmVuY3k6IFwibm9rXCIsXG4gICAgICBlcnJvcjogdHJ1ZSwgbWVzc2FnZTogXCJTdHJpcGUgbm90IGluaXRpYWxpemVkXCJcbiAgICB9O1xuICB9XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coYGxpYi9zdHJpcGUudHM6IEF0dGVtcHRpbmcgUkVBTCBTdHJpcGUgQVBJIGNhbGwgZm9yIHBheUludm9pY2UuIEludm9pY2UgSUQ6ICR7aW52b2ljZUlkfWApO1xuICAgIGNvbnN0IGludm9pY2UgPSBhd2FpdCBzdHJpcGUuaW52b2ljZXMucGF5KGludm9pY2VJZCk7XG4gICAgY29uc29sZS5sb2coXCLinIUgbGliL3N0cmlwZS50czogUkVBTCBTdHJpcGUgSW52b2ljZSBwYWlkLiBTdGF0dXM6XCIsIGludm9pY2Uuc3RhdHVzKTtcbiAgICByZXR1cm4gaW52b2ljZTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgbGliL3N0cmlwZS50czogRXJyb3IgcGF5aW5nIFJFQUwgU3RyaXBlIGludm9pY2U6XCIsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGludm9pY2VJZCwgc3RhdHVzOiBcIm9wZW5cIiwgcGFpZDogZmFsc2UsIC8qYW1vdW50X3BhaWQgbWlnaHQgbm90IGJlIHNldCovXG4gICAgICBlcnJvcjogdHJ1ZSwgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCBcIlVua25vd24gQVBJIGVycm9yIHBheWluZyBpbnZvaWNlXCJcbiAgICB9O1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgY3JlYXRlVGVzdEludm9pY2UgPSBhc3luYyAoY3VzdG9tZXJJZDogc3RyaW5nKSA9PiB7XG4gIGxvZ1N0cmlwZU9wZXJhdGlvbihcImNyZWF0ZVRlc3RJbnZvaWNlIC0gU3RhcnRcIiwgeyBjdXN0b21lcklkIH0pO1xuICBjb25zb2xlLmxvZyhcIi0tLSBERUJVRzogbGliL3N0cmlwZS50cyAtPiBjcmVhdGVUZXN0SW52b2ljZSAtLS0gJ3N0cmlwZScgaW5pdGlhbGl6ZWQ/XCIsIHN0cmlwZSA/IFwiWUVTXCIgOiBcIk5PXCIpO1xuXG4gIGlmICghaXNEZXZlbG9wbWVudCkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgbGliL3N0cmlwZS50czogY3JlYXRlVGVzdEludm9pY2UgY2FsbGVkIG91dHNpZGUgZGV2ZWxvcG1lbnQgbW9kZS5cIik7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVGVzdCBpbnZvaWNlcyBjYW4gb25seSBiZSBjcmVhdGVkIGluIGRldmVsb3BtZW50IG1vZGVcIik7XG4gIH1cbiAgaWYgKCFjdXN0b21lcklkKSB7XG4gICAgY29uc29sZS5lcnJvcihcIuKdjCBsaWIvc3RyaXBlLnRzOiBDdXN0b21lciBJRCBpcyByZXF1aXJlZCBmb3IgY3JlYXRlVGVzdEludm9pY2UuXCIpO1xuICAgIHRocm93IG5ldyBFcnJvcihcIkN1c3RvbWVyIElEIGlzIHJlcXVpcmVkIHRvIGNyZWF0ZSBhIHRlc3QgaW52b2ljZVwiKTtcbiAgfVxuICBpZiAoIXN0cmlwZSkge1xuICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyBsaWIvc3RyaXBlLnRzOiBTdHJpcGUgaW5zdGFuY2UgaXMgbnVsbCBpbiBjcmVhdGVUZXN0SW52b2ljZS4gUmV0dXJuaW5nIE1PQ0sgdGVzdCBpbnZvaWNlLlwiKTtcbiAgICBjb25zdCBhbW91bnQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA5MDApICsgMTAwO1xuICAgIHJldHVybiB7XG4gICAgICBpZDogXCJpbl90ZXN0X21vY2tfU1RSSVBFX05VTExfXCIgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KSxcbiAgICAgIG51bWJlcjogXCJURVNUX01PQ0tcIiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwKSxcbiAgICAgIGN1c3RvbWVyOiBjdXN0b21lcklkLFxuICAgICAgYW1vdW50X2R1ZTogZm9ybWF0QW1vdW50Rm9yU3RyaXBlKGFtb3VudCksXG4gICAgICBjdXJyZW5jeTogXCJub2tcIixcbiAgICAgIGRlc2NyaXB0aW9uOiBcIk1vY2sgVGVzdCBJbnZvaWNlIC0gU3RyaXBlIE5vdCBJbml0aWFsaXplZFwiLFxuICAgICAgc3RhdHVzOiBcIm9wZW5cIixcbiAgICAgIGR1ZV9kYXRlOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSArIDg2NDAwICogMzAsXG4gICAgICBjcmVhdGVkOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSxcbiAgICAgIGVycm9yOiB0cnVlLFxuICAgICAgbWVzc2FnZTogXCJTdHJpcGUgbm90IGluaXRpYWxpemVkXCJcbiAgICB9O1xuICB9XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coYGxpYi9zdHJpcGUudHM6IEF0dGVtcHRpbmcgUkVBTCBTdHJpcGUgQVBJIGNhbGwgZm9yIGNyZWF0ZVRlc3RJbnZvaWNlLiBDdXN0b21lcjogJHtjdXN0b21lcklkfWApO1xuICAgIGNvbnN0IGFtb3VudCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDkwMCkgKyAxMDA7XG4gICAgY29uc3QgaW52b2ljZUl0ZW0gPSBhd2FpdCBzdHJpcGUuaW52b2ljZUl0ZW1zLmNyZWF0ZSh7XG4gICAgICBjdXN0b21lcjogY3VzdG9tZXJJZCxcbiAgICAgIGFtb3VudDogZm9ybWF0QW1vdW50Rm9yU3RyaXBlKGFtb3VudCksXG4gICAgICBjdXJyZW5jeTogXCJub2tcIixcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlRlc3QgSW52b2ljZSAtIERldmVsb3BtZW50IE9ubHkgKFJFQUwgQ0FMTClcIixcbiAgICB9KTtcbiAgICBjb25zdCBpbnZvaWNlID0gYXdhaXQgc3RyaXBlLmludm9pY2VzLmNyZWF0ZSh7XG4gICAgICBjdXN0b21lcjogY3VzdG9tZXJJZCxcbiAgICAgIGF1dG9fYWR2YW5jZTogdHJ1ZSxcbiAgICAgIGNvbGxlY3Rpb25fbWV0aG9kOiBcInNlbmRfaW52b2ljZVwiLFxuICAgICAgZGF5c191bnRpbF9kdWU6IDMwLFxuICAgIH0pO1xuICAgIGNvbnN0IGZpbmFsaXplZEludm9pY2UgPSBhd2FpdCBzdHJpcGUuaW52b2ljZXMuZmluYWxpemVJbnZvaWNlKGludm9pY2UuaWQpO1xuICAgIGNvbnNvbGUubG9nKFwi4pyFIGxpYi9zdHJpcGUudHM6IFJFQUwgU3RyaXBlIFRlc3QgSW52b2ljZSBjcmVhdGVkLiBJRDpcIiwgZmluYWxpemVkSW52b2ljZS5pZCk7XG4gICAgcmV0dXJuIGZpbmFsaXplZEludm9pY2U7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKFwi4p2MIGxpYi9zdHJpcGUudHM6IEVycm9yIGNyZWF0aW5nIFJFQUwgdGVzdCBpbnZvaWNlOlwiLCBlcnJvcik7XG4gICAgY29uc3QgYW1vdW50ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogOTAwKSArIDEwMDtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IFwiaW5fdGVzdF9tb2NrX0FQSV9FUlJPUl9cIiArIERhdGUubm93KCkudG9TdHJpbmcoMzYpLFxuICAgICAgbnVtYmVyOiBcIlRFU1RfTU9DS19FUlJPUlwiICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApLFxuICAgICAgY3VzdG9tZXI6IGN1c3RvbWVySWQsXG4gICAgICBhbW91bnRfZHVlOiBmb3JtYXRBbW91bnRGb3JTdHJpcGUoYW1vdW50KSxcbiAgICAgIGN1cnJlbmN5OiBcIm5va1wiLFxuICAgICAgZGVzY3JpcHRpb246IFwiTW9jayBUZXN0IEludm9pY2UgLSBBUEkgRXJyb3JcIixcbiAgICAgIHN0YXR1czogXCJvcGVuXCIsXG4gICAgICBkdWVfZGF0ZTogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyA4NjQwMCAqIDMwLFxuICAgICAgY3JlYXRlZDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCksXG4gICAgICBlcnJvcjogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJVbmtub3duIGVycm9yXCJcbiAgICB9O1xuICB9XG59OyJdLCJuYW1lcyI6WyJTdHJpcGUiLCJpc0RldmVsb3BtZW50IiwicHJvY2VzcyIsImdldFN0cmlwZUluc3RhbmNlIiwiYXBpS2V5RnJvbUVudiIsImVudiIsIlNUUklQRV9TRUNSRVRfS0VZIiwiY29uc29sZSIsImxvZyIsIndhcm4iLCJzdGFydHNXaXRoIiwibWFza2VkRGlzcGxheUtleSIsImxlbmd0aCIsInN1YnN0cmluZyIsInN0cmlwZUluc3RhbmNlIiwiYXBpVmVyc2lvbiIsInR5cGVzY3JpcHQiLCJlcnJvciIsInN0cmlwZSIsImxvZ1N0cmlwZU9wZXJhdGlvbiIsIm9wZXJhdGlvbiIsImFyZ3MiLCJmb3JtYXRBbW91bnRGb3JTdHJpcGUiLCJhbW91bnQiLCJNYXRoIiwicm91bmQiLCJmb3JtYXRBbW91bnRGcm9tU3RyaXBlIiwiY3JlYXRlQ3VzdG9tZXIiLCJlbWFpbCIsIm5hbWUiLCJtZXRhZGF0YSIsImlkIiwiRGF0ZSIsIm5vdyIsInRvU3RyaW5nIiwicmFuZG9tIiwib2JqZWN0IiwiY3JlYXRlZCIsImZsb29yIiwibWVzc2FnZSIsImN1c3RvbWVyUGFyYW1zIiwiY3VzdG9tZXIiLCJjdXN0b21lcnMiLCJjcmVhdGUiLCJjcmVhdGVQYXltZW50SW50ZW50IiwiY3VycmVuY3kiLCJjdXN0b21lcklkIiwibW9ja0NsaWVudFNlY3JldCIsImNsaWVudF9zZWNyZXQiLCJzdGF0dXMiLCJwYXltZW50SW50ZW50UGFyYW1zIiwiYXV0b21hdGljX3BheW1lbnRfbWV0aG9kcyIsImVuYWJsZWQiLCJwYXltZW50SW50ZW50IiwicGF5bWVudEludGVudHMiLCJjcmVhdGVJbnZvaWNlIiwiZGVzY3JpcHRpb24iLCJhbW91bnRfZHVlIiwiZHVlX2RhdGUiLCJpbnZvaWNlSXRlbSIsImludm9pY2VJdGVtcyIsImludm9pY2UiLCJpbnZvaWNlcyIsImF1dG9fYWR2YW5jZSIsImNvbGxlY3Rpb25fbWV0aG9kIiwiZGF5c191bnRpbF9kdWUiLCJmaW5hbGl6ZWRJbnZvaWNlIiwiZmluYWxpemVJbnZvaWNlIiwic2VuZEludm9pY2UiLCJnZXRDdXN0b21lckludm9pY2VzIiwiaG9zdGVkX2ludm9pY2VfdXJsIiwibGlzdCIsImxpbWl0IiwiZGF0YSIsInBheUludm9pY2UiLCJpbnZvaWNlSWQiLCJwYWlkIiwiYW1vdW50X3BhaWQiLCJwYXkiLCJjcmVhdGVUZXN0SW52b2ljZSIsIkVycm9yIiwibnVtYmVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/stripe.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/set-cookie-parser","vendor-chunks/webidl-conversions","vendor-chunks/jose","vendor-chunks/stripe","vendor-chunks/qs","vendor-chunks/object-inspect","vendor-chunks/get-intrinsic","vendor-chunks/side-channel-list","vendor-chunks/side-channel-weakmap","vendor-chunks/has-symbols","vendor-chunks/function-bind","vendor-chunks/side-channel-map","vendor-chunks/side-channel","vendor-chunks/get-proto","vendor-chunks/call-bind-apply-helpers","vendor-chunks/dunder-proto","vendor-chunks/math-intrinsics","vendor-chunks/call-bound","vendor-chunks/es-errors","vendor-chunks/gopd","vendor-chunks/es-define-property","vendor-chunks/hasown","vendor-chunks/es-object-atoms"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute&page=%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fcreate-customer-for-user%2Froute.ts&appDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falexanderamundsen%2FWebstormProjects%2Fwasd&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();